<?xml version="1.0" encoding="UTF-8"?>
<project name="Bundle Builder" basedir=".">

    <!-- customizable values -->
    <property name="packageName" value="open-xchange-common"/>

	<!-- Constants -->
    <property name="mainDir" value=".."/>
    <property name="checkoutDir" value="${mainDir}"/>
    <property name="logDir" value="${mainDir}/log"/>

	<target name="antExtensions">
        <path id="ant3rdPartyLib">
            <fileset dir="lib" includes="*.jar"/>
        </path>
        <property name="build" value="build"/>
        <mkdir dir="${build}"/>
        <javac srcdir="src" destdir="${build}" debug="true" debuglevel="lines,vars,source" encoding="US-ASCII" source="1.5" compiler="javac1.5" target="1.5" includeantruntime="false">
            <classpath refid="ant3rdPartyLib"/>
        </javac>
        <copy file="src/tasks.properties" todir="${build}"/>
        <path id="antClasspath">
            <path refid="ant3rdPartyLib"/>
            <pathelement location="${build}"/>
        </path>
        <taskdef resource="tasks.properties" classpathref="antClasspath"/>
    </target>

    <target name="clean">
        <delete dir="${build}"/>
    </target>

    <target name="prepare" depends="antExtensions">
        <!-- reads the project sets and generates the ant properties for each project -->
        <createProjectList name="projectsList">
            <projectSets>
                <fileset dir="${checkoutDir}/${packageName}" includes="*.psf"/>
            </projectSets>
        </createProjectList>
    </target>

	<target name="buildProjects" depends="antExtensions,prepare">
		<echo>TODO</echo>
		<!-- TODO -->
    </target>

	<target name="distBuild">
        <property name="buildType" value="dist"/>
    </target>

    <target name="dist" depends="distBuild,buildProjects"/>

	<target name="cpd">
        <mkdir dir="${logDir}"/>
        <taskdef name="cpd" classname="net.sourceforge.pmd.cpd.CPDTask"/>
        <cpd minimumTokenCount="100" encoding="US-ASCII" format="xml" outputFile="${logDir}/cpd.xml">
            <fileset dir="${checkoutDir}">
                <include name="**/*.java"/>
            </fileset>
        </cpd>
    </target>

</project>

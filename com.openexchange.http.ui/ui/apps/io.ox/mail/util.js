define("io.ox/mail/util",["io.ox/core/extensions","io.ox/core/config"],function(a,b){var c,d=_.printf,e=60*1e3,f=e*60,g=function(a,b,c){return c>1?b:a},h=function(b){b.preventDefault(),a.point("io.ox/core/person:action").each(function(a){_.call(a.action,b.data,b)})},i=/([^,;"]+|"(\\.|[^"])+")+/,j=/^[,;\s]+/,k=/^("(\\.|[^"])+"\s|[^<]+)(<[^\>]+\>)$/,l=/(^<|>$)/g,m=/(^["'\\\s]+|["'\\\s]+$)/g,n={};return"use strict",_(b.get("mail.addresses",[])).each(function(a){n[a.toLowerCase()]=!0}),c={parseRecipient
:function(a){var b,c,d,e=$.trim(a);return(b=e.match(k))!==null?(d=b[3].replace(l,"").toLowerCase(),c=b[1].replace(m,"")):(d=e.replace(l,"").toLowerCase(),c=d.split(/@/)[0]),[c,d]},parseRecipients:function(a){var b,c,d=[];while((b=a.match(i))!==null)a=a.substr(b[0].length).replace(j,""),c=this.parseRecipient(b[0]),c[1].indexOf("@")>-1&&d.push(c);return d},serializeList:function(a,b,c){var d,e,f=0,g=a.length,i=$("<div>");for(;f<g;f++)e={display_name:this.getDisplayName(a[f]),email1:String(a[f][1]||""
).toLowerCase()},d=$("<a>",{href:"#"}).addClass(b?"person-link":"person").css("whiteSpace","nowrap").text(e.display_name).appendTo(i),b&&d.on("click",e,h).css("cursor","pointer"),c&&c.call(i,e),f<g-1&&i.append($("<span>").addClass("delimiter").html("&nbsp;&bull; "));return i.children()},serializeAttachments:function(a,b){var c=0,d=b.length,e=$(),f="",g="";for(;c<d;c++)f=b[c].filename||"",g=ox.apiRoot+"/mail?"+$.param({action:"attachment",folder:a.folder_id,id:a.id,attachment:b[c].id,delivery:"download"
}),e=e.add($("<a>",{href:g,target:"_blank"}).addClass("attachment-link").text(f)),c<d-1&&(e=e.add($("<span>").addClass("delimiter").html("&nbsp;&bull; ")));return e},getDisplayName:function(a){var b,c,d;if(!a)return"";return b=a[0],c=a[1].toLowerCase(),d=_.isString(b)?b.replace(m,""):"",d||c},getFrom:function(a,b){var d;return a=a||[["",""]],d=c.getDisplayName(a[0]),$("<span>").addClass("person").text(b?_.prewrap(d):d)},getFlag:function(a){return a.color_label||0},getPriority:function(a){var b='<i class="icon-star"></i>'
;return a.priority<3?$("<span>Â "+b+b+b+"</span>"):$()},getTime:function(a){var b=new Date,c=new Date(a),d=function(){return _.pad(c.getUTCHours(),2)+":"+_.pad(c.getUTCMinutes(),2)},e=function(){return _.pad(c.getUTCDate(),2)+"."+_.pad(c.getUTCMonth()+1,2)+"."+c.getUTCFullYear()},f=function(){return c.getUTCDate()===b.getUTCDate()&&c.getUTCMonth()===b.getUTCMonth()&&c.getUTCFullYear()===b.getUTCFullYear()};return f()?d():e()},getDateTime:function(a){var b=new Date,c=new Date(a),d=function(){return _
.pad(c.getUTCHours(),2)+":"+_.pad(c.getUTCMinutes(),2)},e=function(){return _.pad(c.getUTCDate(),2)+"."+_.pad(c.getUTCMonth()+1,2)+"."+c.getUTCFullYear()},f=function(){return c.getDate()===b.getDate()&&c.getMonth()===b.getMonth()&&c.getFullYear()===b.getFullYear()};return f()?d():e()+" "+d()},getSmartTime:function(a){var b=new Date,c=b.getTimezoneOffset(),h=b.getTime()-c*60*1e3,i=h-a,j=new Date(a),k=0;if(j.getDate()===b.getDate())if(i<f)return k=Math.ceil(i/e),""+d(g("%d minute ago","%d minutes ago"
,k),k);else return k=Math.ceil(i/f),""+d(g("%d hour ago","%d hours ago",k),k);else if(j.getDate()===b.getDate()-1)return"Yesterday";else return j.getDate()+"."+(j.getMonth()+1)+"."+j.getFullYear()},isUnread:function(a){return a.unreadCount!==undefined?a.unreadCount>0:(a.flags&32)!==32},isDeleted:function(a){return(a.flags&2)===2},byMyself:function(a){return a.from&&a.from.length&&String(a.from[0][1]||"").toLowerCase()in n},hasOtherRecipients:function(a){var b=[].concat(a.to,a.cc,a.bcc);return 0<_
(b).reduce(function(a,b){var c=String(b[1]||"").toLowerCase();return a+(!c||c in n?0:1)},0)}},c})
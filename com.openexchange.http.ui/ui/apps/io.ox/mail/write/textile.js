define("io.ox/mail/textile",function(){var a=/^p(&lt;|>|=)?(\{([^}]*)\})?\. (.+)/,b=/^h(\d)(&lt;|>|=)?\. (.+)/,c=/^> (.+)/,d=/^---+$/,e=/^(\*+) (.+)$/,f=/^(\#+) (.+)$/,g=/^!(&lt;|>|=)?(.+)!$/,h={},i=function(a){return a=a.replace(/(^|[^\-])--([^\-]|$)/g,"$1&mdash;$2"),a=a.replace(/ - /g," &ndash; "),a=a.replace(/\.\.\./g,"&hellip;"),a.replace(/\*([^*]+)\*|_([^*_]+)_/g,function(a,b,c){switch(a.substr(0,1)){case"*":return"<b>"+i(b)+"</b>";case"_":return"<i>"+i(c)+"</i>"}})},j=function(a,b,c){var d=
a.match(b);return d&&d[1].length===c},k=function(a){a.append($("<br/>"))},l=function(a){var b=a.children().last();b.is("br")&&b.remove()},m=function(a){return $(this).css({height:a.data.open?"2.1em":"auto"}).find(".textile-quote-arrow").css("display",a.data.open?"":"none"),a.data.open=!a.data.open,!1},n=function(a,b){a==="&lt;"?b.css("textAlign","left"):a===">"?b.css("textAlign","right"):a==="="&&b.css("textAlign","center")},o=function(p,q,r,s,t){var u=q,v=p.length,w,x,y,z;for(;u<v;u++){w=p[u].replace
(/\s+$/,""),y=z=null;switch(r){case"":w===""?k(s):c.test(w)?(s.append(y=$("<blockquote/>").addClass("textile-quote").html("<div class='textile-quote-arrow'>▼</div>").on("click",{open:!1},m)),u=o(p,u,">",y,t)):(x=w.match(b))?(s.append(y=$("<h"+x[1]+"/>").addClass("textile-headline").html(i(x[3]))),n(x[2],y)):j(w,e,t+1)?u=o(p,u,"ul",s,t):j(w,f,t+1)?u=o(p,u,"ol",s,t):(x=w.match(g))?(s.append(z=$("<p>").css("margin","0").append(y=$("<img/>").attr({src:h[x[2]],alt:""}).css("maxWidth","45em"))),x[1]==="&lt;"?
y.css({"float":"left",margin:"0 2em 1em 0"}):x[1]===">"?y.css({"float":"right",margin:"0 0 1em 2em"}):x[1]==="="&&z.css("textAlign","center")):(x=w.match(a))?(s.append(y=$("<p/>").css("cssText",x[3]||"").css("margin","0")),n(x[1],y),y.append($("<span/>").html(i(x[4]))),k(y),u=o(p,u+1,"p",y,t),l(y)):(s.append(y=$("<p/>").css("margin","0")),d.test(w)?$(y).addClass("textile-border-top"):(y.append($("<span/>").html(i(w))),k(y)),u=o(p,u+1,"p",y,t),l(y));break;case"p":if(a.test(w)||b.test(w)||g.test(w)||
e.test(w)||f.test(w))return u-1;else if(w!=="")if(d.test(w))return $(s).addClass("textile-border-bottom"),u+1;else w=i(w),s.append($("<span/>").html(w)),k(s);else return k(s.parent()),u;break;case">":if(c.test(w))s.append($("<span/>").html(w.replace(c,"$1"))),k(s);else return u-1;break;case"ul":if(j(w,e,t+1))s.append(y=$("<ul/>").addClass("textile-list")),u=o(p,u,"ul",y,t+1);else if(j(w,e,t))s.append(y=$("<li/>").html("<span>"+i(w.replace(e,"$2"))+"</span>")),u=o(p,u+1,"ul",s,t);else return u-1;break;
case"ol":if(j(w,f,t+1))s.append(y=$("<ol/>").addClass("textile-list")),u=o(p,u,"ol",y,t+1);else if(j(w,f,t))s.append(y=$("<li/>").html("<span>"+i(w.replace(f,"$2"))+"</span>")),u=o(p,u+1,"ol",y,t);else return u-1}}return y=s=null,u},p=function(a){var b=a.replace(/</g,"&lt;"),c=[],d=0,e=0,f,g="",h=!1,i=!1,j=$("<div/>").addClass("textile");return b=b.replace(/([a-z][\w\-\.]+)@(.+\.\w{2,3})/ig,'<a href="mailto:$1&#64;$2" class="textile-url">$1&#64;$2</a>'),b=b.replace(/https?:\/\/.+/ig,'<span class="textile-url">$1</span>'
),b=b.replace(/((^|\n)([a-zöäüß \-]+ \d+[a-z]*)([,.]*[ \n]*)(\d{5} [a-zäöüß \-]+))/ig,function(a,b,c,d,e,f){return c+'<a href="http://maps.google.de/maps?z=18&q='+encodeURIComponent(d+", "+f)+'" target="_blank" title="Google Maps..." class="textile-address">'+(d+e+f).replace(/\n/g,"<br/>")+"</a>"}),b=b.replace(/@([^@]+)@/g,function(a,b){return'<code class="textile-code">'+b.replace(/\n/g,"<br/>")+"</code>"}),c=b.split(/\n/),o(c,0,"",j,0),c=b=null,j};return"use strict",{parse:p}})
define("io.ox/files/views/create",["io.ox/core/tk/dialogs","io.ox/core/extensions","io.ox/files/api","text!io.ox/files/views/snippets.html","gettext!io.ox/files/files"],function(a,b,c,d,e){var f=$(d),g=b.point("io.ox/files/create/form"),h=b.point("io.ox/files/create/action"),i=function(b,c){c=c||{};var d=new a.CreateDialog({easyOut:!0}),i=d.getContentNode().addClass("create-file"),j={},k={},l={},m;i.append(f.find(".fileForm").clone()),m=i.find("fieldset"),g.each(function(a){var b,c={};a.label?(b=
f.find(".field").clone(),b.find("label").attr({"for":a.id}).text(a.label)):b=f.find(".noLabelField").clone(),a.draw&&a.draw(b.find(".controls"),c),a.extendedForm&&b.addClass("extendedForm"),k[a.id]=c,b.appendTo(m)}),j.moreButton=i.find(".more"),j.moreButton.text(e("Show more...")),d.header($("<h3>").text(e("Add new file"))),i.find(".extendedForm").hide(),j.moreButton.on("click",function(a){a.preventDefault(),i.find(".extendedForm").fadeIn(),j.moreButton.remove(),i.find("input:first").focus()}),h.
each(function(a){d.addButton(a.id,a.label,a.id,{type:a.type}),l[a.id]=a}),d.addButton("cancel","Cancel","cancel"),d.show().done(function(a){var e=l[a],f;e&&(f={folder:b.folder.get()},g.each(function(a){a.process&&a.process(f,k[a.id])}),c.modifyFile&&c.modifyFile(f),b.getWindow().busy(),e.perform(f,k,function(a){b.getWindow().idle(),c.uploadedFile&&c.uploadedFile(a)})),i.empty(),i=d=null,c.done&&c.done()})};return"use strict",g.extend({id:"title",extendedForm:!0,index:10,label:e("Title"),draw:function(
a,b){b.node=$("<input type='text' name='title'></input>"),a.append(b.node)},process:function(a,b){var c=b.node.val();c&&(a.title=b.node.val())}}),g.extend({id:"url",extendedForm:!0,index:20,label:e("Link / URL"),draw:function(a,b){b.node=$("<input type='text' name='title'></input>"),a.append(b.node)},process:function(a,b){var c=b.node.val();c&&(a.url=b.node.val())}}),g.extend({id:"file",index:30,draw:function(a,b){b.node=$("<input type='file' name='title'></input>"),a.append(b.node)}}),g.extend({
id:"comment",extendedForm:!0,index:40,label:e("Comment"),draw:function(a,b){b.node=$("<textarea rows='10'></textarea>").addClass("input-xlarge"),a.append(b.node)},process:function(a,b){var c=b.node.val();c&&(a.description=b.node.val())}}),h.extend({id:"save",label:e("Save"),type:"primary",perform:function(a,b,d){var e=!1;_(b.file.node[0].files).each(function(b){e=!0,c.uploadFile({file:b,json:a,folder:a.folder}).done(function(a){d(a)})}),!e&&!$.isEmptyObject(a)&&c.create({json:a}).done(function(a)
{d(a)})}}),{show:i}})
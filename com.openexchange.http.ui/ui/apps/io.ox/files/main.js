define("io.ox/files/main",["io.ox/files/view-detail","io.ox/files/api","io.ox/core/commons","io.ox/core/tk/vgrid","io.ox/core/tk/upload","io.ox/core/extPatterns/dnd","io.ox/core/extPatterns/shortcuts","io.ox/core/tk/dialogs","gettext!io.ox/files/files","io.ox/core/bootstrap/basics","io.ox/files/actions","less!io.ox/files/style.css"],function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n=ox.ui.createApp({name:"io.ox/files"}),o=330;return"use strict",n.setLauncher(function(){var h,p,q,r;j=ox.ui.createWindow({name
:"io.ox/files",title:i("Files"),titleWidth:o+27+"px",toolbar:!0,search:!0}),n.setWindow(j),c.addFolderView(n,{width:o,type:"infostore",rootFolderId:9}),l=$("<div>").addClass("leftside border-right").css({width:o+"px",overflow:"auto"}).appendTo(j.nodes.main),m=$("<div>").css({left:o+1+"px",overflow:"auto"}).addClass("rightside default-content-padding").appendTo(j.nodes.main),k=new d(l),k.addTemplate({build:function(){var a;return this.addClass("file").append(a=$("<div>").addClass("name")),{name:a}
},set:function(a,b){b.name.text(a.title||a.filename||"Â ")}}),c.wireGridAndAPI(k,b),c.wireGridAndSearch(k,j,b),h=null;function s(b){h&&h.destroy(),h=a.draw(b),m.idle().empty().append(h.element),m.parent().scrollTop(0),n.currentFile=b,n.detailView=h,q.update(),r.activateForContext({data:b,view:n.detailView,folder:b.folder_id})}p=function(a){if(h&&h.file.id===a.id)return;m.busy(!0),b.get(a).done(_.lfo(s))},c.wireGridAndSelectionChange(k,"io.ox/files",p,m),k.selection.on("empty",function(){h&&(h.destroy
(),h=null),n.currentFile=null,q.update()}),k.selection.on("change",function(a,b){b.length>1&&(n.currentFile=null)}),b.on("beforedelete",function(){k.selection.selectNext()}),b.on("triggered",function(){var a=$.makeArray(arguments),b=a.shift();h&&h.trigger.apply(h,a)}),m.on("dblclick",function(a){if(_(["a","button","input","textarea"]).include(a.srcElement.tagName.toLowerCase()))return;h&&h.toggleEdit()}),n.queues={},n.queues.create=e.createQueue({processFile:function(a){return j.busy(),b.uploadFile
({file:a,folder:n.folder.get()}).done(function(a){k.selection.set([a]),k.refresh()}).always(j.idle)}}),n.queues.update=e.createQueue({processFile:function(a){return j.busy(),b.uploadNewVersion({file:a,id:n.currentFile.id,folder:n.currentFile.folder,timestamp:n.currentFile.last_modified}).done(function(a){k.selection.set([a]),k.refresh()}).always(j.idle)}}),q=new f.UploadZone({ref:"io.ox/files/dnd/actions"},n),r=new g.Shortcuts({ref:"io.ox/files/shortcuts"}),j.on("show",function(){q.include()}),j.
on("hide",function(){q.remove(),r.deactivate()}),c.wireGridAndWindow(k,j),c.wireFirstRefresh(n,b),c.wireGridAndRefresh(k,b,j),n.on("folder:change",function(a,b,c){j.nodes.title.find(".has-publications").remove(),c["com.openexchange.publish.publicationFlag"]&&j.nodes.title.prepend($("<img>",{src:ox.base+"/apps/themes/default/glyphicons_232_cloud.png",title:i("This folder has publications"),alt:""}).addClass("has-publications"))}),c.addFolderSupport(n,k,"infostore").done(c.showWindow(j,k))}),n.invalidateFolder=
function(a){a&&k.selection.set([a]),k.refresh()},{getApp:n.getInstance}})
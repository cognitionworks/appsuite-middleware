define("io.ox/settings/accounts/settings",["io.ox/core/extensions","io.ox/core/tk/view","io.ox/settings/utils","io.ox/core/tk/dialogs","io.ox/core/api/account","io.ox/core/tk/forms","io.ox/settings/accounts/email/settings"],function(a,b,c,d,e,f,g){var h,i=null,j=function(a){h.push({dataid:"email/"+a.id,html:a.primary_address})},k=function(a){h=[],_.each(a,function(a){j(a)})},l=function(b){var c=b.data.listbox.find('div[selected="selected"]').attr("data-item-id"),d;c!==undefined&&(d=n(c),b.data.id=
d.dataid,require(["io.ox/settings/accounts/"+d.type+"/settings"],function(c){a.point("io.ox/settings/accounts/"+d.type+"/settings/detail").invoke("draw",b.data.self.node,b)}))},m=function(b){var c="email";console.log("create a new account"),require(["io.ox/settings/accounts/"+c+"/settings"],function(d){a.point("io.ox/settings/accounts/"+c+"/settings/detail").invoke("draw",b.data.self.node,b)})},n=function(a){if(a!==undefined){var b=a.split(/\//)[0],c=a.split(/\//)[1];return{dataid:c,type:b}}},o=function(
a,b){var c=$.Deferred();require(["io.ox/core/tk/dialogs"],function(d){(new d.ModalDialog).text("Do you really want to delete this account?").addPrimaryButton("delete","delete account").addButton("cancel","Cancel").show().done(function(d){d==="delete"?(c.resolve(),e.remove([a]).done(function(){i.find('[data-item-id="'+b+'"]').remove()})):c.reject()})})},p=function(a){var b,c,d;a.data!==undefined?c=i.find('div[selected="selected"]').attr("data-item-id"):c=$(a.srcElement.parentNode).attr("data-item-id"
),d=n(c),o(d.dataid,c)},q={draw:function(a){var b=this;return b.node=$("<div>"),b.node.append(f.createSettingsHead(a)).append(f.createSection().append(f.createSectionTitle({text:"Accounts"})).append(f.createSectionContent().append(i=f.createListBox({dataid:"accounts-list",model:{get:function(){return h}}}).delegate(".close","click",p)).append(f.createButton({label:"Add ...",btnclass:"btn"}).attr("data-action","add").css({"margin-right":"15px"}).on("click",{self:b},g.mailAutoconfigDialog),f.createButton
({label:"Edit ...",btnclass:"btn"}).attr("data-action","edit").css({"margin-right":"15px"}).on("click",{listbox:i,self:b},l),f.createButton({label:"Delete ...",btnclass:"btn"}).attr("data-action","delete").on("click",{self:b},p))).append(f.createSectionDelimiter())),b}};return"use strict",a.point("io.ox/settings/accounts/settings/detail").extend({index:200,id:"accountssettings",draw:function(a){var b=this;return e.all().done(function(c){k(c),b.append(q.draw(a).node)}),q.node},save:function(){console
.log("now accounts get saved?")}}),{}})
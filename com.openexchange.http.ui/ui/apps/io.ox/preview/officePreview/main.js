define("io.ox/preview/officePreview/main",["io.ox/core/tk/keys","gettext!io.ox/preview/officePreview/officePreview","less!io.ox/preview/officePreview/style.css"],function(a){var b=5;"use strict";function c(a){if(/\.pptx?$/.test(a.name))return"io-ox-office-preview-presentation ";return"io-ox-office-preview-page"}function d(a){a.find("*").each(function(a,b){var c;b=$(b),c=b.css("position"),c&&c.toLowerCase()==="fixed"&&b.css({position:"absolute"})})}function e(e){var f,g,h,i,j,k;e?(_.url.hash("name"
,e.name),_.url.hash("dataURL",e.dataURL)):e={name:_.url.hash("name"),dataURL:_.url.hash("dataURL")},f=ox.ui.createApp({name:"io.ox/preview/officePreview",title:"Preview"}),f.document=[],f.index=0,f.maxPages=-1,i=$("<span>").addClass("io-ox-office-preview-page-indicator").text("1"),j=$("<button>").addClass("btn btn-primary disabled").append("<i class='icon-white icon-chevron-right'>").on("click",function(a){a.preventDefault(),f.nextPage()}),k=$("<button>").addClass("btn btn-primary disabled").append
("<i class='icon-white icon-chevron-left'>").on("click",function(a){a.preventDefault(),f.previousPage()}),h=$("<div>");function l(){g.busy()}function m(){g.idle()}function n(a){if(f.maxPages!==-1)return(new $.Deferred).resolve(f.document);if(f.document.length>=a)return(new $.Deferred).resolve(f.document);return l(),$.ajax({url:e.dataURL+"&format=preview_filtered&pages="+a+"&previewForceDiv=true&view=html",dataType:"json"}).pipe(function(a){return m(),f.document=a.data.document.map(function(a){return a=
$(a),d(a),a}),a.data.moreAvailable||(f.maxPages=f.document.length-1),f.document})}return f.nextPage=function(){f.showPage(f.index+1)},f.previousPage=function(){f.showPage(f.index-1)},f.showPage=function(a){var d;a=Math.max(0,a),f.maxPages!==-1&&a>f.maxPages&&(a=f.maxPages),d=a+b-a%b,n(d).done(function(b){var d,g=b[a].clone();g.find("img").each(function(){var a=$(this),b=String(a.attr("src"));a.attr("src",b.replace(/^\/ajax/,ox.apiRoot))}),h.empty().append(g),d=$(window).width()/2-g.width()/2,g.addClass
(c(e)),g.addClass("io-ox-office-preview-content").css({position:"relative",left:d,right:d}),f.index=a,i.text(a+1),a===0?k.hasClass("disabled")||k.addClass("disabled"):k.removeClass("disabled"),a===f.maxPages?j.hasClass("disabled")||j.addClass("disabled"):j.removeClass("disabled")})},f.setLauncher(function(){var b=new a;g=ox.ui.createWindow({name:"io.ox/mail/write",title:e.name,titleWidth:"40%",toolbar:!0,close:!0}),f.setWindow(g),h=$("<div>").addClass("abs").css({overflow:"auto",zIndex:2}).appendTo
(g.nodes.main),g.nodes.main.addClass("io-ox-office-preview-background").append(i),g.show(function(){g.nodes.toolbar.append($("<div>").append(k,$.txt(" "),j)).css({left:"47%"}),f.showPage(0)}),g.on("idle show",function(){b.include()}),g.on("hide busy",function(){b.remove()}),b.on("leftarrow",function(){f.previousPage()}),b.on("uparrow",function(){f.previousPage()}),b.on("rightarrow",function(){f.nextPage()}),b.on("downarrow",function(){f.nextPage()}),b.on("space",function(){f.nextPage()}),b.on("esc"
,function(){f.quit()})}),f}return{getApp:e}})
define("io.ox/calendar/edit/model-appointment",["io.ox/calendar/api","io.ox/core/date","gettext!io.ox/calendar/edit/main"],function(a,b,c){var d,e=new b.Local,f=new b.Local;return"use strict",e.setMinutes(0),e.setHours(e.getHours()+1),f.setMinutes(0),f.setHours(f.getHours()+2),d=Backbone.Model.extend({validation:{title:{required:!0,msg:c("You must specify a title")},start_date:[{required:!0,pattern:"number",msg:c("You must enter a valid date/time.")},{smallerThan:"end_date",msg:c("Start date must be  than end-date."
)}],end_date:[{required:!0,pattern:"number",msg:c("You must enter a valid date/time.")},{greaterThan:"start_date",msg:c("End date must be greater than start-date")}]},defaults:{start_date:b.Local.localTime(e.getTime()),end_date:b.Local.localTime(f.getTime()),recurrence_type:0},initialize:function(){this.toSync={},this.on("change",_.bind(this.onChange,this))},save:function(){var a=this,b=new $.Deferred;a.validate();if(a.isDirty()&&!a.isNew()&&a.isValid())return a._update();else if(a.isDirty()&&a.isNew
()&&a.isValid())return a._create();else if(!a.isValid())return b.reject("Please correct your inputs"),b;else return b.reject("Nothing to save"),b},_update:function(){var b=this,c={},d=new $.Deferred;return c=b.toSync,c=b.attributes,b.get("recurrence_type")&&(c.recurrence_type=b.get("recurrence_type"),c.recurrence_type===0&&(delete c.recurrence_id,b.unset("recurrence_id"))),a.update(c).done(function(a){b._resetDirty(),b.attributes=a,d.resolve(a)}).fail(function(a){d.reject(a)}),d},_create:function(
){var b=this,c={},d=new $.Deferred;return c=b.attributes,a.create(c).done(function(a){b._resetDirty(),b.attributes=a,d.resolve(a)}).fail(function(a){d.reject(a)}),d},destroy:function(){var b=this,c={},d=new $.Deferred;return c.data=b.attributes,b.get("recurrence_type")&&(c.data.recurrence_type=b.get("recurrence_type"),c.data.recurrence_type===0&&(delete c.data.recurrence_id,b.unset("recurrence_id"))),c.data.folder=b.get("folder_id"),a.remove(c).done(function(){b._resetDirty(),d.resolve(!0)}).fail
(function(a){d.reject("error on creating model")}),d},onChange:function(a,b){var c=this;c.get("recurrence_type")>0&&(b.changes.interval=!0),c.get("recurrence_type")>1&&(b.changes.days=!0),c.get("recurrence_type")>=3&&(b.changes.day_in_month=!0),_.each(b.changes,function(a,b){c.toSync[b]=c.get(b)})},isDirty:function(){return _(this.toSync).size()>0},_resetDirty:function(){this.toSync={}}}),d})
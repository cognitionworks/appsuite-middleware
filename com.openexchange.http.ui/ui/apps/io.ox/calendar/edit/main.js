define("io.ox/calendar/edit/main",["io.ox/calendar/edit/model-appointment","io.ox/calendar/api","io.ox/calendar/edit/extensions","io.ox/calendar/edit/view-main","gettext!io.ox/calendar/edit/main","less!io.ox/calendar/edit/style.less"],function(a,b,c,d,e){var f=function(){};"use strict",c.init(),window.AppointmentModel=a,f.prototype={start:function(){},stop:function(){var a=this,b=new $.Deferred;return a.model.isDirty()?require(["io.ox/core/tk/dialogs"],function(c){(new c.ModalDialog).text(e("Do you really want to lose your changes?"
)).addPrimaryButton("delete",e("Lose changes")).addButton("cancel",e("Cancel")).show().done(function(c){console.debug("Action",c),c==="delete"?(a.dispose(),b.resolve()):b.reject()})}):(a.dispose(),b.resolve()),b},dispose:function(){this.view.off("save",_.bind(this.onSave,this)),this.model.off("change:title")},edit:function(c){var f=this,g=function(b){f.model=new a(b),window.mymodel=f.model,f._restored===!0&&(f.model.toSync=b),f.view=new d({model:f.model}),f.view.on("save",_.bind(f.onSave,f)),f.setWindow
(ox.ui.createWindow({name:"io.ox/calendar/edit",title:e("Edit Appointment"),toolbar:!0,search:!1,close:!0})),$(f.getWindow().nodes.main[0]).append(f.view.render().el),f.getWindow().show(_.bind(f.onShowWindow,f))};c?(f.setState({folder:c.folder_id,id:c.id}),g(c)):b.get(f.getState()).done(g).fail(function(a){throw new Error(a.error)})},create:function(b){var c=this;c.model=new a(b),c.view=new d({model:c.model}),c.view.on("save",_.bind(c.onSave,c)),c.setTitle(e("Create Appointment")),c.setWindow(ox.
ui.createWindow({name:"io.ox/calendar/edit",title:e("Create Appointment"),toolbar:!0,search:!1,close:!0})),$(c.getWindow().nodes.main[0]).append(c.view.render().el),c.getWindow().show(_.bind(c.onShowWindow,c))},onShowWindow:function(){var a=this;a.model.get("title")&&($(".window-title").text(a.model.get("title")),a.setTitle(a.model.get("title"))),a.model.on("change:title",function(b,c){$(".window-title").text(c),a.setTitle(c)}),$("#"+a.view.guid+"_title").get(0).focus(),$(a.getWindow().nodes.main
[0]).addClass("scrollable")},onSave:function(){var a=this;a.getWindow().busy(),a.model.save().done(function(b){a.getWindow().idle(),a.trigger("save",b),a.quit()}).fail(function(b){var c;a.getWindow().idle(),c=$("<div>").addClass("alert alert-error"),$(a.view.el).find(".error-display").empty().append(c),b.conflicts!==null&&b.conflicts!==undefined?require(["io.ox/calendar/edit/view-conflicts","io.ox/calendar/edit/collection-conflicts"],function(d,e){var f,g;console.log("class",d),f=new e(b.conflicts
),g=new d({collection:f}),window.cview=g,c.empty().append($("<a>").addClass("close").attr("data-dismiss","alert").attr("type","button").text("x"),g.render().el),g.on("ignore",function(){return a.model.set("ignore_conflicts",!0),a.onSave()}),g.on("cancel",function(){$(a.view.el).find("[data-extid=error]").empty()})}):b.error!==undefined?c.append($("<a>").addClass("close").attr("data-dismiss","alert").attr("type","button").text("x"),$("<p>").text(_.formatError(b))):c.append($("<a>").addClass("close"
).attr("data-dismiss","alert").attr("type","button").text("x"),$("<p>").text(b))})},failSave:function(){return{module:"io.ox/calendar/edit",point:this.model.attributes}},failRestore:function(a){var b=$.Deferred();return this._restored=!0,_.isUndefined(a.id)?this.create(a):this.edit(a),b.resolve(),b}};function g(){var a=ox.ui.createApp({name:"io.ox/calendar/edit",title:e("Edit Appointment")}),b=_.extend(a,new f);return b.setLauncher(_.bind(b.start,b)),b.setQuit(_.bind(b.stop,b)),b}return{getApp:g}
})
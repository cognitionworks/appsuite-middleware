define("settings",["io.ox/core/http","io.ox/core/cache","io.ox/core/tk/model"],function(a,b){var c=function(){var c="gui/wurst/",d={},e,f=function(a){var b=a.split(/\//),c=d||{};return _.each(b,function(a,b){var d=c!==null&&c.hasOwnProperty(a)&&typeof c[a]!="undefined"&&c[a]!==null;if(d)c=c[a];else return c=null,null}),c},g=function(a,b){var c=a.split(/\//),e=d||{},f=c.pop();_.each(c,function(a,b){var c=e!==null&&e.hasOwnProperty(a)&&typeof e[a]!="undefined"&&e[a]!==null;if(c){e=e[a];if(typeof e!="object"
)return console.error("settings.set: "+e+" is a value"),!1}else e[a]={},e=e[a]}),e[f]=b},h=function(a){var b=a.split(/\//),c=d||{};return _.each(b,function(a,b){var d=c!==null&&c.hasOwnProperty(a)&&typeof c[a]!="undefined"&&c[a]!==null;if(d)c=c[a];else return!1}),!0},i=function(a){var b=a.split(/\//),c=d||{},e=b.pop();return _.each(b,function(a,b){var d=c!==null&&c.hasOwnProperty(a)&&typeof c[a]!="undefined"&&c[a]!==null;if(d){c=c[a];if(typeof c!="object")return console.error("settings.remove: "+
c+" is a value"),!1}else return!1}),delete [c[e]],!0},j=function(a,b,c){return b=b||{},c=c||"",_(a).each(function(a,d){_.isObject(a)&&!_.isArray(a)?j(a,b,c+d+"/"):b[c+d]=a}),b},k=function(a,b,c){this.set(b,c)},l={settingsPath:null,createModel:function(a){return(new a({data:j(this.get())})).on("change",$.proxy(k,this))},get:function(a,b){if(!a)return f(c+l.settingsPath);else{a=c+l.settingsPath+"/"+a,console.log("getting: "+a);if(b===undefined)return f(a);else return h(a)?f(a):b}},set:function(b,f,
h){if(b){var i=b;b=c+l.settingsPath+"/"+b,g(b,f);if(h)return e.add("settingsDefault",d),a.PUT({module:"config/gui",appendColumns:!1,processResponse:!1,data:d})}},remove:function(a){a&&(a=c+l.settingsPath+"/"+a,i(a))},contains:function(a){return a=c+l.settingsPath+"/"+a,h(a)},load:function(){var c=function(){return a.GET({module:"config/gui",appendColumns:!1,processResponse:!1}).done(function(a){d=a!==undefined?a.data:{},e.add("settingsDefault",d)})};return e||(e=new b.SimpleCache("settings",!0)),
e.get("settingsDefault").pipe(function(a){if(a!==null)return d=a,c(),d;else return c()})},save:function(){return e.add("settingsDefault",d),a.PUT({module:"config/gui",appendColumns:!1,processResponse:!1,data:d})}};return l};return"use strict",{load:function(a,b,d){var e=c();e.settingsPath=a,e.load().done(function(){d(e)}).fail(function(){console.error("failed to load settings for:"+e.settingsPath)})}}})
define("io.ox/core/test/cacheStorage",["io.ox/core/extensions","io.ox/core/cache/indexeddb","io.ox/core/cache/localstorage","io.ox/core/cache/simple"],function(a,b,c,d){var e=5e3,f="testkey",g="ABC";"use strict";function h(){var a=function(){return a.value};return a.value=!1,a.yep=function(){a.value=!0},a}a.point("test/suite").extend({id:"core-cache-storagelayer",index:100,test:function(a){_([d,c,b]).each(function(b){a.describe("Caching Storagelayer: "+b.getStorageLayerName(),function(){b.setId("TEST"
),a.it("check storagelayer",function(){a.expect(b.isUsable()).toBeTruthy()}),a.it("clear the cache",function(){var c=new h;a.waitsFor(c,"Could not get keys",e),b.clear().done(function(b){c.yep(),a.expect(b).not.toBeDefined()}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})}),a.it("check for empty cache",function(){var c=new h;a.waitsFor(c,"Could not get keys",e),b.keys().done(function(b){c.yep(),a.expect(b).toEqual([])}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})}),a.it("get a no existent cache key "
,function(){var c=new h;a.waitsFor(c,"Could not get key",e),b.get("notexistingkey").done(function(b){c.yep(),a.expect(b).toBeNull()}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})}),a.it("set a cache key ",function(){var c=new h;a.waitsFor(c,"Could not set key",e),b.set(f,g).done(function(b){c.yep(),a.expect(b).toEqual(f)}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})}),a.it("get a cache key ",function(){var c=new h;a.waitsFor(c,"Could not set key",e),b.get(f).done(function(
b){c.yep(),a.expect(b).toEqual(g)}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})}),a.it("get all keys ",function(){var c=new h;a.waitsFor(c,"Could not get keys",e),b.keys().done(function(b){c.yep(),a.expect(b).toEqual([f])}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})}),a.it("check key existence ",function(){var c=new h;a.waitsFor(c,"Could not check key",e),b.get(f).done(function(b){c.yep(),a.expect(b).not.toBeNull()}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined(
)})}),a.it("check key removal ",function(){var c=new h;a.waitsFor(c,"Could not check key",e),b.remove(f).done(function(){c.yep(),a.expect(!0).toBeTruthy()}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})}),a.it("check for key really removed ",function(){var c=new h;a.waitsFor(c,"Could not check key",e),b.get(f).done(function(b){c.yep(),a.expect(b).toBeNull()}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})}),a.it("check for cache clearing ",function(){var c=new h;a.waitsFor(c,"Could not check key"
,e),b.clear().done(function(){c.yep(),a.expect(!0).toBeTruthy()}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})}),a.it("check for cleared cache ",function(){var c=new h;a.waitsFor(c,"Could not check key",e),b.keys().done(function(b){c.yep(),a.expect(b).toEqual([])}).fail(function(b){c.yep(),a.expect(b).not.toBeDefined()})})})}),a.describe("Storagelayer specific bugs",function(){a.it("check for localstorage exception with large datasets",function(){var b,d,f,g=new h;a.waitsFor(g,"Could not check key"
,e*3),b=1e3,d=(new Array(100)).join("AFDGsdf gDFgDSF gdfgsdgd");for(f=0;f<=b;f++)c.set("testkey"+f,d),f===b&&g.yep();a.expect(0).toEqual(0)})})}})})
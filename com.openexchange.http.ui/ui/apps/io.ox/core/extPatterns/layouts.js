define("io.ox/core/extPatterns/layouts",["io.ox/core/extensions"],function(a){var b,c,d,e={};"use strict";function f(a,b,c,d){if(b.on&&b.on[c]){if(b.isEnabled&&!b.isEnabled.apply(b,d)){if(a)return a.empty(),"remove";return"done"}if(a)return b.on[c].apply(a,_([d,b]).flatten()),"done";else return"draw"}return"done"}return b=function(b){var c=this,d=a.point(b.ref),e={};c.draw=function(){var a=$.makeArray(arguments),b=this;d.each(function(c){var d=$("<div>").addClass("row-fluid").appendTo(b);c.draw.apply
(d,a),e[c.id]=d})},c.trigger=function(){var a=$.makeArray(arguments),b=a.shift(),g=a.shift(),h=!1;d.each(function(b){if(h)return;var c=f(e[b.id],b,g,a);h=h||c==="draw"||c==="remove"}),h&&(b.empty(),c.draw.apply(b,a))},c.each=function(a){d.each(function(b){a(b,e[b.id])})},c.destroy=function(){e=null}},e.Flow=b,c=function(b){var c=this,d=a.point(b.ref),f={},g={};c.draw=function(){var a=$.makeArray(arguments),c=this;d.each(function(d){if(d.isEnabled&&!d.isEnabled.apply(d,a))return;var h=$("<div>").addClass
("io-ox-section").appendTo(c);g[d.id]=h;var i=d.metadata("title",a);i&&h.append($("<div>").addClass("io-ox-sectionTitle").text(i));if(d.draw){d.draw.apply(h,a);return}var j=d.metadata("layout",a)||"Flow",k,l;_.isString(j)||_.isArray(j)?(k=j,l={ref:b.ref+"/"+d.id}):_.isObject(j)&&(k=j.name,l=_(j.options||{}).clone().defaults({ref:b.ref+"/"+d.id}));if(_.isString(k))f[d.id]=new e[k](l),f[d.id].draw.apply(h,a);else if(_.isArray(k)){require([j.shift()],function(b){var c=j.shift();c?f[d.id]=new b[c](l)
:f[d.id]=new b(l),f[d.id].draw.apply(h,a)});return}})},c.each=function(a){_(f).each(function(b,c){a(b,g[c])})},c.trigger=function(){var a=$.makeArray(arguments),b=a.shift(),e=a.shift(),h=!1;d.each(function(b){if(h)return;var c=f[b.id],d=g[b.id],i=!0;if(b.isEnabled){i=b.isEnabled.apply(b,a);if(d&&!i){d.empty().remove();return}if(!d&&i){h=!0;return}}c&&c.trigger&&c.trigger.apply(c,_([d,e,a]).flatten())}),h&&(b.empty(),c.draw.apply(b,a))},c.destroy=function(){_(f).invoke("destroy"),f=g=null}},e.Sections=
c,d=function(b){var c=this,d=a.point(b.ref),e={};c.draw=function(){var a=$.makeArray(arguments),b=this,c,f=0,g,h,i,j;function k(){c=$("<div>").addClass("row-fluid").appendTo(b),f=12}function l(){while(h.length!==0)g.push(h.pop())}function m(a,b){return f>=b.span}function n(a,b){var d=f-b.span;b.orientation==="right"&&d>0&&($("<div>").addClass("tile span"+d).append("&nbsp;").appendTo(c),f=f-d)}function o(b,d){var g=$("<div>").addClass("span"+d.span).appendTo(c);e[b.id]=g,b.draw.apply(g,a),f=f-d.span
}g=[],d.each(function(a){g.push(a)});while(g.length!==0){f===0&&k(),h=[],i=g.shift();if(i.isEnabled&&!i.isEnabled.apply(i,a))continue;j=i.metadata("dim",a)||{span:12},j.span||(j.span=12);if(j.span>12||j.span<1)j.span=12;while(g.length!==0&&!m(i,j))h.push(i),i=g.shift(),j=i.metadata("dim",a)||{span:12};m(i,j)||k(),n(i,j),o(i,j),j.forceBreak&&k(),l()}},c.trigger=function(){var a=$.makeArray(arguments),b=a.shift(),g=a.shift(),h=!1;d.each(function(b){if(h)return;var c=f(e[b.id],b,g,a);h=h||c==="draw"||
c==="remove"}),h&&(b.empty(),c.draw.apply(b,a))},c.each=function(a){d.each(function(b){a(b,e[b.id])})},c.destroy=function(){e=null}},e.Grid=d,e})
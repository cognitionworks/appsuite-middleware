define("io.ox/core/cache/localstorage",function(){var a=null,b=null,c=0,d=1e3*60*5,e=(new Date).getTime()-2*24*60*60*1e3,f=1024*512,g={},h={setId:function(c){a=c,b=new RegExp("^"+a.replace(/\./g,"\\.")+"\\.")},getStorageLayerName:function(){return"cache/localstorage"},isUsable:function(){return Modernizr.localstorage},gc:function(a){var b=(new Date).getTime();if(b>c+d||a===!0){c=b;var f,g,i,j=[],k=0;for(f=localStorage.length-1;f>=0;f--)try{i=localStorage.key(f);try{var l=localStorage.getItem(i),m=
JSON.parse(l);!!m&&!!m.accesstime&&m.accesstime<=e&&(k++,localStorage.removeItem(i))}catch(n){console.error("GC: getItem Exception",i,f,n)}}catch(o){console.error("GC: key Exception",f,o)}k===0?a===!0&&(console.log("GC: forced -> clear current keyspace"),h.clear()):console.error("GC: removed",k)}},clear:function(){var c=0,d=localStorage.length,e,f=[];for(;c<d;c++)b.test(e=localStorage.key(c))&&f.push(e);_(f).each(function(a){localStorage.removeItem(a)});for(e in g)b.test(a+"."+e)&&delete g[a+"."+
e];return $.when()},get:function(b){var c=a+"."+b,d=localStorage.getItem(c);return d!==null?(d=JSON.parse(d),h.set(b,d.data)):c in g?d=g[c]:d={data:null},$.Deferred().resolve(d.data)},set:function(b,c){var d=new $.Deferred,e={accesstime:_.now(),data:c},i,j=a+"."+b;localStorage.removeItem(j),h.gc();try{i=JSON.stringify(e),i.length<=f?localStorage.setItem(j,i):g[j]=e,d.resolve(b)}catch(k){k.name&&k.name==="QUOTA_EXCEEDED_ERR"&&(console.warn("localStorage: Exceeded quota!",k,"Object size",Math.round
(i.length/1024)+"Kb"),h.gc(!0)),d.reject(k)}return d},remove:function(b){var c=a+"."+b;return localStorage.removeItem(c),delete g[c],$.Deferred().resolve()},keys:function(){var c,d,e,f=[];for(c=0,d=localStorage.length;c<d;c++)e=localStorage.key(c),b.test(e)&&f.push(e.substr(a.length+1));for(e in g)b.test(a+"."+e)&&f.push(e);return $.Deferred().resolve(f)}};return"use strict",h})
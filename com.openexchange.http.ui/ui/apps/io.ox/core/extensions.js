define("io.ox/core/extensions",["io.ox/core/event"],function(a){var b,c,d={},e=function(a,b){return a.index-b.index},f=function(){return Math.random()>.5?-1:+1},g={};return"use strict",$(window).on("unload",function(){_(d).each(function(a){a.clear()}),d=null}),c=function(c){this.id=String(c.id),this.description=c.description||"";var d=[],f={},h={},i=function(){return _.chain(d).select(function(a){return!h[a.id]})},j=function(a){return _(d).select(function(b){return b.id===a}).length>0},k=this;a.extend
(this);function l(a,c){return function(d,e){var f=$.makeArray(arguments).slice(2),h=c[d];if(h)if(g[d])return g[d].call(e,{args:f,extension:c,original:function(){return h.apply(e,f)},id:a.id+"/"+c.id,module:b,point:a});else return h.apply(e,f)}}this.extend=function(a){if(a.invoke)throw console.error(a),"Extensions must not have their own invoke method";if(!a.id)throw console.error(a),"Extensions must have an id!";return a.index=a.index||1e9,j(a.id)||(a.invoke=l(this,a),f[a.id]&&(_.extend(a,f[a.id]
),delete f[a.id]),d.push(a),d.sort(e),a.metadata||(a.metadata=function(a,b){if(this[a]){if(_.isFunction(this[a]))return this[a].apply(this,b);return this[a]}return undefined}),this.trigger("extended",a)),this},this.replace=function(a){if(!a.id)throw"Replacements must have an id!";var b=!1;return _(d).map(function(c){c.id===a.id&&(_.extend(c,a),b=!0)}),b?d.sort(e):f[a.id]=a,this},this.clear=function(){d=[]},this.all=function(){return d},this.keys=function(){return _(d).map(function(a){return a.id}
)},this.sort=function(){return d.sort(e),this},this.chain=function(){return i()},this.each=function(a){return i().each(a),this},this.map=function(a){return i().map(a)},this.select=function(a){return i().select(a).value()},this.inject=function(a,b){return i().inject(a,b).value()},this.invoke=function(a,b){var c=i(),d=["invoke"].concat($.makeArray(arguments));return c.invoke.apply(c,d)},this.disable=function(a){return h[a]=!0,console.log(h),this},this.enable=function(a){return delete h[a],this},this
.isEnabled=function(a){return!!h[a]},this.inspect=function(){console.debug("Extension point",this.id,JSON.stringify(this.all()))}},b={point:function(a){a=a||"";if(d[a]!==undefined)return d[a];else return d[a]=new c({id:a})},keys:function(){return _.keys(d)},getPlugins:function(a){var b=_.extend({name:ox.signin?"signin":"core",prefix:"plugins/",suffix:"register"},a),c=ox.serverConfig.plugins||{};return _(c[b.name]||[]).map(function(a){return b.prefix+a+"/"+b.suffix})},loadPlugins:function(a){return require
(this.getPlugins(a))},addWrapper:function(a,b){g[a]=b}},b})
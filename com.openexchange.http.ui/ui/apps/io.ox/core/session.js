define("io.ox/core/session",["io.ox/core/http"],function(a){var b=function(a){ox.session=a},c=function(a){ox.user=a.indexOf("@")>-1?a:a+"@"+ox.serverConfig.defaultContext},d={autoLogin:function(){return a.GET({module:"login",appendColumns:!1,appendSession:!1,processResponse:!1,timeout:3e3,params:{action:"autologin",client:"com.openexchange.ox.gui.dhtml"}}).done(function(a){ox.session=a.session,ox.user=a.user})},login:function(){var e=null;return function(f,g,h){var i=$.Deferred();if(ox.online)if(
e!==null)return e;else e=i.always(function(){e=null}),a.POST({module:"login",appendColumns:!1,appendSession:!1,processResponse:!1,params:{action:"login",name:f,password:g}}).done(function(a){b(a.session),c(f),h?d.store().done(function(){i.resolve(a)}).fail(i.reject):i.resolve(a)}).fail(i.reject);else b("offline"),c(f),i.resolve({session:ox.session,user:ox.user});return i}}(),store:function(){return a.GET({module:"login",appendColumns:!1,processResponse:!1,params:{action:"store"}})},logout:function(
){if(ox.online)return a.POST({module:"login",appendColumns:!1,processResponse:!1,params:{action:"logout"}});else return $.Deferred().resolve()}};return"use strict",d})
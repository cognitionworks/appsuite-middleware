define.async("io.ox/core/api/apps",["io.ox/core/cache","io.ox/core/event","io.ox/core/extensions"],function(a,b,c){var d=null,e={},f=function(a,b){return a=_.clone(a||{}),a.id=b,a.icon=ox.base+"/apps/io.ox/core/images/"+(a.icon||"default.png"),a.description=a.description||"Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat...",a.visible=a.visible!==!1,a},g=function(){var a={};return _(e.apps).each(function(b){var c=
b.category||"---";a[c]=(a[c]||0)+(b.visible!==!1?1:0)}),[{id:"installed",title:"Installed",count:e.installed.length,group:"Your Apps"},{id:"favorites",title:"Favorites",count:e.favorites.length,group:"Your Apps"},{id:"upgrades",title:"Upgrades",count:1,group:"Your Apps"},{id:"mockIntegration",title:"Parallels Marketplace",count:2,group:"Your Apps"}].concat(_(e.categories).map(function(b){return{id:b.toLowerCase(),title:b,count:a[b],group:"Categories"}})).concat(c.point("io.ox/core/apps/category")
.map(function(a){if(a.category)return a.metadata("category");return a}).value())},h=function(a){return _(e.apps).chain().map(function(a,b){return f(a,b)}).filter(function(b){return b.visible&&b.category.toLowerCase()===a}).value()},i=function(a){return _(e[a]).map(function(a){return f(e.apps[a],a)}).concat(c.point("io.ox/core/apps/"+a).map(function(a){if(a.app)return a.metadata("app");return a}).value())},j={get:function(a){return f(e.apps[a],a)},getCategories:g,getByCategory:h,getInstalled:function(
){return i("installed")},getFavorites:function(){return i("favorites")},isFavorite:function(a){return _(e.favorites).indexOf(a.id)>-1},markAsFavorite:function(a){_(e.favorites).indexOf(a)===-1&&(e.favorites.push(a),j.trigger("refresh.all"))},unmarkAsFavorite:function(a){var b=_(e.favorites).indexOf(a);b!==-1&&(e.favorites.splice(b,1),j.trigger("refresh.all"))}};"use strict",b.extend(j),d=new a.SimpleCache("apps",!0);function k(){return require([ox.base+"/src/userconfig.js"]).pipe(function(a){return d
.add("default",e=a)})}return d.get("default").pipe(function(a){if(a!==null)return e=a,k(),j;else return k().pipe(function(){return j})})})
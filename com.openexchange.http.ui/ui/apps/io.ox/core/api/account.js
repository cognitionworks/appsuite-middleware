define("io.ox/core/api/account",["io.ox/core/config","io.ox/core/http","io.ox/core/cache","io.ox/core/event"],function(a,b,c,d){var e,f={},g={},h=new c.ObjectCache("account",!0,function(a){return String(a.id)}),i=a.get("modules.mail.defaultseparator","/"),j=function(b){var c=_.isArray(b);b=c?b:[b];var d=/^default\d+/,e=function(b,c,e){var f="default"+b.id+i,g=c+"_fullname";if(b.id===0&&!b[g]){var h=a.get("mail.folder."+c);h||(h=a.get("mail.folder.inbox")+i+(b[c]||e)),b[g]=h}else b[g]?d.test(b[g])||
(b[g]=f+b[g]):b[g]=f+(b[c]||e)};return _(b).each(function(a){e(a,"trash","Trash"),e(a,"sent","Sent"),e(a,"drafts","Drafts"),e(a,"spam","Spam"),e(a,"confirmed_spam","Confirmed Spam"),e(a,"confirmed_ham","Confirmed Ham")}),c?b:b[0]},k=function(){ox.api.cache.folder0.setComplete("1",!1),ox.api.cache.folder1.setComplete("1",!1)},l=function(a){ox.api.cache.folder0.removeChildren(a,!0),ox.api.cache.folder0.remove(a),ox.api.cache.folder1.removeChildren(a,!0),ox.api.cache.folder1.remove(a)},m=function(){
var a=[].concat(ox.api.cache.folder0.children(1)).concat(ox.api.cache.folder1.children(1));$.each(a,function(a,b){if(ox.api.folder.is("unifiedmail",b.id))return l(b.id),!1})},n=new RegExp("^default\\d+"+i+"[^"+i+"]+"+i),o={};return"use strict",d.extend(o),o.isUnified=function(a){var b=String(a).match(/^default(\d+)/);return b?!o.isAccount(b[1]):!1},o.isAccount=function(a){return a in f},o.is=function(a,b){return g[a]===b},o.parseAccountId=function(a,b){var c,d;if(typeof a=="number")return a;else if(/^default(\d+)/
.test(String(a)))if(!o.isUnified(a))return parseInt(a.replace(/^default(\d+)(.*)$/,"$1"),10);else{c=a.replace(n,"");if(c!==a&&/^default\d+/.test(c))return o.parseAccountId(c,b);else if(!b)return 0;else return d=a.match(/^default(\d+)/),d&&d.length?parseInt(d[1],10):0}else return 0},e=new c.ObjectCache("account",!0,function(a){return String(a.id)}),o.all=function(){var a=function(){return b.GET({module:"account",params:{action:"all"},processResponse:!0})};return e.keys().pipe(function(b){if(b.length>0
)return e.values();else return a().pipe(function(a){return a=j(a),e.add(a),a})})},o.get=function(a){var b=function(){return o.all().pipe(function(){return e.get(a)})};return e.get(a,b)},o.create=function(a){return b.PUT({module:"account",params:{action:"new"},data:a}).done(function(a){o.trigger("account_created",{id:a.id,email:a.primary_address}),e.add(a,_.now())})},o.remove=function(a){return b.PUT({module:"account",params:{action:"delete"},data:a}).done(function(){e.remove(a),o.trigger("refresh.all"
)})},o.validate=function(a){return b.PUT({module:"account",appendColumns:!1,params:{action:"validate"},data:a})},o.update=function(a){return b.PUT({module:"account",params:{action:"update"},data:a}).done(function(){e.merge(a,_.now()),o.trigger("refresh.all")})},o.autoconfig=function(a){return b.GET({module:"autoconfig",params:{action:"get",email:a.email,password:a.password}})},o})
define("io.ox/core/tk/upload",["io.ox/core/event"],function(a){"use strict";function b(a){return a=a.originalEvent||a,a.clientX===0&&a.clientY===0}function c(c){var d,e,f,g,h,i,j,k,l,m;require(["less!io.ox/core/tk/upload.less"]),d=this,f=[],a.extend(this),e=$("<div/>").addClass("abs io-ox-dropzone-multiple-overlay"),j=function(){return e.appendTo("body").css({height:"100%"}),i=100/f.length,i=i+"%",_(f).each(function(a){a.css({height:i})}),!1},l=function(){return e.detach(),!1},c.actions.length<4?
g=function(){var a=$("<div>").addClass("row-fluid io-ox-dropzone-action").appendTo(e);return f.push(a),a}:g=function(){var a=$("<div>").appendTo(e).addClass("span6 io-ox-dropzone-action").css({height:"100%"});return h?(h.append(a),h=null):(h=$("<div>").addClass("row-fluid").appendTo(e),f.push(h),h.append(a)),a},_(c.actions||[]).each(function(a){var b=g();b.append($("<div>").html(a.label).center()).on({dragenter:function(){return d.trigger("dragenter",a.id,a),k&&k.removeClass("io-ox-dropzone-hover"
),b.addClass("io-ox-dropzone-hover"),k=b,!1},dragover:function(){return d.trigger("dragover",a.id,a),!1},dragend:function(){return d.trigger("dragend",a.id,a),k&&k.removeClass("io-ox-dropzone-hover"),!1},dragleave:function(){return d.trigger("dragleave",a.id,a),b.removeClass("io-ox-dropzone-hover"),!0},drop:function(b){var c,f,g;b=b.originalEvent||b,c=b.dataTransfer.files,k&&k.removeClass("io-ox-dropzone-hover"),e.detach();for(f=0,g=c.length;f<g;f++)d.trigger("drop",a.id,c[f],a);return!1}})}),m=!1
,this.remove=function(){if(!m)return;m=!1,$("body").off("dragenter",j),$("body").off("drop",l)},this.include=function(){if(m)return;m=!0,$("body").on("dragenter",j),e.on({dragenter:function(){return!1},dragover:function(){return!1},dragend:function(){return l(),!1},dragleave:function(a){return b(a)&&l(),!1},drop:function(a){return a.preventDefault(),l(),!1}})}}function d(b){var c,d=this,e=!1,f=function(){return b.appendTo("body"),!1};b?b=$(b):(e=!0,b=$("<div/>").addClass("abs").css({backgroundColor
:"#000",color:"white",textAlign:"center",paddingTop:"25%",fontSize:"42pt",opacity:"0.75",zIndex:65e3}).text("Just drop the file anywhere...")),this.enabled=!0,a.extend(this),b.on({dragenter:function(){return d.trigger("dragenter"),!1},dragover:function(){return d.trigger("dragover"),!1},dragend:function(){return d.trigger("dragend"),!1},dragleave:function(){return e&&b.detach(),d.trigger("dragleave"),!1},drop:function(a){var c,f,g;e&&b.detach(),a=a.originalEvent||a,c=a.dataTransfer.files;for(f=0,
g=c.length;f<g;f++)d.trigger("drop",c[f]);return!1}}),e?(c=!1,this.remove=function(){if(!c)return;c=!1,$("body").off("dragenter",f)},this.include=function(){if(c)return;c=!0,$("body").on("dragenter",f)}):(this.remove=$.noop,this.include=$.noop),this.include()}function e(){this.enabled=!1,this.bind=$.noop,this.unbind=$.noop,this.remove=$.noop,this.include=$.noop}function f(b){var c,d,e;b||(console.warn("No delegate supplied to file processing queue."),b={start:$.noop,stop:$.noop,processFile:function(
){return(new $.Deferred).resolve()}}),b.processFile||(console.warn("The delegate to a queue should implement a 'processFile' method!"),b.processFile=$.noop),a.extend(this),c=[],d=null,e=!1,this.nextFile=function(){var a;if(e)return;if(c.length<=0)return;e=!0,a=this,d=c.shift(),this.start(d),this.processFile(d).done(function(){e=!1,a.stop(),a.queueChanged()})},this.offer=function(a){c.push(a),this.queueChanged()},this.length=0,this.queueChanged=function(){this.length=c.length,this.trigger("changed"
,this),this.nextFile()},this.dump=function(){console.info("this",this,"files",c,"currentFile",d)},this.start=function(a){b.start&&b.start(a),this.trigger("start",a)},this.processFile=function(){return b.processFile(d)},this.stop=function(a){b.stop&&b.stop(a),this.trigger("stop",a)}}return{dnd:{enabled:Modernizr.draganddrop,createDropZone:function(a){a=a||{};if(!this.enabled)return new e(a.node);if(a.type==="multiple")return new c(a);else return new d(a.node)}},createQueue:function(a){return new f
(a)}}})
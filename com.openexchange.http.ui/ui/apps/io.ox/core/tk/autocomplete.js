define("io.ox/core/tk/autocomplete",function(){var a=$("<div>").addClass("autocomplete-popup"),b=a.scrollable();return"use strict",$.fn.autocomplete=function(c){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;return c=$.extend({minLength:1,maxResults:25,delay:100,source:null,draw:null,blur:$.noop,click:$.noop,stringify:JSON.stringify},c||{}),d=$(this),e="",f="\0",g=-1,h=!1,i=function(){var a=b.children().eq(Math.max(0,g)).data("data");e=c.stringify(a)+"",d.val(e);if(_.isFunction(c.related)){var f=c.related()
,h=c.dataHolder(),i=c.stringifyrelated(a);f.val(i),h.data(a)}},j=function(c){var d;c>=0&&c<(d=b.children()).length&&(d.removeClass("selected").eq(c).addClass("selected").intoViewport(a),g=c,i())},k=function(a){setTimeout(o,200)},l=function(a){d.off("blur",k).focus()},m=function(a){_.defer(function(){d.on("blur",k).focus()})},n=function(){if(!h){d.off("blur",c.blur).on("blur",k);var b=d.offset(),e=d.outerWidth(),f=d.outerHeight();a.css({top:b.top+f,left:b.left,width:e}).appendTo("body"),h=!0}},o=function(
){h&&(d.on("blur",c.blur).off("blur",k),b.empty(),a.detach(),h=!1,g=-1)},p=function(a){j(a.data.index),c.click.call(d.get(0),a),o()},q=function(d,e){e.length?(a.idle(),_(e.slice(0,c.maxResults)).each(function(a,e){var f=$("<div>").addClass("autocomplete-item").data("data",a).on("click",{index:e,contact:a.contact,email:a.email},p);c.draw.call(f,a,d),f.appendTo(b)}),f="\0",g=-1):(f=d,o())},r=function(a){if(h)switch(a.which){case 27:o();break;case 39:case 13:case 9:a.preventDefault(),a.shiftKey||(i(
),$(this).trigger("selected",b.children().eq(Math.max(0,g)).data("data")),o());break;case 38:a.preventDefault(),g>0&&j(g-1);break;case 40:a.preventDefault(),j(g+1)}},s=_.debounce(function(d){var g=$.trim($(this).val());g.length>=c.minLength?g!==e&&g.indexOf(f)===-1&&(e=g,b.empty(),a.busy(),n(),c.source(g).done(_.lfo(q,g))):(e=g,o())},c.delay),_.isFunction(c.source)&&_.isFunction(c.draw)&&($.each(this,function(){$(this).on("keydown",r).on("keyup",s).on("blur",c.blur).on("blur",k).attr({autocapitalize
:"off",autocomplete:"off",autocorrect:"off"})}),a.on("touchstart mousedown",l).on("touchend mouseup",m)),this},{}})
define("io.ox/core/main",["io.ox/core/desktop","io.ox/core/session","io.ox/core/http","io.ox/core/api/apps","io.ox/core/extensions","io.ox/core/date","gettext!io.ox/core/main","io.ox/core/bootstrap/basics"],function(a,b,c,d,e,f,g){var h=ox.base+"/apps/io.ox/core",i=250,j=function(){return b.logout().always(function(){$("#background_loader").fadeIn(i,function(){$("#io-ox-core").hide(),_.url.redirect("signin")})})};"use strict";function k(){var a=0,b=null;function d(){a===0&&b===null&&$("#io-ox-refresh-icon"
).removeClass("io-ox-progress")}c.on("start",function(){a===0&&(b===null&&$("#io-ox-refresh-icon").addClass("io-ox-progress"),clearTimeout(b),b=setTimeout(function(){b=null,d()},1500)),a++}),c.on("stop",function(){a=Math.max(0,a-1),d()})}function l(){if(ox.online&&ox.session!=="")try{console.debug("triggering automatic refresh ..."),ox.trigger("refresh^")}catch(a){console.error("globalRefresh()",a)}}setInterval(l,6e4*5);function m(){var b,c,f,h,m,n;$("#io-ox-topbar").append($("<div>",{id:"io-ox-top-logo-small"
})),ox.on("application:launch application:resume",function(b,c){var d=c.getName(),e=c.getId(),f=$("#io-ox-topbar"),g=$();f.find(".launcher").removeClass("active"),g=f.find(".launcher[data-app-name="+$.escape(d)+"]"),!g.length&&!(g=f.find(".launcher[data-app-id="+$.escape(e)+"]")).length&&(g=a.addLauncher("left",c.getTitle(),c.launch).attr("data-app-id",e)),g.addClass("active")}),ox.on("application:quit",function(a,b){var c=b.getId();$("#io-ox-topbar").find(".launcher[data-app-id="+$.escape(c)+"]"
).remove()}),ox.on("application:change:title",function(a,b){var c=b.getId(),d=b.getTitle();$("#io-ox-topbar").find(".launcher[data-app-id="+$.escape(c)+"]").text(d)}),a.addLauncher("right",$('<i class="icon-off icon-white">'),function(){return j()},g("Sign out")),a.addLauncher("right",$('<i class="icon-question-sign icon-white">'),void 0,g("Help")),a.addLauncher("right",$('<i class="icon-refresh icon-white">'),function(){return l(),$.Deferred().resolve()},g("Refresh")).attr("id","io-ox-refresh-icon"
),k(),b=function(b,c){var d=a.addLauncher(b.side||"left",b.title,function(){return require([b.id+"/main"],function(a){var b=a.getApp();d.attr("data-app-id",b.getId()),b.launch()})},_.isString(c)?c:void 0).attr("data-app-name",b.id)},b({id:"io.ox/settings",title:$('<i class="icon-cog icon-white">'),side:"right"},g("Settings")),a.addLauncher("left",$('<i class="icon-th icon-white">'),function(){return require(["io.ox/launchpad/main"],function(a){a.show()})}),_(d.getFavorites()).each(b),e.point("io.ox/core/desktop"
).extend({id:"upsell",draw:function(){this.append($("<div>").css({position:"absolute",width:"270px",height:"140px",right:"70px",bottom:"150px"}).append($("<div>",{id:"io-ox-welcome-upsell"}).addClass("abs").css({padding:"30px",zIndex:1}).text("Confidential! Not to be disclosed to third parties.")))}}),e.point("io.ox/core/desktop").extend({id:"welcome",draw:function(){var a,b;this.append($("<div>",{id:"io-ox-welcome"}).addClass("abs").append($("<div>").addClass("clear-title").append(_(String(ox.user
).split(/(\@)/)).inject(function(a,b,c){return a.add($("<span>").text(String(b)).addClass(c===1?"accent":""))},$()))).append(a=$("<div>").addClass("clock clear-title").text(""))),b=function(){},b(),_.every(1,"minute",b)}}),c=function(){e.point("io.ox/core/desktop").invoke("draw",$("#io-ox-desktop"),{}),c=$.noop},ox.ui.windowManager.on("empty",function(a,b){b&&c(),b?ox.ui.screens.show("desktop"):ox.ui.screens.show("windowmanager")}),location.hash===""&&(location.hash="#"+(_.getCookie("hash")||"!")
),f=$.Deferred(),h=_.url.hash("app")?_.url.hash("app").split(/,/):[],m=_(h).map(function(a){return a.split(/:/)[0]+"/main"}),$.when(e.loadPlugins(),require(m),require(["io.ox/core/api/account"]).pipe(function(a){return a.all()}),f).done(function(){_(h).each(function(a){var b=a.split(/:/),c=require(b[0]+"/main").getApp().launch(),d=b[1];d&&c.done(function(){this[d]&&this[d]()})}),ox.ui.App.restore()}),n=function(a){h.length===0&&!a&&(c(),f.resolve()),h.length||a||location.hash==="#!"?($("#background_loader"
).idle().hide(),f.resolve()):$("#background_loader").idle().fadeOut(i,f.resolve)},ox.ui.App.canRestore().done(function(a){a&&(h=[],m=[]),n(a)})}return{launch:m}})
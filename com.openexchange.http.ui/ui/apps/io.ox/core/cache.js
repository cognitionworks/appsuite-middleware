define("io.ox/core/cache",function(){var a=function(a){if(typeof a=="object"&&a)return(a.folder_id||a.folder||0)+"."+a.id;else return""},b=function(){return function(a,b,c){var d=_.extend({fluent:"simple",persistent:"localstorage"},c||{}),e=require("io.ox/core/cache/"+d.persistent),f=require("io.ox/core/cache/"+d.fluent),g,h=e.isUsable()&&_.url.hash("persistence")!=="false"&&b===!0?function(){if(ox.user!=="")return g="cache."+(ox.user||"_")+"."+(a||""),h=function(){return!0},!0;else return!1}:function(
){return!1},i=function(){var a=null;return h()?a=e:a=f,a.setId(g),a};this.clear=function(){return i().clear()},this.get=function(a){return i().get(a)},this.set=function(a,b){return i().set(a,b)},this.remove=function(a){return i().remove(a)},this.keys=function(){return i().keys()}}}(),c=function(a,c){var d=new b(a+".index",c),e=this;if(!a)throw"Each object cache needs a unique name!";this.clear=function(){return d.clear()},this.add=function(a,b,c){return c=c!==undefined?c:_.now(),d.get(a).pipe(function(
e){var f=e===null?"add modify *":"update modify *";if(e!==null)if(c>=e.timestamp)return d.set(a,{data:b,timestamp:c}).pipe(function(){return b});else return e.data;else return d.set(a,{data:b,timestamp:c}).pipe(function(){return b})})},this.get=function(a,b,c){return d.get(a).pipe(function(a){if(a!==null)return c&&c(a.data),a.data;else return b?b():null})},this.time=function(a){return d.get(a).pipe(function(a){return a!==null?a.timestamp:0})},this.remove=function(a){if(_.isArray(a)){var b=0,c=a.length
,e=[];for(;b<c;b++)e.push(d.remove(a[b]));return $.when.apply(null,e)}else return d.remove(a)},this.grepRemove=function(a){var b=0,c=0,e=new RegExp(a),f=function(a){if(e.test(a))return d.remove(a)};return d.keys().pipe(function(a){c=a.length;var d=[];for(;b<c;b++)d.push(f(a[b]));return $.when.apply(null,d)})},this.keys=function(){return d.keys()},this.grepKeys=function(a){return d.keys().done(function(b){var c=b.length,d=0,e=[],f,g=new RegExp(a);for(;d<c;d++)f=b[d],g.test(f)&&e.push(f);return e})
},this.values=function(){return d.keys().pipe(function(a){var b=0,c=a.length,e=[],f=function(a){return d.get(a).pipe(function(a){return a.data})};for(;b<c;b++)e.push(f(a[b]));return $.when.apply(null,e).pipe(function(){return _(arguments).without(null)})})},this.size=function(){return d.keys().pipe(function(a){return a.length})}},d=function(b,d,e){c.call(this,b,d),this.keyGenerator=_.isFunction(e)?e:a;var f=this.get;this.get=function(a,b){if(_.isArray(a)){var c=this,d=new $.Deferred;return $.when
.apply($,_(a).map(function(a){return c.get(a)})).done(function(){var a=_(arguments).reduce(function(a,b){return a||b===null},!1);a?b?b().done(d.resolve):d.resolve(null):d.resolve($.makeArray(arguments))}),d}else{var e;return typeof a=="string"||typeof a=="number"?e=a:e=this.keyGenerator(a),f(e,b)}};var g=this.add;this.add=function(a,b){var c;if(_.isArray(a)){b=b!==undefined?b:_.now();var d=0,e=a.length,f=this,h=function(a,b){return f.add(a,b).pipe(function(){return f.keyGenerator(a)})},i=[];for(;
d<e;d++)i.push(h(a[d],b));return $.when.apply(null,i).pipe(function(){return _(arguments).without(null)})}else return c=String(this.keyGenerator(a)),g(c,a,b).pipe(function(a){return c})},this.merge=function(a,b){var c,d,e,g=!1,h=this;if(_.isArray(a)){b=b!==undefined?b:_.now();var i=0,j=a.length,k=function(a){g=g||a},l=[];for(;i<j;i++)l.push(this.merge(a[i],b).pipe(k));return $.when.apply(null,l).pipe(function(){return g})}else return c=String(this.keyGenerator(a)),f(c).pipe(function(c){if(c!==null
){var d;for(d in c)a[d]!==undefined&&(g=g||!_.isEqual(c[d],a[d]),c[d]=a[d]);if(g)return h.add(c,b).pipe(function(a){return g});else return g}else return!1})};var h=this.remove;this.remove=function(a){var b=new $.Deferred,c=this.keyGenerator,d=function(a){if(typeof a=="string"||typeof a=="number")return a;else return String(c(a))};if(_.isArray(a)){var e=0,f=a.length,g=0,i=function(){g++,g===f&&b.resolve()},j=function(a){h(d(a)).done(i).fail(i)};for(;e<f;e++)j(a[e])}else h(d(a)).done(b.resolve).fail
(b.reject);return b}};return"use strict",window.dumpStorage=function(){var a,b=0,c=localStorage.length;for(;b<c;b++)a=localStorage.key(b),console.info("key",a,"value",JSON.parse(localStorage.getItem(a)))},{defaultKeyGenerator:a,CacheStorage:b,SimpleCache:c,ObjectCache:d}})
define("io.ox/editor/main",["io.ox/files/api","io.ox/core/api/folder","io.ox/core/tk/model","io.ox/core/tk/view","gettext!io.ox/editor/main","less!io.ox/editor/style.css"],function(a,b,c,d,e){"use strict";function f(){var f,g,h,i,j,k=ox.ui.createApp({name:"io.ox/editor",title:"SimplePad"}),l=$("<div>").addClass("container abs"),m=new c,n=new d({model:m,node:l});function o(a){a.preventDefault(),k.save()}k.setLauncher(function(){k.setWindow(f=ox.ui.createWindow({name:"io.ox/editor",title:e("Simple Pad"
),close:!0,search:!1})),f.nodes.main.addClass("io-ox-editor").append(l=l.append($("<form>").addClass("form-inline").on("submit",!1).append(h=$("<div>").addClass("header").append(n.createTextField({property:"title",wrap:!1}).find("input").attr({placeholder:e("Enter document title here"),tabindex:"1"}).on("keydown",function(a){a.which===13&&(a.preventDefault(),g.focus())}).addClass("title").parent(),$("<button>",{tabindex:3}).addClass("save btn btn-primary").text(e("Save")).on("click",o)),$("<div>"
).addClass("body").append(g=n.createTextArea({property:"content",label:!1,wrap:!1}).attr({tabindex:"2"}).on("keydown",function(a){a.which===13&&a.ctrlKey&&k.save()}).find("textarea")))))}),i=function(a){l.find(".alert").remove();var b=$.alert("",a).removeClass("alert-error").addClass("alert-success").insertAfter(h),c,d=function(){clearTimeout(c),g.off("keydown.timer"),b.remove(),b=c=d=null};c=setTimeout(d,1e4),g.on("keydown.timer",d)},j=function(a){l.find(".alert").remove(),$.alert(e("Error"),a.error
).insertAfter(h)},window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder;function p(){b.get({folder:m.get("folder_id")}).done(function(a){i(e('Document saved in folder "%1$s"',a.title)),setTimeout(function(){g.focus()})})}return k.create=function(a){var b=a||{};m.initialize({folder_id:b.folder||0,title:"",content:""}),f.show(function(){g.focus()})},k.save=function(){var b,c,d,e,h,i;f.busy(),c=g.val(),b=new window.BlobBuilder,b.append(c),d=$.trim(l.find(".title").val()),e=b.getBlob("text/plain"
),h=String(d||"text").toLowerCase()+".txt",i=m.get(),delete i.content;if(m.has("id"))return a.uploadNewVersion({json:i,file:e,filename:h}).always(f.idle).done(p).fail(j);else return a.uploadFile({json:i,file:e,filename:h}).always(f.idle).done(function(a){m.initialize($.extend(a,{content:c})),p()}).fail(j)},k.load=function(b){var c=$.Deferred();return f.show(function(){f.busy(),$.when(a.get(b).fail(j),$.ajax({type:"GET",url:a.getUrl(b,"view"),dataType:"text"})).done(function(a,b){m.initialize($.extend
(a,{content:b[0]})),l.find(".title").val($.trim(a.title)),g.val(b[0]),f.idle(),g.focus(),c.resolve()}).fail(f.idle).fail(c.reject)}),c},k.destroy=function(){n.destroy(),n=m=k=f=g=l=h=null},k.setQuit(function(){var a=$.Deferred();return m.isDirty()?require(["io.ox/core/tk/dialogs"],function(b){(new b.ModalDialog).text(e("Do you really want to quit?")).addPrimaryButton("quit",e("Yes, lose changes")).addButton("cancel",e("No")).on("quit",function(){k.destroy(),a.resolve()}).on("cancel",a.reject).show
()}):a.resolve(),a}),k}return{getApp:f}})
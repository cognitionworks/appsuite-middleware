define("io.ox/contacts/distrib/test",["io.ox/core/extensions","io.ox/contacts/main","io.ox/contacts/api"],function(a,b,c){var d={user1:{nameValue:"user1",mailValue:"user1@user1.test"},user2:{nameValue:"user2",mailValue:"user2@user2.test"},user3:{nameValue:"user3",mailValue:"user3@user3.test"}},e=function(a){a.inputName.val(a.nameValue),a.inputMail.val(a.mailValue),a.addButton.trigger("click")},f="testlist",g=5e3;"use strict";function h(){var a=function(){return a.value};return a.value=!1,a.yep=function(
){a.value=!0},a}a.point("test/suite").extend({id:"contacts-distrib",index:100,test:function(a){a.describe("Contact distrib",function(){var i,k,l,m,n,o,p,q,r,s,t=null;a.it("opens contact app ",function(){var c=new h;a.waitsFor(c,"Could not load app",g),b.getApp().launch().done(function(){t=this,t.folder.setDefault().done(function(){c.yep(),a.expect(t).toBeTruthy()})})}),a.it("looks for the create distlist button and hits ",function(){a.waitsFor(function(){i=$('[data-action="create-dist"]');if(i[0]
)return!0},"looks for the create distlist button",g),a.runs(function(){i.trigger("click")})}),a.it("checks if the createform is opend ",function(){a.waitsFor(function(){k=$(".window-content.create-distributionlist");if(k[0])return!0},"looks for the createform",g)}),a.it("looks for the form components ",function(){a.waitsFor(function(){l=k.find('input[data-type="name"]'),m=k.find('input[data-type="mail"]'),o=k.find('a[data-action="save"]'),n=k.find('a[data-action="add"]'),p=k.find('input[data-property="display_name"]'
);if(l[0]&&m[0]&&n[0]&&o[0]&&p[0])return!0},"looks for the createform components",g)}),a.it("fills the namefield ",function(){a.runs(function(){p.val(f).trigger("change")})}),a.it("fills the array with the test data ",function(){a.runs(function(){_.each(d,function(a){e({inputName:l,inputMail:m,addButton:n,nameValue:a.nameValue,mailValue:a.mailValue})})})}),a.it("hits the savebutton",function(){a.runs(function(){o.trigger("click")})}),a.it("looks for the saved item and compares",function(){a.runs(
function(){var b=this;b.ready=!1,c.on("created",function(a,c){c&&(q=c.id,s=c.folder,b.ready=!0)}),a.waitsFor(function(){return this.ready},"catches the id",g)}),a.runs(function(){c.get({id:q,folder_id:s}).done(function(a){r=a}),a.waitsFor(function(){if(r)return!0},"looks for the object",g),a.runs(function(){a.expect(r.display_name).toEqual(f),a.expect(r.distribution_list[0].display_name).toEqual(d.user1.nameValue),a.expect(r.distribution_list[0].mail).toEqual(d.user1.mailValue),a.expect(r.distribution_list
[1].display_name).toEqual(d.user2.nameValue),a.expect(r.distribution_list[1].mail).toEqual(d.user2.mailValue),a.expect(r.distribution_list[2].display_name).toEqual(d.user3.nameValue),a.expect(r.distribution_list[2].mail).toEqual(d.user3.mailValue)})})}),a.it("looks for the saved item / selects and deletes",function(){var b,c,d=s+"."+q,e=t.getGrid();a.waitsFor(function(){if(e.contains(d))return e.selection.set({folder_id:s,id:q}),!0;else return!1},"looks for the list",g),a.waitsFor(function(){b=$('table[data-obj-id="'+
d+'"] .io-ox-inline-links a[data-action="delete"]');if(b[0])return!0},"looks for delete button",g),a.runs(function(){b.trigger("click")}),a.waitsFor(function(){c=$('.io-ox-dialog-popup .btn[data-action="delete"]');if(c[0])return!0},"delete dialog to be there",g),a.runs(function(){c.trigger("click")})})})}})})
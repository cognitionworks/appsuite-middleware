define("io.ox/contacts/distrib/main",["io.ox/contacts/api","io.ox/contacts/model","io.ox/contacts/distrib/create-dist-view","gettext!io.ox/contacts/contacts","io.ox/contacts/util","less!io.ox/contacts/distrib/style.css"],function(a,b,c,d,e){"use strict";function f(){var f,g,h,i,j={byApi:!0},k=ox.ui.createApp({name:"io.ox/contacts/distrib",title:"Distribution List"});function l(){f.show(function(){g.append(i.draw().node).find("input[type=text]:visible").eq(0).focus()}),h.on("save:progress",f.busy)
.on("save:done save:fail",f.idle)}return k.create=function(g){return k.setState({folder:g}),f.setTitle(d("Create distribution list")),h=new b,i=new c({model:h}),h.store=function(b){i.node.find("#myGrowl").jGrowl("shutdown");if(!_.isEmpty(b))return b.distribution_list&&(b.distribution_list=b.distribution_list.sort(e.nameSort)),b.folder_id=g,b.mark_as_distributionlist=!0,b.display_name===""&&(b.display_name="Unnamed"),a.create(b).done(function(){j.byApi=!1,k.quit()})},l(),$.when()},k.edit=function(
g){return a.get(g).done(function(g){k.setState({folder:g.folder_id,id:g.id}),f.setTitle(d("Edit distribution list")),h=new b({data:g}),i=new c({model:h}),h.store=function(b){return i.node.find("#myGrowl").jGrowl("shutdown"),b.distribution_list&&(b.distribution_list=b.distribution_list.sort(e.nameSort)),a.edit({id:b.id,folder:b.folder_id,timestamp:_.now(),data:{display_name:b.display_name,distribution_list:b.distribution_list}}).done(function(){j.byApi=!1,k.quit()})},l()})},k.setLauncher(function(
){var a;k.setWindow(f=ox.ui.createWindow({title:"",toolbar:!0,close:!0})),g=f.nodes.main.addClass("create-distributionlist").scrollable().css({width:"700px",margin:"20px auto 20px auto"}),a=k.getState(),"id"in a?k.edit(a):"folder"in a&&k.create(a.folder)}),k.setQuit(function(){var a=$.Deferred(),b=$(".listet-item");return j.byModel=h.isDirty(),j.byModel===!0?j.byApi===!0?require(["io.ox/core/tk/dialogs"],function(c){(new c.ModalDialog).text(d("Do you really want to lose your changes?")).addButton
("cancel",d("Cancel")).addPrimaryButton("delete",d("Lose changes")).show().done(function(c){console.debug("Action",c),c==="delete"?(a.resolve(),g.find("#myGrowl").jGrowl("shutdown"),b.remove()):a.reject()})}):(g.find("#myGrowl").jGrowl("shutdown"),a.resolve(),b.remove()):(g.find("#myGrowl").jGrowl("shutdown"),a.resolve(),b.remove()),a}),k}return{getApp:f}})
define("io.ox/contacts/edit/main",["io.ox/contacts/api","io.ox/core/cache","io.ox/contacts/edit/view-form","io.ox/contacts/model","gettext!io.ox/contacts/contacts","less!io.ox/contacts/edit/style.css"],function(a,b,c,d,e){"use strict";function f(b){var f,g,h={byApi:!0},i=ox.ui.createApp({name:"io.ox/contacts/edit",title:"Edit Contact"});return i.setLauncher(function(){var j,k=ox.ui.createWindow({title:"Edit Contact",toolbar:!0,close:!0});i.setWindow(k),g=k.nodes.main.css({backgroundColor:"#fff"})
.scrollable().css({width:"600px",margin:"20px auto 20px auto"}),j=function(b){k.show(function(){var j=new d({data:b}),k=new c({model:j});f=function(){return j.dirty||j.isDirty()},j.store=function(b,c){var d=k.node.find('input[name="picture-upload-file"][type="file"]').get(0);k.node.find("#myGrowl").jGrowl("shutdown");if(d.files&&d.files[0])return a.editNewImage(b,c,d.files[0]).done(function(){h.byApi=!1,k.destroy(),i.quit()}).fail(function(a){$.alert(e("Could not save contact"),a.error).insertAfter
(k.node.find(".section.formheader"))});else return a.edit({id:b.id,folder:b.folder_id,timestamp:_.now(),data:c}).done(function(){h.byApi=!1,k.destroy(),i.quit()})},g.append(k.draw(i).node),g.find("input[type=text]:visible").eq(0).focus()})},b?(i.setState({folder:b.folder_id,id:b.id}),j(b)):a.get(i.getState()).done(j)}),i.setQuit(function(){var a=$.Deferred();return h.byModel=f(),h.byModel===!0?h.byApi===!0?require(["io.ox/core/tk/dialogs"],function(b){(new b.ModalDialog).text(e("Do you really want to lose your changes?"
)).addPrimaryButton("delete",e("Lose changes")).addButton("cancel",e("Cancel")).show().done(function(b){console.debug("Action",b),b==="delete"?(a.resolve(),g.find("#myGrowl").jGrowl("shutdown")):a.reject()})}):(a.resolve(),g.find("#myGrowl").jGrowl("shutdown")):(a.resolve(),g.find("#myGrowl").jGrowl("shutdown")),a}),i}return{getApp:f}})
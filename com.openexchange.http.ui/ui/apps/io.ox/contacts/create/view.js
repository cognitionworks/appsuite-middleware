define("io.ox/contacts/create/view",["io.ox/contacts/util","io.ox/core/tk/dialogs","io.ox/core/tk/view","gettext!io.ox/contacts/contacts","less!io.ox/contacts/style.css"],function(a,b,c,d){var e=function(a){var b=a.target.files,c=new FileReader,d=a.data.view;c.onload=function(a){d.node.find(".picture").css("background-image","url("+a.target.result+")")},c.readAsDataURL(b[0])},f=function(){$(this).closest(".io-ox-dialog-popup").find('input[type="file"]').trigger("click")},g=function(b){var c=b.data
.view,d=a.getDisplayName(this.get());c.node.find('[data-property="display_name"]').text(d)},h=function(){var b=a.getFullName(this.get());this.set("display_name",b)},i=function(a,b){var c=a.data.view;$.alert(d("Could not create contact"),b.message).insertAfter(c.node.find(".section.formheader"))},j=function(a){a.data.view.node.css("visibility","hidden").parent().busy()},k=function(a,b){var c=a.data.view;c.node.css("visibility","").parent().idle(),$.alert(d("Could not create contact"),b.error).insertAfter
(c.node.find(".section.formheader"))},l=["first_name","last_name","display_name","email1","cellular_telephone1"],m=c.extend({draw:function(){return this.node.append(this.createSection().addClass("formheader").append($("<div>").addClass("picture").css({backgroundImage:"url("+ox.base+"/apps/themes/default/dummypicture.png)",marginRight:"15px"}).on("click",f),$("<span>").addClass("text name clear-title").attr("data-property","display_name").text("Â "),this.createPicUpload().find("input").on("change",
{view:this},e).end())),_.each(l,function(a){var b=_.uniqueId("c"),c=this.getModel().schema.getFieldLabel(a);this.node.append(this.createSectionGroup().append(this.createLabel({id:b,text:d(c)}),this.createTextField({property:a,id:b})))},this),this.getModel().on("change:display_name",{view:this},g).on("change:first_name change:last_name",h).on("error:invalid",{view:this},i).on("save:progress",{view:this},j).on("save:fail",{view:this},k),this}});return"use strict",{View:m,getPopup:function(a){var c=new 
b.CreateDialog({easyOut:!0,async:!0,width:500});return c.header($("<h3>").text(d("Add new contact"))),c.getBody().addClass("create-contact").append(a.draw().node),c.addPrimaryButton("save",d("Save")).addButton("cancel",d("Cancel")),c.on("show",function(){this.getPopup().find("input[type=text]").first().focus()})}}})
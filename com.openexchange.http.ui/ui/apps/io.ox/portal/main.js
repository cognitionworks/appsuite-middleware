define.async("io.ox/portal/main",["io.ox/core/extensions","io.ox/core/config","io.ox/core/api/user","io.ox/core/date","gettext!io.ox/portal/portal","less!io.ox/portal/style.css"],function(a,b,c,d,e){var f=a.getPlugins({prefix:"plugins/portal/",name:"portal"});return"use strict",require(f).pipe(function(){var f,g=ox.ui.createApp({name:"io.ox/portal"}),h=function(){f.setTitle($($.txt(i())).add($.txt(", ")).add(c.getTextNode(b.get("identifier"))).add($.txt(" ")).add($("<small>").addClass("subtitle")
.text("("+ox.user+")")))};function i(){var a=(new d.Local).getHours();if(a>=4&&a<=11)return e("Good morning");else if(a>=18&&a<=23)return e("Good evening");else return e("Hello")}return g.setLauncher(function(){var b,c,d,e,i;g.setWindow(f=ox.ui.createWindow({toolbar:!0,titleWidth:"100%"})),h(),_.every(1,"hour",h),b=f.nodes.main.addClass("io-ox-portal").scrollable(),c=$(),d=0,e=$("<div>").addClass("io-ox-portal-column"),i=function(){var a=b.width(),f=Math.max(1,a/400>>0),g=100/f,h=$(),i,j;if(f!==d
){b.find(".io-ox-portal-widget").detach();for(i=0;i<f;i++)j=i%f===f-1,h=h.add(e.clone().css({width:g-(j?0:5)+"%",marginRight:j?"0%":"5%"}));b.empty().append(h),c.each(function(a,b){h.eq(a%f).append(b)}),d=f}},a.point("io.ox/portal/widget").extend({index:410,id:"ad",load:function(){return $.when()},draw:function(){return this.append($("<img>").attr({src:ox.base+"/apps/themes/default/ad2.jpg",alt:"ad"}).css({width:"100%",height:"auto",marginTop:"1em"})),$.when()}}),a.point("io.ox/portal/widget").each
(function(a){var b=$("<div>").addClass("io-ox-portal-widget").attr("widget-id",a.id).busy();return c=c.add(b),a.invoke("load").pipe(function(c){return(a.invoke("draw",b,c)||$.Deferred()).done(function(){b.idle(),a.invoke("post",b,a)})}).fail(function(){b.idle().remove()})}),f.on("show",function(){$(window).on("resize",i),i()}),f.on("hide",function(){$(window).off("resize",i)}),f.show()}),{getApp:g.getInstance}})})
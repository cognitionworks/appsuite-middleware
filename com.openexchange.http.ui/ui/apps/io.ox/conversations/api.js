define("io.ox/conversations/api",["io.ox/core/http","io.ox/core/api/factory","io.ox/core/config"],function(a,b){var c=b({module:"conversation",keyGenerator:function(a){return String(a.id)},requests:{all:{folder:"default"},list:{folder:"default"},get:{action:"get"}}});return"use strict",c.addMembers=function(a,b){return c.update(a,{newMembers:b||[]})},c.update=function(b,d){return a.PUT({module:"conversation",params:{action:"update",id:b},data:d||{}}).done(function(a){c.caches.get.add(a),c.caches.
list.add(a),c.trigger("refresh.list")})},c.create=function(b){var d=$.Deferred(),e=[];function f(c){return a.PUT({module:"conversation",params:{action:"new"},data:{subject:b||e.join(", "),newMembers:c}})}return require(["io.ox/core/api/user"],function(a){a.getAll().pipe(function(a){return _(a).map(function(a){return e.push(a.display_name),a.id}).sort()}).pipe(function(a){return f(a).done(function(){c.caches.all.clear(),c.trigger("refresh.all"),d.resolve()}).fail(d.reject)}).fail(d.reject)}),d},c.
getMessages=function(b,c){return a.GET({module:"conversation",params:{action:"allMessages",id:b,since:c||0}})},c.sendMessage=function(b,c){return a.PUT({module:"conversation",params:{action:"newMessage",id:b},data:{text:c}})},c})
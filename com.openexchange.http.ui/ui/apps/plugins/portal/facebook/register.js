define("plugins/portal/facebook/register",["io.ox/core/extensions","io.ox/oauth/proxy","less!plugins/portal/facebook/style.css"],function(a,b){var c=function(){var a=$(this);a.data("unfolded",!a.data("unfolded")).text(a.data("unfolded")?"Hide comments":"Show comments").parent().find(".wall-comment").toggle("fast")},d=function(a,b){return function(a){$('<div class="wall-comment">').append($('<img class="picture">').attr("src","https://graph.facebook.com/"+a.from.id+"/picture"),$('<div class="wall-comment-content">'
).append($('<a class="from">').text(a.from.name).attr("href","http://www.facebook.com/profile.php?id="+a.from.id)).append($('<div class="wall-comment-text">').text(a.message))).hide().appendTo($(b))}},e=function(a,b){return _.find(a,function(a){return a.id===b})};"use strict",a.point("io.ox/portal/widget").extend({id:"facebook",index:150,load:function(){return b.request({api:"facebook",url:"https://graph.facebook.com/fql?q="+JSON.stringify({newsfeed:"SELECT post_id, actor_id, message, type, description, likes, comments, action_links, app_data, attachment, created_time FROM stream WHERE filter_key in (SELECT filter_key FROM stream_filter WHERE uid=me() AND type = 'newsfeed') AND is_hidden = 0"
,profiles:"SELECT id, name, url, pic_square FROM profile WHERE id IN (SELECT actor_id FROM #newsfeed)"})}).pipe(JSON.parse)},draw:function(b){var f=b.data[0].fql_result_set,g=b.data[1].fql_result_set;if(!f)return this.remove(),$.Deferred().resolve();return this.append($("<div>").addClass("clear-title").text("Facebook")),_(f).each(function(b){var f=e(g,b.actor_id),h="facebook-"+b.post_id,i=$('<div class="facebook wall-entry">').attr("id",h),j=!1;i.append($('<a class="profile-picture">').attr("href"
,f.url).append($('<img class="picture">').attr("src",f.pic_square)),$('<div class="wall-post">').append($('<a class="from">').text(f.name).attr("href",f.url),$('<div class="wall-post-content">'),$('<span class="datetime">').text(new Date(b.created_time*1e3)))),a.point("plugins/portal/facebook/renderer").each(function(a){var c=i.find("div.wall-post-content");a.accepts(b)&&!j&&(a.draw.apply(c,[b]),j=!0)});if(!j)return;b.comments&&b.comments.data&&($('<a class="comment-toggle">').text("Show comments"
).on("click",c).data("unfolded",!1).appendTo(i),_(b.comments.data).each(d(b.id,i))),i.find("a").attr("target","_blank"),i.appendTo(this)},this),$.when()}}),a.point("plugins/portal/facebook/renderer").extend({id:"photo",index:128,accepts:function(a){return a.type===247},draw:function(a){var b=a.attachment.media[0];this.text(a.story||a.message).append($("<a>",{"class":"posted-image",href:b.href}).append($("<img>",{"class":"posted-image",src:b.src,alt:b.alt,title:b.alt})))}}),a.point("plugins/portal/facebook/renderer"
).extend({id:"youtube",index:128,accepts:function(a){return a.type===80&&a.attachment.caption==="www.youtube.com"},draw:function(a){var b=/[?&]v=(.+)/.exec(a.link);b?this.text(a.message).append($('<a class="video">').attr("href",a.link).append($('<img class="video-preview wall-img-left">').attr("src","http://img.youtube.com/vi/"+b[1]+"/2.jpg"),$('<span class="caption">').text(a.description))):this.text(a.message).append($("<br>"),$('<a class="video">').attr("href",a.link).append($('<span class="caption">'
).text(a.description)))}}),a.point("plugins/portal/facebook/renderer").extend({id:"status",index:128,accepts:function(a){return a.type===46},draw:function(a){this.text(a.message)}}),a.point("plugins/portal/facebook/renderer").extend({id:"link",index:196,accepts:function(a){return a.type===80},draw:function(a){var b=a.attachment.media[0];this.append($("<div>").text(a.description),$("<a>",{href:b.href}).append($('<img class="wall-img-left">',{src:b.src}),$('<span class="caption">').text(a.attachment
.description)))}}),a.point("plugins/portal/facebook/renderer").extend({id:"other_video",index:196,accepts:function(a){return a.type===128},draw:function(a){this.text(a.message)}}),a.point("plugins/portal/facebook/renderer").extend({id:"fallback",index:256,accepts:function(){return!0},draw:function(a){console.log("Please attach when reporting missing type "+a.type,a),this.html('<em style="color: red;">This message is of the type <b>'+a.type+"</b>. We do not know how to render this yet. Please tell us about it!</em>"
)}}),a.point("plugins/portal/facebook/renderer").extend({id:"app_story",index:196,accepts:function(a){return a.type===237},draw:function(a){var b=a.attachment.media[0];this.append($('<div class="message">').text(a.message),$('<a class="app-story">').attr("href",b.href).append($('<img class="wall-img-left">').attr("src",b.src),$('<span class="caption title">').text(a.attachment.name),$("<br>"),$('<span class="caption">').text(a.attachment.description)))}})})
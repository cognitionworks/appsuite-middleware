define("io.ox/core/event",function(){var a=function(a,b,c){var d=b?{data:a,fn:b}:{data:{},fn:a};return d.fn=c?$.proxy(d.fn,c):d.fn,d},b=function(b){var c=$({});this.on=function(d,e,f){var g=a(e,f,b);return c.on(d,g.data,g.fn),this},this.off=function(a,b){return c.off(a,b),this},this.one=function(d,e,f){var g=a(e,f,b);return c.one(d,g.data,g.fn),this},this.trigger=function(){var a=$.makeArray(arguments),b=a.shift(),d=c;return _(b.split(/\s+/)).each(function(b){d.triggerHandler.call(c,b,a),d.triggerHandler
.call(c,"triggered",_([b,a]).flatten())}),this},this.destroy=function(){c.off();try{delete b.events,delete b.on,delete b.off,delete b.trigger}catch(a){}c=b=null,this.on=this.off=this.one=this.trigger=null},this.list=function(){return c.data("events")}};return"use strict",b.extend=function(a){return a=a||{},a.events=new b(a),a.on=a.events.on,a.off=a.events.off,a.one=a.events.one,a.trigger=a.events.trigger,a},b.extend(ox),b}),define("io.ox/core/extensions",["io.ox/core/event"],function(a){var b,c,d=
{},e=function(a,b){return a.index-b.index},f=function(){return Math.random()>.5?-1:+1},g={};return"use strict",$(window).on("unload",function(){_(d).each(function(a){a.clear()}),d=null}),c=function(c){this.id=String(c.id),this.description=c.description||"";var d=[],f={},h={},i=function(){return _.chain(d).select(function(a){return!h[a.id]})},j=function(a){return _(d).select(function(b){return b.id===a}).length>0},k=this;a.extend(this);function l(a,c){return function(d,e){var f=$.makeArray(arguments
).slice(2),h=c[d];if(h)if(g[d])return g[d].call(e,{args:f,extension:c,original:function(){return h.apply(e,f)},id:a.id+"/"+c.id,module:b,point:a});else return h.apply(e,f)}}this.extend=function(a){if(a.invoke)throw console.error(a),"Extensions must not have their own invoke method";if(!a.id)throw console.error(a),"Extensions must have an id!";return a.index=a.index||1e9,j(a.id)||(a.invoke=l(this,a),f[a.id]&&(_.extend(a,f[a.id]),delete f[a.id]),d.push(a),d.sort(e),a.metadata||(a.metadata=function(
a,b){if(this[a]){if(_.isFunction(this[a]))return this[a].apply(this,b);return this[a]}return undefined}),this.trigger("extended",a)),this},this.replace=function(a){if(!a.id)throw"Replacements must have an id!";var b=!1;return _(d).map(function(c){c.id===a.id&&(_.extend(c,a),b=!0)}),b?d.sort(e):f[a.id]=a,this},this.clear=function(){d=[]},this.all=function(){return d},this.keys=function(){return _(d).map(function(a){return a.id})},this.sort=function(){return d.sort(e),this},this.chain=function(){return i
()},this.each=function(a){return i().each(a),this},this.map=function(a){return i().map(a)},this.select=function(a){return i().select(a).value()},this.inject=function(a,b){return i().inject(a,b).value()},this.invoke=function(a,b){var c=i(),d=["invoke"].concat($.makeArray(arguments));return c.invoke.apply(c,d)},this.disable=function(a){return h[a]=!0,console.log(h),this},this.enable=function(a){return delete h[a],this},this.isEnabled=function(a){return!!h[a]},this.inspect=function(){console.debug("Extension point"
,this.id,JSON.stringify(this.all()))}},b={point:function(a){a=a||"";if(d[a]!==undefined)return d[a];else return d[a]=new c({id:a})},keys:function(){return _.keys(d)},getPlugins:function(a){var b=_.extend({name:ox.signin?"signin":"core",prefix:"plugins/",suffix:"register"},a),c=ox.serverConfig.plugins||{};return _(c[b.name]||[]).map(function(a){return b.prefix+a+"/"+b.suffix})},loadPlugins:function(a){return require(this.getPlugins(a))},addWrapper:function(a,b){g[a]=b}},b}),define("io.ox/core/http"
,["io.ox/core/event"],function(a){var b,c,d,e,f,g,h,i,j,k,l,m={common:{1:"id",2:"created_by",3:"modified_by",4:"creation_date",5:"last_modified",20:"folder_id",100:"categories",101:"private_flag",102:"color_label",104:"number_of_attachments"},mail:{102:"color_label",600:"id",601:"folder_id",602:"attachment",603:"from",604:"to",605:"cc",606:"bcc",607:"subject",608:"size",609:"sent_date",610:"received_date",611:"flags",612:"level",613:"disp_notification_to",614:"priority",615:"msgref",651:"flag_seen"
,652:"account_name"},contacts:{500:"display_name",501:"first_name",502:"last_name",503:"second_name",504:"suffix",505:"title",506:"street_home",507:"postal_code_home",508:"city_home",509:"state_home",510:"country_home",511:"birthday",512:"marital_status",513:"number_of_children",514:"profession",515:"nickname",516:"spouse_name",517:"anniversary",518:"note",519:"department",520:"position",521:"employee_type",522:"room_number",523:"street_business",525:"postal_code_business",526:"city_business",527
:"state_business",528:"country_business",529:"number_of_employees",530:"sales_volume",531:"tax_id",532:"commercial_register",533:"branches",534:"business_category",535:"info",536:"manager_name",537:"assistant_name",538:"street_other",539:"city_other",540:"postal_code_other",541:"country_other",542:"telephone_business1",543:"telephone_business2",544:"fax_business",545:"telephone_callback",546:"telephone_car",547:"telephone_company",548:"telephone_home1",549:"telephone_home2",550:"fax_home",551:"cellular_telephone1"
,552:"cellular_telephone2",553:"telephone_other",554:"fax_other",555:"email1",556:"email2",557:"email3",558:"url",559:"telephone_isdn",560:"telephone_pager",561:"telephone_primary",562:"telephone_radio",563:"telephone_telex",564:"telephone_ttytdd",565:"instant_messenger1",566:"instant_messenger2",567:"telephone_ip",568:"telephone_assistant",569:"company",571:"userfield01",572:"userfield02",573:"userfield03",574:"userfield04",575:"userfield05",576:"userfield06",577:"userfield07",578:"userfield08",579
:"userfield09",580:"userfield10",581:"userfield11",582:"userfield12",583:"userfield13",584:"userfield14",585:"userfield15",586:"userfield16",587:"userfield17",588:"userfield18",589:"userfield19",590:"userfield20",592:"distribution_list",594:"number_of_distribution_list",596:"contains_image1",597:"image_last_modified",598:"state_other",599:"file_as",104:"number_of_attachments",601:"image1_content_type",602:"mark_as_distributionlist",605:"default_address",524:"internal_userid",606:"image1_url"},calendar
:{200:"title",201:"start_date",202:"end_date",203:"note",204:"alarm",207:"recurrence_position",208:"recurrence_date_position",209:"recurrence_type",212:"days",213:"day_in_month",214:"month",215:"interval",216:"until",220:"participants",221:"users",400:"location",401:"full_time",402:"shown_as"},infostore:{700:"title",701:"url",702:"filename",703:"file_mimetype",704:"file_size",705:"version",706:"description",707:"locked_until",708:"file_md5sum",709:"version_comment",710:"current_version",711:"number_of_versions"
},tasks:{200:"title",201:"start_date",202:"end_date",203:"note",204:"alarm",209:"recurrence_type",212:"days",213:"day_in_month",214:"month",215:"internal",216:"until",220:"participants",221:"users",300:"status",301:"percent_completed",302:"actual_costs",303:"actual_duration",305:"billing_information",307:"target_costs",308:"target_duration",309:"priority",312:"currency",313:"trip_meter",314:"companies",315:"date_completed"},folders:{1:"id",2:"created_by",3:"modified_by",4:"creation_date",5:"last_modified"
,6:"last_modified_utc",20:"folder_id",300:"title",301:"module",302:"type",304:"subfolders",305:"own_rights",306:"permissions",307:"summary",308:"standard_folder",309:"total",310:"new",311:"unread",312:"deleted",313:"capabilities",314:"subscribed",315:"subscr_subflds",316:"standard_folder_type",3010:"com.openexchange.publish.publicationFlag",3020:"com.openexchange.subscribe.subscriptionFlag",3030:"com.openexchange.folderstorage.displayName"},user:{610:"aliases",611:"timezone",612:"locale",613:"groups"
,614:"contact_id",615:"login_info"},group:{},resource:{},account:{1001:"id",1002:"login",1003:"password",1004:"mail_url",1005:"transport_url",1006:"name",1007:"primary_address",1008:"spam_handler",1009:"trash",1010:"sent",1011:"drafts",1012:"spam",1013:"confirmed_spam",1014:"confirmed_ham",1015:"mail_server",1016:"mail_port",1017:"mail_protocol",1018:"mail_secure",1019:"transport_server",1020:"transport_port",1021:"transport_protocol",1022:"transport_secure",1023:"transport_login",1024:"transport_passord"
,1025:"unified_inbox_enabled",1026:"trash_fullname",1027:"sent_fullname",1028:"drafts_fullname",1029:"spam_fullname",1030:"confirmed_spam_fullname",1031:"confirmed_ham_fullname",1032:"pop3_refresh_rate",1033:"pop3_expunge_on_quit",1034:"pop3_delete_write_through",1035:"pop3_storage ",1036:"pop3_path",1037:"personal"}};return"use strict",$.extend(m.contacts,m.common),$.extend(m.calendar,m.common),$.extend(m.infostore,m.common),delete m.infostore[101],delete m.infostore[104],$.extend(m.tasks,m.common
),$.extend(m.user,m.contacts,m.common),b={},c=function(a,b){var c=m[a]||{},d=[],e="";for(e in c)d.push(e);return d.sort(function(a,b){return a-b}),b===!0?d.join(","):d},d=function(a,b,d){if(typeof a!="object")return a;d=d!==undefined?d:c(b);var e=m[b]||{},f={},g=0,h=a.length;for(;g<h;g++){var i=e[d[g]];f[i]=a[g]}return f},e=function(a,b){var d=$.extend({module:"",params:{},data:{},dataType:"json",appendColumns:b==="GET"||b==="UPLOAD"?!1:!0,columnModule:a.module||"",appendSession:!0,processData:!0
,processResponse:!0,cursor:!0},a||{}),e;return d.type=b,d.url=ox.apiRoot+"/"+d.module,d.appendSession===!0&&(d.params.session=ox.session),d.appendColumns===!0&&d.params.columns===undefined&&(e=c(d.columnModule),e.length&&(d.params.columns=e.join(","))),d.params.columns&&d.params.columns.replace(/\s/g,""),b==="GET"||b==="POST"?d.data=d.params:b==="PUT"||b==="DELETE"?(d.url+="?"+_.serialize(d.params),d.original=d.data,d.data=typeof d.data!="string"?JSON.stringify(d.data):d.data,d.contentType="text/javascript; charset=UTF-8"
):b==="UPLOAD"&&(d.url+="?"+_.serialize(d.params),d.contentType=!1,d.processData=!1,d.processResponse=!1),d},f=function(a,b,c){if(!_.isArray(a)||!c)return a;else{var e=0,f=a.length,g=[],h,i=c.split(",");for(;e<f;e++)h=a[e],g.push(_.isArray(h)?d(h,b,i):h);return g}},g=function(a,b,d){if(b&&b.error!==undefined&&!b.data){var e=/^SES\-/i.test(b.code),g=d.module==="login"&&d.data&&d.data.action==="autologin";e&&!g?(ox.session="",ox.relogin(d,a)):a.reject(b)}else{b&&b.error!==undefined&&console.warn("TODO: warning"
);if(d.dataType==="json"&&d.processResponse===!0){var h=[],i;if(b)if(d.module==="multiple"){var j=0,k=b.length,l;for(;j<k;j++)i=b[j].timestamp!==undefined?b[j].timestamp:_.now(),b[j].data!==undefined?(l=f(b[j].data,d.data[j].columnModule,d.data[j].columns),h.push({data:l,timestamp:i}),b[j].error!==undefined&&console.warn("TODO: warning")):h.push({error:b[j],timestamp:i});a.resolve(h)}else{var m=d.params.columns||(d.processResponse===!0?c(d.columnModule,!0):"");h=f(b.data,d.columnModule,m),i=b.timestamp!==
undefined?b.timestamp:_.now(),a.resolve(h,i)}else a.resolve({},_.now())}else a.resolve(b||"")}},h=!1,i=[],j=_.url.hash("slow"),k=_.url.hash("fail"),l=function(){function c(a){var c=a.o.fixPost&&a.xhr.type==="POST",d=_.extend({},a.xhr,{dataType:c?"text":a.xhr.dataType});$.ajax(d).pipe(function(a){if(c){var b=/\((\{.*?\})\)/.exec(a);return b&&b[1]?JSON.parse(b[1]):JSON.parse(a)}else return a}).done(function(c){a.o.processData?g(a.def,c,a.o,a.o.type):a.xhr.dataType==="json"&&c.error!==undefined?a.def
.reject(c):a.def.resolve(c),b.trigger("stop done",a.xhr),a=null}).fail(function(c,d,e){a.def.reject({error:c.status+" "+(e||"general")},c),b.trigger("stop fail",a.xhr),a=null})}function d(d){var e;d.o.type==="GET"?(e=JSON.stringify(d.xhr),a[e]!==undefined?(a[e].then(d.def.resolve,d.def.reject).then(function(){b.trigger("stop done",d.xhr),d=null},function(){b.trigger("stop fail",d.xhr),d=null}),e=null):(a[e]=d.def.always(function(){delete a[e],e=null}),c(d),d=null)):(c(d),d=null)}var a={};return function(
a,c){a=e(a,c);var f,g=$.Deferred();if(h===!0)return i.push({deferred:g,options:a}),g;f={def:g,o:a,xhr:{type:c==="UPLOAD"?"POST":c,url:a.url,data:a.data,dataType:a.dataType,processData:a.processData,contentType:a.contentType!==undefined?a.contentType:"application/x-www-form-urlencoded"}},typeof a.timeout=="number"&&(f.xhr.timeout=a.timeout);function l(){k&&a.module!=="login"&&Math.random()<Number(k)?(console.error("HTTP fail",f.o.url,f.xhr),f.def.reject({error:"0 simulated fail"}),b.trigger("stop fail"
,f.xhr)):d(f),f=a=null}return b.trigger("start",f.xhr),Number(j)?setTimeout(l,250*Number(j)+(Math.random()*500>>0)):l(),g}}(),b={GET:function(a){return l(a,"GET")},POST:function(a){return l(a,"POST")},PUT:function(a){return l(a,"PUT")},DELETE:function(a){return l(a,"DELETE")},UPLOAD:function(a){return l(a,"UPLOAD")},getAllColumns:c,makeObject:d,simplify:function(a){var b=0,c=null,d=new Array(a.length);for(;c=a[b];b++)if(typeof c=="object"){d[b]={id:c.id};if(c.folder||c.folder_id)d[b].folder=c.folder||
c.folder_id;c.recurrence_position&&(d[b].recurrence_position=c.recurrence_position)}else d[b]=c;return d},fixList:function(a,c){return c.pipe(function(c){var d,e,f,g,h;a=b.simplify(a),f={},g=new Array(c.length);for(d=0;e=c[d];d++)h=String(e.internal_userid?e.internal_userid:(e.folder_id||0)+"."+(e.internal_userid||e.id)+"."+(e.recurrence_position||0)),f[h]=e;for(d=0;e=a[d];d++)h=String(typeof e=="object"?(e.folder||0)+"."+(e.internal_userid||e.id)+"."+(e.recurrence_position||0):e),g[d]=f[h];return f=
e=a=null,g})},retry:function(a){var b=(a.type||"GET").toUpperCase();return this[b](a)},pause:function(){h=!0,this.trigger("paused")},resume:function(){var a,b,c,d,e,f=$.Deferred(),g=i.slice();if(h===!0){a=0,b=g.length,e=[];for(;a<b;a++)c=g[a].options,delete c.params.session,d=$.extend(c.params,{module:c.module,data:c.original}),c.params.action!==undefined&&(d.action=c.params.action),e.push(d);i=[],h=!1,this.trigger("resumed"),e.length>0?this.PUT({module:"multiple","continue":!0,data:e,appendColumns
:!1}).done(function(c){for(a=0,b=g.length;a<b;a++)g[a].deferred.resolve(c[a]);f.resolve(c)}).fail(f.reject):f.resolve([])}else f.resolve([]);return f}},a.extend(b),b}),define("io.ox/core/cache",function(){var a=function(a){if(typeof a=="object"&&a)return(a.folder_id||a.folder||0)+"."+a.id;else return""},b=function(){return function(a,b,c){var d=_.extend({fluent:"simple",persistent:"localstorage"},c||{}),e=require("io.ox/core/cache/"+d.persistent),f=require("io.ox/core/cache/"+d.fluent),g,h=e.isUsable
()&&_.url.hash("persistence")!=="false"&&b===!0?function(){if(ox.user!=="")return g="cache."+(ox.user||"_")+"."+(a||""),h=function(){return!0},!0;else return!1}:function(){return!1},i=function(){var a=null;return h()?a=e:a=f,a.setId(g),a};this.clear=function(){return i().clear()},this.get=function(a){return i().get(a)},this.set=function(a,b){return i().set(a,b)},this.remove=function(a){return i().remove(a)},this.keys=function(){return i().keys()}}}(),c=function(a,c){var d=new b(a+".index",c),e=this
;if(!a)throw"Each object cache needs a unique name!";this.clear=function(){return d.clear()},this.add=function(a,b,c){return c=c!==undefined?c:_.now(),d.get(a).pipe(function(e){var f=e===null?"add modify *":"update modify *";if(e!==null)if(c>=e.timestamp)return d.set(a,{data:b,timestamp:c}).pipe(function(){return b});else return e.data;else return d.set(a,{data:b,timestamp:c}).pipe(function(){return b})})},this.get=function(a,b,c){return d.get(a).pipe(function(a){if(a!==null)return c&&c(a.data),a
.data;else return b?b():null})},this.time=function(a){return d.get(a).pipe(function(a){return a!==null?a.timestamp:0})},this.remove=function(a){if(_.isArray(a)){var b=0,c=a.length,e=[];for(;b<c;b++)e.push(d.remove(a[b]));return $.when.apply(null,e)}else return d.remove(a)},this.grepRemove=function(a){var b=0,c=0,e=new RegExp(a),f=function(a){if(e.test(a))return d.remove(a)};return d.keys().pipe(function(a){c=a.length;var d=[];for(;b<c;b++)d.push(f(a[b]));return $.when.apply(null,d)})},this.keys=function(
){return d.keys()},this.grepKeys=function(a){return d.keys().done(function(b){var c=b.length,d=0,e=[],f,g=new RegExp(a);for(;d<c;d++)f=b[d],g.test(f)&&e.push(f);return e})},this.values=function(){return d.keys().pipe(function(a){var b=0,c=a.length,e=[],f=function(a){return d.get(a).pipe(function(a){return a.data})};for(;b<c;b++)e.push(f(a[b]));return $.when.apply(null,e).pipe(function(){return _(arguments).without(null)})})},this.size=function(){return d.keys().pipe(function(a){return a.length})}
},d=function(b,d,e){c.call(this,b,d),this.keyGenerator=_.isFunction(e)?e:a;var f=this.get;this.get=function(a,b){if(_.isArray(a)){var c=this,d=new $.Deferred;return $.when.apply($,_(a).map(function(a){return c.get(a)})).done(function(){var a=_(arguments).reduce(function(a,b){return a||b===null},!1);a?b?b().done(d.resolve):d.resolve(null):d.resolve($.makeArray(arguments))}),d}else{var e;return typeof a=="string"||typeof a=="number"?e=a:e=this.keyGenerator(a),f(e,b)}};var g=this.add;this.add=function(
a,b){var c;if(_.isArray(a)){b=b!==undefined?b:_.now();var d=0,e=a.length,f=this,h=function(a,b){return f.add(a,b).pipe(function(){return f.keyGenerator(a)})},i=[];for(;d<e;d++)i.push(h(a[d],b));return $.when.apply(null,i).pipe(function(){return _(arguments).without(null)})}else return c=String(this.keyGenerator(a)),g(c,a,b).pipe(function(a){return c})},this.merge=function(a,b){var c,d,e,g=!1,h=this;if(_.isArray(a)){b=b!==undefined?b:_.now();var i=0,j=a.length,k=function(a){g=g||a},l=[];for(;i<j;i++
)l.push(this.merge(a[i],b).pipe(k));return $.when.apply(null,l).pipe(function(){return g})}else return c=String(this.keyGenerator(a)),f(c).pipe(function(c){if(c!==null){var d;for(d in c)a[d]!==undefined&&(g=g||!_.isEqual(c[d],a[d]),c[d]=a[d]);if(g)return h.add(c,b).pipe(function(a){return g});else return g}else return!1})};var h=this.remove;this.remove=function(a){var b=new $.Deferred,c=this.keyGenerator,d=function(a){if(typeof a=="string"||typeof a=="number")return a;else return String(c(a))};if(
_.isArray(a)){var e=0,f=a.length,g=0,i=function(){g++,g===f&&b.resolve()},j=function(a){h(d(a)).done(i).fail(i)};for(;e<f;e++)j(a[e])}else h(d(a)).done(b.resolve).fail(b.reject);return b}};return"use strict",window.dumpStorage=function(){var a,b=0,c=localStorage.length;for(;b<c;b++)a=localStorage.key(b),console.info("key",a,"value",JSON.parse(localStorage.getItem(a)))},{defaultKeyGenerator:a,CacheStorage:b,SimpleCache:c,ObjectCache:d}}),define("io.ox/core/cache/indexeddb",function(){var a,b,c,d="oxcache"
,e=String(ox.base).split("=")[1].split(".").join(""),f=window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB,g=window.IDBDatabase||window.mozIDBDatabase||window.webkitIDBDatabase,h=window.IDBKeyRange||window.webkitIDBKeyRange,i=window.IDBTransaction||window.webkitIDBTransaction,j=[],k={},l=30*60*1e3,m=2*24*60*60*1e3;"use strict";function n(a){var c,d=a.db;d.objectStoreNames.contains(b)&&d.deleteObjectStore(b),c=d.createObjectStore(b,{keyPath:"key"},!0),c.createIndex("accesstime","data.accesstime"
,{unique:!1}),d.transaction([],i.VERSION_CHANGE)}function o(a){var b,c=$.Deferred();try{_.isFunction(g.prototype.setVersion)?b=f.open(a):b=f.open(a,e,n),b.onsuccess=function(b){var d=b.target.result;j[a]=d,d.onversionchange=function(){d.close(),j[a]=d=null},c.resolve(d)},b.onerror=function(a){console.log("indexedDB.open error",a),c.reject(a)}}catch(d){console.log("opendb EXCEPTION",d),c.reject(d)}return c}function p(a){var b=new $.Deferred;return!j[a]||j[a].constuctor!==window.IDBDatabase?o(a).done
(function(a){b.resolve(a)}).fail(function(a){console.log("getConnection reject",a),b.reject(a)}):b.resolve(j[a]),b}function q(a,b){var c=new $.Deferred;return p(a).done(function(a){var d;!a.version||""+a.version!=""+e||!a.objectStoreNames.contains(b)?_.isFunction(a.setVersion)?(d=a.setVersion(e),d.onsuccess=function(){var d;a.objectStoreNames.contains(b)&&a.deleteObjectStore(b),d=a.createObjectStore(b,{keyPath:"key"},!0),d.createIndex("accesstime","accesstime",{unique:!1}),c.resolve(a)},d.onerror=
function(a){console.log("checkStore requestV error",a),c.reject(a)},d.onblocked=function(a){console.log("checkStore requestV block",a),c.reject(a)}):c.resolve(a):c.resolve(a)}).fail(function(a){console.log("checkStore reject",a),c.reject(a)}),c}function r(a,b){var c=new $.Deferred;return q(a,b).done(function(a){var d,e,f;try{d=(new Date).getTime(),e=a.transaction(b,i.READ_WRITE),e.oncomplete=function(){var a=(new Date).getTime()},e.onabort=function(){var a=(new Date).getTime()},e.onerror=function(
){var a=(new Date).getTime()},f=e.objectStore(b),c.resolve(f)}catch(g){console.log("getStore inner reject",g),c.reject(g)}}).fail(function(a){console.log("getStore reject",a),c.reject(a)}),c}function s(){return r("oxcache",b)}return c={setId:function(c){a=c,b="cache_"+a},getId:function(){return a},getStorageLayerName:function(){return"cache/indexeddb"},isUsable:function(){return Modernizr.indexeddb},gc:function(){return s().pipe(function(a){var b=k[a.name],c=_.now();if(_(b).isUndefined()||c>b+l){
k[a.name]=c,console.log("GC RUN",a.name);var d=h.upperBound(c-m),e=a.index("accesstime"),f=e.openKeyCursor(d);return f.onsuccess=function(b){var c=b.target.result;c&&(console.log("DELETE",c.primaryKey),a["delete"](c.primaryKey),c["continue"]())},f.onerror=function(a){console.log("cursor error",a)},f}else return null})},clear:function(){return s().pipe(function(a){var b=new $.Deferred,c=a.clear();return c.onsuccess=function(a){b.resolve()},c.onerror=function(){b.reject()},b})},get:function(a){return c
.gc(),s().pipe(function(b){var d=new $.Deferred;try{var e=b.get(a);e.onsuccess=function(b){_.isUndefined(b.target.result)||_.isUndefined(b.target.result.data)?d.resolve(null):(c.set(a,null,!0),d.resolve(b.target.result.data))},e.onerror=function(a){d.reject(a)}}catch(f){console.error("get exception > ",f)}return d})},set:function(a,b,d){return c.gc(),s().pipe(function(c){var e=$.Deferred(),f=c.get(a);return f.onsuccess=function(f){var g=f.target.result;if(_.isUndefined(g))if(d===!0)e.reject();else{
var h=c.add({key:a,data:b,accesstime:_.now()});h.onsuccess=function(a){e.resolve(a.target.result)},h.onerror=function(a){e.reject(a)}}else{d===!0&&(b=g.data);var i=c.put({key:a,data:b,accesstime:_.now()});i.onsuccess=function(a){e.resolve(a.target.result)},i.onerror=function(a){e.reject(a)}}},f.onerror=function(a){e.reject(a)},e})},remove:function(a){return s().pipe(function(b){var c=new $.Deferred,d=b["delete"](a);return d.onsuccess=function(a){c.resolve()},d.onerror=function(){c.reject()},c})},
keys:function(){return c.gc(),s().pipe(function(a){var b=new $.Deferred;if(_.isFunction(a.getAll)){var c=a.getAll();c.onsuccess=function(a){var c=_.chain(a.target.result).pluck("key").value();b.resolve(c)},c.onerror=function(a){b.reject()}}else{var d=[],e=a.openCursor();e.onsuccess=function(a){var c=a.target.result;c?(d.push(c.key),c["continue"]()):b.resolve(d)},e.onerror=function(a){b.reject(a)}}return b})}},c}),define("io.ox/core/cache/simple",function(){var a={},b=null;return"use strict",{setId
:function(c){b=c,_(a[b]).isUndefined()&&(a[b]={})},getStorageLayerName:function(){return"cache/simple"},isUsable:function(){return!0},gc:function(){},clear:function(){return a[b]={},$.Deferred().resolve()},get:function(c){var c=String(c);return $.Deferred().resolve(c in a[b]?a[b][c]:null)},set:function(c,d){return a[b][String(c)]=d,$.Deferred().resolve(c)},remove:function(c){return delete a[b][String(c)],$.Deferred().resolve()},keys:function(){var c,d=[];for(c in a[b])d.push(c);return $.Deferred(
).resolve(d)}}}),define("io.ox/core/cache/localstorage",function(){var a=null,b=null,c=0,d=1e3*60*5,e=(new Date).getTime()-2*24*60*60*1e3,f=1024*512,g={},h={setId:function(c){a=c,b=new RegExp("^"+a.replace(/\./g,"\\.")+"\\.")},getStorageLayerName:function(){return"cache/localstorage"},isUsable:function(){return Modernizr.localstorage},gc:function(a){var b=(new Date).getTime();if(b>c+d||a===!0){c=b;var f,g,i,j=[],k=0;for(f=localStorage.length-1;f>=0;f--)try{i=localStorage.key(f);try{var l=localStorage
.getItem(i),m=JSON.parse(l);!!m&&!!m.accesstime&&m.accesstime<=e&&(k++,localStorage.removeItem(i))}catch(n){console.error("GC: getItem Exception",i,f,n)}}catch(o){console.error("GC: key Exception",f,o)}k===0?a===!0&&(console.log("GC: forced -> clear current keyspace"),h.clear()):console.error("GC: removed",k)}},clear:function(){var c=0,d=localStorage.length,e,f=[];for(;c<d;c++)b.test(e=localStorage.key(c))&&f.push(e);_(f).each(function(a){localStorage.removeItem(a)});for(e in g)b.test(a+"."+e)&&delete 
g[a+"."+e];return $.when()},get:function(b){var c=a+"."+b,d=localStorage.getItem(c);return d!==null?(d=JSON.parse(d),h.set(b,d.data)):c in g?d=g[c]:d={data:null},$.Deferred().resolve(d.data)},set:function(b,c){var d=new $.Deferred,e={accesstime:_.now(),data:c},i,j=a+"."+b;localStorage.removeItem(j),h.gc();try{i=JSON.stringify(e),i.length<=f?localStorage.setItem(j,i):g[j]=e,d.resolve(b)}catch(k){k.name&&k.name==="QUOTA_EXCEEDED_ERR"&&(console.warn("localStorage: Exceeded quota!",k,"Object size",Math
.round(i.length/1024)+"Kb"),h.gc(!0)),d.reject(k)}return d},remove:function(b){var c=a+"."+b;return localStorage.removeItem(c),delete g[c],$.Deferred().resolve()},keys:function(){var c,d,e,f=[];for(c=0,d=localStorage.length;c<d;c++)e=localStorage.key(c),b.test(e)&&f.push(e.substr(a.length+1));for(e in g)b.test(a+"."+e)&&f.push(e);return $.Deferred().resolve(f)}};return"use strict",h}),define("io.ox/core/config",["io.ox/core/http","io.ox/core/cache"],function(a,b){var c,d={},e=function(a){var b=typeof 
a=="string"?a.split(/\./):a,c=d||{},e=0,f=b.length;for(;e<f;e++)if(c!==null&&c!==undefined&&b[e]in c)c=c[b[e]];else return null;return c},f=function(a,b){var c=typeof a=="string"?a.split(/\./):a,e=d||{},f=0,g=c.length;for(;f<g;f++)if(e[c[f]]){e=e[c[f]];if(typeof e!="object"){console.error("config.set: "+e+" is a value");return}}else e=e[c[f]]={};e[c[g-1]]=b},g=function(a){var b=typeof a=="string"?a.split(/\./):a,c=d||{},e=0,f=b.length;for(;e<f;e++)if(c!==null&&c!==undefined&&b[e]in c)c=c[b[e]];else return!1
;return!0},h=function(a){var b=typeof a=="string"?a.split(/\./):a,c=d||{},e=0,f=b.length-1;for(;e<f;e++)if(c[b[e]]){c=c[b[e]];if(typeof c!="object"){console.error("config.set: "+c+" is a value");return}}else c=c[b[e]]={};delete c[b[f]]};return"use strict",{get:function(a,b){if(!a)return d;else if(b===undefined)return e(a);else return g(a)?e(a):b},set:function(b,c,d){if(b){f(b,c);if(d)return a.PUT({module:"config/"+b,appendColumns:!1,processResponse:!1,data:c})}},remove:function(a){a&&h(a)},contains
:function(a){return g(a)},load:function(){var e=new $.Deferred,f=function(){return a.GET({module:"config",appendColumns:!1,processResponse:!1}).done(function(a){d=a!==undefined?a.data:{},c.add("default",d)})};return c||(c=new b.SimpleCache("config",!0)),c.get("default").done(function(a){a!==null?(d=a,f(),e.resolve(a)):f().done(e.resolve)}),e}}}),define("io.ox/core/session",["io.ox/core/http"],function(a){var b=function(a){ox.session=a},c=function(a){ox.user=a.indexOf("@")>-1?a:a+"@"+ox.serverConfig
.defaultContext},d={autoLogin:function(){return a.GET({module:"login",appendColumns:!1,appendSession:!1,processResponse:!1,timeout:3e3,params:{action:"autologin",client:"com.openexchange.ox.gui.dhtml"}}).done(function(a){ox.session=a.session,ox.user=a.user})},login:function(){var e=null;return function(f,g,h){var i=$.Deferred();if(ox.online)if(e!==null)return e;else e=i.always(function(){e=null}),a.POST({module:"login",appendColumns:!1,appendSession:!1,processResponse:!1,params:{action:"login",name
:f,password:g}}).done(function(a){b(a.session),c(f),h?d.store().done(function(){i.resolve(a)}).fail(i.reject):i.resolve(a)}).fail(i.reject);else b("offline"),c(f),i.resolve({session:ox.session,user:ox.user});return i}}(),store:function(){return a.GET({module:"login",appendColumns:!1,processResponse:!1,params:{action:"store"}})},logout:function(){if(ox.online)return a.POST({module:"login",appendColumns:!1,processResponse:!1,params:{action:"logout"}});else return $.Deferred().resolve()}};return"use strict"
,d}),define("io.ox/core/gettext",[],function(){var a;"use strict";if(_.url.hash("debug-i18n"))try{$(document).on("DOMAttrModified",c).on("DOMCharacterDataModified",d).on("DOMNodeInserted",e)}catch(b){console.error(b)}function c(a){a.originalEvent.attrName in{title:1,value:1}&&f(a.originalEvent.newValue,a.target)}function d(a){f(a.originalEvent.newValue,a.target)}function e(a){if(a.target.tagName in{SCRIPT:1,STYLE:1})return;b(a.target);function b(a){a.nodeType===3?f(a.data,a.parentNode):a.nodeType===1&&
_.each(a.childNodes,b)}}function f(a,b){if(h(a))return;console.error("Untranslated string",a,b),$(b).css("backgroundColor","rgba(255, 192, 0, 0.5)")}function g(a){return"​"+a+"‌"}function h(a){return/^\u200b[^\u200b\u200c]*\u200c$/.test(a)}function i(a,b){b.plural=new Function("n","return "+b.plural+";");function c(a){return a=c.pgettext("",a),arguments.length<2?a:c.format.apply(c,arguments)}_.url.hash("debug-i18n")?(c.format=function(){var a,b,c=new Array(arguments.length);for(a=0;a<arguments.length
;a++)b=String(arguments[a]),h(b)?b=b.slice(1,-1):(console.error("Untranslated printf parameter",a,b),console.trace()),c[a]=b;return g(_.printf.apply(this,c))},c.noI18n=g,c.pgettext=_.compose(g,d),c.npgettext=_.compose(g,e)):(c.format=_.printf,c.noI18n=_.identity,c.pgettext=d,c.npgettext=e),c.gettext=function(a){return c.pgettext("",a)},c.ngettext=function(a,b,d){return c.npgettext("",a,b,d)};function d(a,c){var d=a?a+"\0"+c:c;return b.dictionary[d]||c}function e(a,c,d,e){var f=(a?a+"\0":"")+c+""+
d,g=b.dictionary[f];return g?g[Number(b.plural(Number(e)))]:Number(e)!==1?d:c}return c}return a=new $.Deferred,i.setLanguage=function(b){b in ox.serverConfig.languages||(b="en_US"),i.setLanguage=function(a){if(a!==b)throw new Error("Multiple setLanguage calls")},a.resolve(b)},i.language=a.promise(),i}),define("io.ox/core/tk/selection",["io.ox/core/event"],function(a){var b=function(b){this.classFocus="focussed",this.classSelected="selected",a.extend(this);var c=this,d=!0,e=!1,f={},g=!0,h=[],i={},
j={},k=j,l=j,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C=-1,D,E;u=function(a){return e||d&&a&&a.metaKey},v=function(a){return a&&a.shiftKey&&d},E=function(){var a=0,b;for(b in f){a++;if(a>1)return!0}return!1},m=function(){var a=c.get();c.trigger("change",a),a.length===0&&c.trigger("empty")},n=function(a,b){v(b)?(c.selectRange(l,a),k=a):(t(a),k=l=a),m()},y=function(a){if(g&&h.length){var b=h[0];p(),n(b,a),c.trigger("select:first",b)}},z=function(a){if(g){var b=w(k)-1,d;b>=0&&(d=h[b],p(),n(d,a),c.trigger("select:previous"
,d))}},A=function(a){if(g&&h.length){var b=h.length-1,d=h[b];p(),n(d,a),c.trigger("select:last",d)}},B=function(a){if(g){var b=w(k)+1,d;b<h.length&&(d=h[b],p(),n(d,a),c.trigger("select:next",d))}},D=function(a){c.trigger("keyboard",a,a.which);switch(a.which){case 38:return a.metaKey?y(a):z(a),!1;case 40:return a.metaKey?A(a):B(a),!1}},o=function(a){var b,d;if(!a.isDefaultPrevented()){b=$(this).attr("data-obj-id"),d=g?h[w(b)]:b;if(d!==undefined)if(!u(a)){if(!q(d)||E()||c.serialize(d)!==c.serialize
(k))p(),n(d,a)}else n(d,a)}},w=function(a){return g?i[c.serialize(a)]:-1},x=function(a){return b.find('.selectable[data-obj-id="'+c.serialize(a)+'"]')},q=function(a){return f[c.serialize(a)]!==undefined},r=function(a){if(a){var d=c.serialize(a);f[d]=a,x(d).addClass(c.classSelected).find("input.reflect-selection").attr("checked","checked").end().intoViewport(b),k=a,C=w(a),l===j&&(l=a),c.trigger("select",d)}},s=function(a){var b=c.serialize(a);delete f[b],x(b).find("input.reflect-selection").removeAttr
("checked").end().removeClass(c.classSelected),c.trigger("deselect",b)},t=function(a){q(a)?s(a):r(a)},p=function(){var a="";for(a in f)s(a)},this.serialize=function(a){return typeof a=="object"?a.folder_id!==undefined?a.folder_id+"."+a.id:a.id:a},this.setSerializer=function(a){this.serialize=function(b){return typeof b=="object"?a(b):b}},this.init=function(a){var b=this.get();p(),h=a.slice(),i={},k=l=j;var d=0,e=a.length,f,g=!1,n=C;for(;d<e;d++)i[c.serialize(a[d])]=d;for(d=0,e=b.length;d<e;d++)f=
c.serialize(b[d]),i[f]!==undefined&&(r(b[d]),g=!0);return a.length>0&&(C=-1),!g&&n>=0&&r(h[n]),_.isEqual(b,c.get())||m(),this},this.insertAt=function(a,b){var d=a.length,e=_(a).reduce(function(a,b){return a||c.serialize(b)in i},!1);e||(h.splice.apply(h,[b,0].concat(a)),_(i).each(function(a,c){a>=b&&(i[c]+=d)}),_(a).each(function(a,d){i[c.serialize(a)]=b+d}))},this.remove=function(a){_(a).each(function(a){var b=c.serialize(a),d=i[b];d!==undefined&&h.splice(d,1,null)}),h=_(h).compact(),i={},_(h).each
(function(a,b){i[c.serialize(a)]=b})},this.update=function(){var a=b.find(".selectable"),d=0,e=a.length,f=null;for(;d<e;d++)f=$(a[d]),q(f.attr("data-obj-id"))?f.find("input.reflect-selection").attr("checked","checked").end().addClass(c.classSelected):f.find("input.reflect-selection").removeAttr("checked");return this},this.clearIndex=function(){return h=[],i={},this},this.addToIndex=function(a){var b=this.serialize(a);return i[b]===undefined&&(i[b]=h.length,h.push(a)),this},this.hasIndex=function(
a){return g=!!a,this},this.setMultiple=function(a){return d=!!a,this},this.setEditable=function(a){return e=!!a,k=l=j,C=-1,this},this.get=function(){var a=[],b="";for(b in f)a.push(f[b]);return a},this.unfold=this.get,this.clear=function(a){return p(),a!==!0&&(c.trigger("clear"),m()),this},this.select=function(a){return r(a),m(),this},this.set=function(a,b){return p(),_(_.isArray(a)?a:[a]).each(function(a){var b;typeof a=="string"&&g&&(b=h[w(a)])!==undefined?r(b):r(a)}),b!==!0&&m(),this},this.equals=
function(a){return _.isEqual(a,this.get())},this.selectRange=function(a,b){if(g){a=w(a),b=w(b);if(a>b){var c=a;a=b,b=c}for(;a<=b;a++)r(h[a]);m()}return this},this.selectFirst=function(){return y(),this},this.selectSmart=function(){return this.get().length===0&&this.selectFirst(),this},this.selectNext=B,this.isSelected=function(a){return q(a)},this.getIndex=function(a){return w(a)},this.keyboard=function(a){return $(document)[a?"on":"off"]("keydown",D),this},this.retrigger=function(a){if(a){var b=
this.get();this.clear(),this.set(b)}else m()},this.retriggerUnlessEmpty=function(){this.get().length&&m()},this.destroy=function(){this.clear(),this.keyboard(!1),this.events.destroy(),b.off("click contextmenu"),f=h=i=k=null},b.on("click contextmenu",".selectable",o)};return"use strict",b.extend=function(a,c){return a.selection=new b(c)},b}),define("io.ox/core/tk/model",["io.ox/core/event"],function(a){var b,c,d=function(a,b){this.properties=_.isArray(a)?a:[a],this.message=b},e=/^([a-zA-Z0-9_\.\-])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/
,f={string:function(){return!0},text:function(){return!0},number:function(a,b,c){var e=/^\d+$/;return e.test(b)||new d(a,_.printf("%s must be a number",c.i18n||a))},array:function(a,b,c){return _.isArray(b)||new d(a,_.printf("%s must be an array",c.i18n||a))},"boolean":function(a,b,c){return _.isBoolean(b)||new d(a,_.printf("%s must be bool",c.i18n||a))},date:function(){return!0},pastDate:function(a,b,c){if(_.isString(b))return new d(a,_.printf("%s is not a valide date",c.i18n||a));return _.now()>
b||new d(a,_.printf("%s must be in the past",c.i18n||a))},email:function(a,b,c){return e.test(b)||new d(a,_.printf("%s must be a valid email address",c.i18n||a))},url:function(){return!0}},g=function(a,b){if(a===""&&b===undefined)return!0;else return _.isEqual(a,b)},h=function(a){this._definitions=a||{}};return"use strict",h.prototype={formats:f,get:function(a){return this._definitions[a]||{}},getDefaults:function(){var a={};return _(this._definitions).each(function(b,c){b.defaultValue!==undefined&&
(a[c]=b.defaultValue)}),a},getMandatories:function(){var a=[];return _(this._definitions).each(function(b,c){b.mandatory&&a.push(c)}),a},isMandatory:function(a){return!!this.get(a).mandatory},getFieldType:function(a){return this.get(a).format},getFieldLabel:function(a){return this.get(a).label},isTrimmed:function(a){return this.get(a).trim!==!1},validate:function(a,b){var c=this.get(a),e=c.format||"string",f=b===""||b===null,g=c.mandatory!==!0;if(f)return g||new d(a,_.printf("%s is mandatory",c.i18n||
a));if(_.isFunction(this.formats[e]))return this.formats[e](a,b,c);console.error("Unknown format used in model schema",e)},check:function(){return $.when()}},c=function(a){_(this._computed).each(function(b,d){if(_(b.deps).indexOf(a)>-1){var e=this._memoize[d],f=this.get(d);_.isEqual(e,f)||(this.trigger("change:"+d,d,f),c.call(this,d))}},this)},b=function(b){b=b||{},this._data={},this._previous={},this._defaults=this.schema.getDefaults(),this._memoize={},this.cid=_.uniqueId("c"),a.extend(this),this
.initialize(b.data||b||{})},b.addComputed=function(a,b,c){return c||(c=b,b=[]),a&&_.isFunction(c)&&(this.prototype._computed[a]={deps:b,callback:c}),this},b.prototype={_computed:{},idAttribute:"id",schema:new h,initialize:function(a){this._previous=_.copy(a||{},!0),this._data=_.extend({},this._defaults,_.copy(a||{},!0)),this.idAttribute in this._data&&(this.id=this._data[this.idAttribute]),_(this._computed).each(function(a,b){this.get(b)},this)},isEmpty:function(a){var b=this._data[a];return b===""||
b===undefined||b===null},has:function(a){return a in this._data},get:function(a){var b,c,d;if(a===undefined)return _.copy(this._data,!0);else if(this._computed[a]===undefined)return _.copy(this._data[a],!0);else return b=this._computed[a],c=_(b.deps).map(this.get,this),d=b.callback.apply(this,c),this._memoize[a]=d},set:function(a,b){var d;if(a===undefined)return;_.isString(b)&&this.schema.isTrimmed(a)&&(b=$.trim(b));if(g(b,this._data[a]))return;d=this.schema.validate(a,b),this._data[a]=b,d!==!0&&
this.trigger("error:invalid",d),this.trigger("change:"+a+" change",a,b),c.call(this,a)},isDirty:function(){var a,b,c,d=this._previous,e=this._defaults;for(a in this._data){b=this._data[a],c=!g(b,d[a])&&!_.isEqual(b,e[a]);if(c)return!0}return!1},getChanges:function(){var a={},b=this._previous;return _(this._data).each(function(c,d){g(c,b[d])||(a[d]=_.copy(c,!0))}),a},toString:function(){return JSON.stringify(this._data)},toJSON:function(){return this.toString()},setData:function(a){console.warn("DEPRECATED: setData - use initialize()"
),this.init(a)},getData:function(){return console.warn("DEPRECATED: getData - use get()"),_.copy(this._data,!0)},_validate:function(){return!0},getDefinition:function(a){return console.warn("DEPRECATED: getDefinition -> schema.get()"),this.schema.get(a)},validate:function(a,b){return console.warn("DEPRECATED: validate -> schema.validate()"),this.schema.validate(a,b)},check:function(a,b){return console.warn("DEPRECATED: check -> schema.check()"),this.schema.check(a,b)},isMandatory:function(a){return console
.warn("DEPRECATED: isMandatory"),this.schema.isMandatory(a)},isTrimmed:function(a){return console.warn("DEPRECATED: isTrimmed"),this.schema.isTrimmed(a)},save:function(){var a=function(a,b,c){var d=this.schema.validate(c,b);if(d!==!0)return this.trigger("error:invalid",d),!1;else return a},b=function(){var a=$.Deferred().notify(),b=this;return this.trigger("save:progress"),(this.store(this.get(),this.getChanges())||$.when()).done(function(){"trigger"in b&&(b.initialize(b._data),b.trigger.apply(b,
["save:beforedone"].concat($.makeArray(arguments))),b.trigger.apply(b,["save:done"].concat($.makeArray(arguments)))),a.resolve.apply(a,arguments)}).fail(function(){"trigger"in b&&(b.trigger.apply(b,["save:beforefail"].concat($.makeArray(arguments))),b.trigger.apply(b,["save:fail"].concat($.makeArray(arguments)))),a.reject.apply(a,arguments)}),a},c=function(a){return this.trigger("error:inconsistent",a),a};return function(){var e;_(this.schema.getMandatories()).each(function(a){a in this._data||(this
._data[a]="")},this);if(!_(this._data).inject(a,!0,this))return $.Deferred().reject();return e=this.schema.check(this._data,d),_.isFunction((e||{}).promise)||(e=typeof e=="object"?$.Deferred().reject(e):$.when()),e.pipe(_.bind(b,this),_.bind(c,this))}}(),store:function(){},destroy:function(){this.events.destroy(),this._data=null,this._previous=null,this._defaults=null,this._memoize=null}},_.makeExtendable(b),b.Schema=h,b}),define("io.ox/core/tk/upload",["io.ox/core/event"],function(a){"use strict"
;function b(a){return a=a.originalEvent||a,a.clientX===0&&a.clientY===0}function c(c){var d,e,f,g,h,i,j,k,l,m;require(["less!io.ox/core/tk/upload.less"]),d=this,f=[],a.extend(this),e=$("<div/>").addClass("abs io-ox-dropzone-multiple-overlay"),j=function(){return e.appendTo("body").css({height:"100%"}),i=100/f.length,i=i+"%",_(f).each(function(a){a.css({height:i})}),!1},l=function(){return e.detach(),!1},c.actions.length<4?g=function(){var a=$("<div>").addClass("row-fluid io-ox-dropzone-action").appendTo
(e);return f.push(a),a}:g=function(){var a=$("<div>").appendTo(e).addClass("span6 io-ox-dropzone-action").css({height:"100%"});return h?(h.append(a),h=null):(h=$("<div>").addClass("row-fluid").appendTo(e),f.push(h),h.append(a)),a},_(c.actions||[]).each(function(a){var b=g();b.append($("<div>").html(a.label).center()).on({dragenter:function(){return d.trigger("dragenter",a.id,a),k&&k.removeClass("io-ox-dropzone-hover"),b.addClass("io-ox-dropzone-hover"),k=b,!1},dragover:function(){return d.trigger
("dragover",a.id,a),!1},dragend:function(){return d.trigger("dragend",a.id,a),k&&k.removeClass("io-ox-dropzone-hover"),!1},dragleave:function(){return d.trigger("dragleave",a.id,a),b.removeClass("io-ox-dropzone-hover"),!0},drop:function(b){var c,f,g;b=b.originalEvent||b,c=b.dataTransfer.files,k&&k.removeClass("io-ox-dropzone-hover"),e.detach();for(f=0,g=c.length;f<g;f++)d.trigger("drop",a.id,c[f],a);return!1}})}),m=!1,this.remove=function(){if(!m)return;m=!1,$("body").off("dragenter",j),$("body")
.off("drop",l)},this.include=function(){if(m)return;m=!0,$("body").on("dragenter",j),e.on({dragenter:function(){return!1},dragover:function(){return!1},dragend:function(){return l(),!1},dragleave:function(a){return b(a)&&l(),!1},drop:function(a){return a.preventDefault(),l(),!1}})}}function d(b){var c,d=this,e=!1,f=function(){return b.appendTo("body"),!1};b?b=$(b):(e=!0,b=$("<div/>").addClass("abs").css({backgroundColor:"#000",color:"white",textAlign:"center",paddingTop:"25%",fontSize:"42pt",opacity
:"0.75",zIndex:65e3}).text("Just drop the file anywhere...")),this.enabled=!0,a.extend(this),b.on({dragenter:function(){return d.trigger("dragenter"),!1},dragover:function(){return d.trigger("dragover"),!1},dragend:function(){return d.trigger("dragend"),!1},dragleave:function(){return e&&b.detach(),d.trigger("dragleave"),!1},drop:function(a){var c,f,g;e&&b.detach(),a=a.originalEvent||a,c=a.dataTransfer.files;for(f=0,g=c.length;f<g;f++)d.trigger("drop",c[f]);return!1}}),e?(c=!1,this.remove=function(
){if(!c)return;c=!1,$("body").off("dragenter",f)},this.include=function(){if(c)return;c=!0,$("body").on("dragenter",f)}):(this.remove=$.noop,this.include=$.noop),this.include()}function e(){this.enabled=!1,this.bind=$.noop,this.unbind=$.noop,this.remove=$.noop,this.include=$.noop}function f(b){var c,d,e;b||(console.warn("No delegate supplied to file processing queue."),b={start:$.noop,stop:$.noop,processFile:function(){return(new $.Deferred).resolve()}}),b.processFile||(console.warn("The delegate to a queue should implement a 'processFile' method!"
),b.processFile=$.noop),a.extend(this),c=[],d=null,e=!1,this.nextFile=function(){var a;if(e)return;if(c.length<=0)return;e=!0,a=this,d=c.shift(),this.start(d),this.processFile(d).done(function(){e=!1,a.stop(),a.queueChanged()})},this.offer=function(a){c.push(a),this.queueChanged()},this.length=0,this.queueChanged=function(){this.length=c.length,this.trigger("changed",this),this.nextFile()},this.dump=function(){console.info("this",this,"files",c,"currentFile",d)},this.start=function(a){b.start&&b.
start(a),this.trigger("start",a)},this.processFile=function(){return b.processFile(d)},this.stop=function(a){b.stop&&b.stop(a),this.trigger("stop",a)}}return{dnd:{enabled:Modernizr.draganddrop,createDropZone:function(a){a=a||{};if(!this.enabled)return new e(a.node);if(a.type==="multiple")return new c(a);else return new d(a.node)}},createQueue:function(a){return new f(a)}}}),define("io.ox/core/api/factory",["io.ox/core/http","io.ox/core/cache","io.ox/core/event"],function(a,b,c){var d=function(a){
var b=_.copy(a,!0);return b.folder=b.folder||b.folder_id,b},e="id: folder_id:folder folder: recurrence_position:".split(" ");return"use strict",function(f){var g,h,i;return f=$.extend(!0,{id:null,keyGenerator:null,module:"",requests:{all:{action:"all"},list:{action:"list"},get:{action:"get"},search:{action:"search"},remove:{action:"delete"}},done:{},fail:{},pipe:{},filter:null},f||{}),f.id=f.id||f.module,g={all:new b.SimpleCache(f.id+"-all",!0),list:new b.ObjectCache(f.id+"-list",!0,f.keyGenerator
),get:new b.ObjectCache(f.id+"-get",!0,f.keyGenerator)},h={},i={getAll:function(b,c,d){var e=$.extend({},f.requests.all,b||{}),j=e.folder+"\t"+(e.sortKey||e.sort)+"."+e.order+"."+e.limit;c=c===undefined?!0:!!c,d=d||g.all;var k=function(){return a.GET({module:f.module,params:e}).pipe(function(a){return(f.pipe.all||_.identity)(a,e)}).done(function(a){d.add(j,a)})},l=function(a){j in h||(h[j]=!0,setTimeout(function(){i.refresh()},3e3))};return(c?d.get(j,k,l):k()).pipe(f.pipe.allPost).done(f.done.all||
$.noop)},getList:function(b,c){b=b?[].concat(b):[],f.filter&&(b=_(b).filter(f.filter)),c=c===undefined?!0:!!c;var d=function(){return a.fixList(b,a.PUT({module:f.module,params:f.requests.list,data:a.simplify(b)})).pipe(function(a){return(f.pipe.list||_.identity)(a)}).done(function(a){g.list.add(a),g.get.merge(a)})};if(b.length===0)return $.Deferred().resolve([]).done(f.done.list||$.noop);else return(c?g.list.get(b,d):d()).pipe(f.pipe.listPost).done(f.done.list||$.noop)},get:function(b,c){var e=$.
extend({},f.requests.get,b);c=c===undefined?!0:!!c;var h=function(){return a.GET({module:f.module,params:d(e)}).pipe(function(a){return(f.pipe.get||_.identity)(a,e)}).done(function(a){g.get.add(a),g.list.merge(a).done(function(b){b&&i.trigger("refresh.list",a)})}).fail(function(a){_.call(f.fail.get,a,e,f)})};return(c?g.get.get(e,h):h()).pipe(f.pipe.getPost).done(f.done.get||$.noop)},updateCachesAfterRemove:function(a){a=a||[],a=_.isArray(a)?a:[a];var c={},d={},e=b.defaultKeyGenerator;_(a).each(function(
a){c[e(a)]=d[a.folder_id]=!0}),console.log("updateCachesAfterRemove",a,c);var f=_(d).map(function(a,b){var d=g.all;return d.grepKeys(b+"\t").pipe(function(a){return d.get(a).pipe(function(b){if(b)return d.add(a,_(b).filter(function(a){return c[e(a)]!==!0}));else return $.when()})})});return a.length&&(f.push(g.list.remove(a)),f.push(g.get.remove(a))),$.when.apply($,f).done(function(){c=d=f=null})},prepareRemove:function(a){return $.when()},remove:function(b,c){b=b||[],b=_.isArray(b)?b:[b];var d=$
.extend({},f.requests.remove,{timestamp:_.now()}),e=a.simplify(b),g=function(){i.trigger("delete",b)};return i.trigger("beforedelete",b),i.prepareRemove(b).pipe(function(){return console.log("remove -> updateCachesAfterRemove",b),i.updateCachesAfterRemove(b).pipe(function(){i.trigger("refresh.all");if(c!==!0)return a.PUT({module:f.module,params:d,data:e,appendColumns:!1}).done(g);else return g()})})},needsRefresh:function(a,b,c){return g.all.keys(a+"\t"+b+"."+c).pipe(function(a){return a!==null})
},reduce:function(a){return a?_(e).reduce(function(b,c){var d=c.split(":"),e=d[0],f=d[1]||d[0];return e in a&&(b[f]=a[e]),b},{}):a},caches:g},f.requests.search&&(i.search=function(b,c){var d=$.extend({},f.requests.search,c||{}),e=d.getData;return delete d.getData,a.PUT({module:f.module,params:d,data:e(b)})}),c.extend(i),i.refresh=function(){ox.online&&(i.caches.all.clear(),i.caches.list.clear(),i.trigger("refresh.all"))},ox.on("refresh^",function(){i.refresh()}),i}}),define("io.ox/core/api/user",
["io.ox/core/http","io.ox/core/api/factory"],function(a,b){var c=b({module:"user",keyGenerator:function(a){return String(a.id)},requests:{all:{columns:"1,20,500",sort:"500",order:"asc"},list:{action:"list",columns:"1,20,500,524"},get:{action:"get"},search:{action:"search",columns:"1,20,500,524",sort:"500",order:"asc",getData:function(a){return{pattern:a}}}}});return"use strict",c.getTextNode=function(a){var b=document.createTextNode("");return c.get({id:a}).done(function(a){b.nodeValue=a.display_name||
a.email1}).always(function(){_.defer(function(){b=null})}),b},c.getLink=function(a,b){var d=b?$.txt(b):c.getTextNode(a);return $("<a>",{href:"#"}).append(d).on("click",function(b){b.preventDefault(),require(["io.ox/core/extensions"],function(c){c.point("io.ox/core/person:action").each(function(c){_.call(c.action,{internal_userid:a},b)})})})},c.getPictureURL=function(a){return $.when(c.get({id:a}),require(["io.ox/contacts/api"])).pipe(function(a,b){return b.getPictureURL(a[0]||a)},function(){return ox
.base+"/apps/themes/default/dummypicture.png"})},c.getPicture=function(a){var b=$("<div>"),d=function(){_.defer(function(){b=d=null})};return c.getPictureURL(a).done(function(a){b.css("backgroundImage","url("+a+")")}).always(d),b},c}),define("io.ox/core/api/resource",["io.ox/core/http","io.ox/core/api/factory"],function(a,b){var c=b({module:"resource",keyGenerator:function(a){return String(a.id)},requests:{all:{},list:{},get:{},search:{action:"search",getData:function(a){return{pattern:a}}}}});return"use strict"
,c}),define("io.ox/core/api/group",["io.ox/core/http","io.ox/core/api/factory"],function(a,b){var c=b({module:"group",keyGenerator:function(a){return String(a.id)},requests:{all:{columns:"1,20",sort:"500",order:"asc"},list:{},get:{},search:{action:"search",columns:"1,20,500,524",sort:"500",order:"asc",getData:function(a){return{pattern:a}}}}});return"use strict",c.getTextNode=function(a){var b=document.createTextNode("");return c.get({id:a}).done(function(a){b.nodeValue=a.display_name}).always(function(
){_.defer(function(){b=null})}),b},c}),define("io.ox/core/api/account",["io.ox/core/config","io.ox/core/http","io.ox/core/cache","io.ox/core/event"],function(a,b,c,d){var e,f={},g={},h=new c.ObjectCache("account",!0,function(a){return String(a.id)}),i=a.get("modules.mail.defaultseparator","/"),j=function(b){var c=_.isArray(b);b=c?b:[b];var d=/^default\d+/,e=function(b,c,e){var f="default"+b.id+i,g=c+"_fullname";if(b.id===0&&!b[g]){var h=a.get("mail.folder."+c);h||(h=a.get("mail.folder.inbox")+i+(
b[c]||e)),b[g]=h}else b[g]?d.test(b[g])||(b[g]=f+b[g]):b[g]=f+(b[c]||e)};return _(b).each(function(a){e(a,"trash","Trash"),e(a,"sent","Sent"),e(a,"drafts","Drafts"),e(a,"spam","Spam"),e(a,"confirmed_spam","Confirmed Spam"),e(a,"confirmed_ham","Confirmed Ham")}),c?b:b[0]},k=function(){ox.api.cache.folder0.setComplete("1",!1),ox.api.cache.folder1.setComplete("1",!1)},l=function(a){ox.api.cache.folder0.removeChildren(a,!0),ox.api.cache.folder0.remove(a),ox.api.cache.folder1.removeChildren(a,!0),ox.api
.cache.folder1.remove(a)},m=function(){var a=[].concat(ox.api.cache.folder0.children(1)).concat(ox.api.cache.folder1.children(1));$.each(a,function(a,b){if(ox.api.folder.is("unifiedmail",b.id))return l(b.id),!1})},n=new RegExp("^default\\d+"+i+"[^"+i+"]+"+i),o={};return"use strict",d.extend(o),o.isUnified=function(a){var b=String(a).match(/^default(\d+)/);return b?!o.isAccount(b[1]):!1},o.isAccount=function(a){return a in f},o.is=function(a,b){return g[a]===b},o.parseAccountId=function(a,b){var c
,d;if(typeof a=="number")return a;else if(/^default(\d+)/.test(String(a)))if(!o.isUnified(a))return parseInt(a.replace(/^default(\d+)(.*)$/,"$1"),10);else{c=a.replace(n,"");if(c!==a&&/^default\d+/.test(c))return o.parseAccountId(c,b);else if(!b)return 0;else return d=a.match(/^default(\d+)/),d&&d.length?parseInt(d[1],10):0}else return 0},e=new c.ObjectCache("account",!0,function(a){return String(a.id)}),o.all=function(){var a=function(){return b.GET({module:"account",params:{action:"all"},processResponse
:!0})};return e.keys().pipe(function(b){if(b.length>0)return e.values();else return a().pipe(function(a){return a=j(a),e.add(a),a})})},o.get=function(a){var b=function(){return o.all().pipe(function(){return e.get(a)})};return e.get(a,b)},o.create=function(a){return b.PUT({module:"account",params:{action:"new"},data:a}).done(function(a){o.trigger("account_created",{id:a.id,email:a.primary_address}),e.add(a,_.now())})},o.remove=function(a){return b.PUT({module:"account",params:{action:"delete"},data
:a}).done(function(){e.remove(a),o.trigger("refresh.all")})},o.validate=function(a){return b.PUT({module:"account",appendColumns:!1,params:{action:"validate"},data:a})},o.update=function(a){return b.PUT({module:"account",params:{action:"update"},data:a}).done(function(){e.merge(a,_.now()),o.trigger("refresh.all")})},o.autoconfig=function(a){return b.GET({module:"autoconfig",params:{action:"get",email:a.email,password:a.password}})},o}),define("io.ox/core/api/folder",["io.ox/core/http","io.ox/core/cache"
,"io.ox/core/config","io.ox/core/api/account","io.ox/core/event"],function(a,b,c,d,e){var f=new b.SimpleCache("folder",!0),g=new b.SimpleCache("subfolder",!0),h=new b.SimpleCache("visible-folder",!0),i=function(a,b){return a>>b&(b>=28?1:127)},j=function(b,c){c=c||{};var d=c.storage||f,e=function(){return a.GET({module:"folders",params:{action:"get",id:b,tree:"1"}}).done(function(a,b){d.add(a.id,a)}).fail(function(a){console.error("folder.get",b,a)})};return c.cache===!1?e():d.get(b,e)},k={get:function(
a){var b=_.extend({folder:"1",event:!1,cache:!0,storage:null},a||{}),c={};if(_.isArray(b.folder))return $.when.apply(null,_(b.folder).map(function(a){var d=$.Deferred();return a!==undefined?j(a,b).done(function(b){c[String(a)]=b}).always(function(){d.resolve()}):d.resolve(),d})).pipe(function(){return c});else return j(b.folder,b)},getSubFolders:function(b){var c=_.extend({folder:"1",all:!1,event:!1,cache:!0,storage:null},b||{}),d=c.storage||g,e=function(){return a.GET({module:"folders",params:{action
:"list",parent:c.folder,tree:"1",all:c.all?"1":"0"},appendColumns:!0}).done(function(a,b){d.add(c.folder,a),_(a).each(function(a){f.add(a.id,a)})}).fail(function(a){console.error("folder.getSubFolders",c.folder,a)})};return c.cache===!1?e():d.get(c.folder,e)},getPath:function(a){var b=_.extend({folder:"1",event:!1,cache:!0,storage:null},a||{}),c=b.storage||f,d=$.Deferred(),e=[],g=function(a){c.get(a).done(function(a){a!==null})};return g(b.folder)},getVisible:function(b){var d=_.extend({type:"mail"
,cache:!0},b||{}),e=function(){return a.GET({module:"folders",appendColumns:!0,params:{tree:"1",action:"allVisible",content_type:d.type}}).pipe(function(b,e){var g,h,i={},j=String(c.get("folder."+d.type,0)),l=function(b){return a.makeObject(b,"folders")},m=function(a){return k.can("read",a)},n=function(a){return f.add(a,e),a},o=function(a,b){return a.id===j?-1:a.title.toLowerCase()>b.title.toLowerCase()?+1:-1};for(g in b)h=_.chain(b[g]).map(l).filter(m).map(n).value(),h.length>0&&(g!=="shared"&&h
.sort(o),i[g]=h);return i}).done(function(a){h.add(d.type,a)})};return d.cache===!1?e():h.get(d.type,e)},create:function(b){var d=$.extend({folder:"1",tree:"1",event:!0},b||{});return d.data=$.extend({module:"mail",title:"New Folder",subscribed:1},d.data||{}),k.get({folder:d.folder}).pipe(function(b){return b.type===5?d.data.permissions=[{group:!1,bits:403710016,entity:c.get("identifier")}]:d.data.permissions=b.permissions,a.PUT({module:"folders",params:{action:"new",folder_id:d.folder,tree:"1"},
data:d.data,appendColumns:!1}).pipe(function(a){return k.getSubFolders({folder:d.folder,cache:!1}).pipe(function(){return a})})})},derive:{bits:function(a,b){return i(_.firstOf(a.own_rights,a,0),b||0)}},is:function(a,b){var e,f=0,g,h;if(_.isArray(b))return _(b).reduce(function(b,c){return b&&k.is(a,c)},!0);else if(a.search(/\|/)>-1){var i=a.split(/\|/);for(g=i.length,e=!1;f<g;f++)if(this.is(i[f],b)){e=!0;break}return e}else switch(a){case"private":return b.type===1;case"public":return b.type===2;
case"shared":return b.type===3;case"system":return b.type===5;case"mail":return b.module==="mail";case"messaging":return b.module==="messaging";case"calendar":return b.module==="calendar";case"contacts":return b.module==="contacts";case"tasks":return b.module==="tasks";case"infostore":return b.module==="infostore";case"account":return b.module==="system"&&/^default(\d+)?/.test(String(b.id));case"unifiedmail":return h=b?b.id!==undefined?b.id:b:"",d.isUnified(h);case"external":return/^default[1-9]/
.test(String(b.id))&&!this.is("unifiedmail",b);case"defaultfolder":var j=c.get("mail.folder");for(h in j)if(j[h]===b.id)return!0;return!1;case"published":if(b["com.openexchange.publish.publicationFlag"])return!0;if(b.permissions.length<=1)return!1;return b.type===1||b.type===7||b.module==="infostore"&&b.created_by===c.get("identifier")}},can:function(a,b){if(_.isArray(b))return _(b).reduce(function(b,c){return b&&k.can(a,c)},!0);var c=!0,d=b.own_rights,e=b.standard_folder||this.is("system",b),f=i
(d,28)===1,g=b.module==="mail";switch(a){case"read":return i(d,7)>0;case"write":return i(d,0)>=2;case"rename":return!f||e?c=!1:i(d,30)===1?c=!0:g?c=!this.is("defaultfolder",b):c=!0,c;case"create":return f||this.derive("permissions",b).bit>=4;case"delete":return f&&!e&&!this.is("defaultfolder",b);case"import":return(d&127)>=2&&this.is("calendar|contacts|tasks",b);case"export":return!this.is("shared",b)&&this.is("contacts|calendar",b);case"empty":return d>>21&127&&this.is("mail",b);case"changepermissions"
:return f;case"viewproperties":return!g&&!this.is("account",b)&&b.capabilities&1;case"subscribe":return g&&Boolean(b.capabilities&Math.pow(2,4));default:return!1}},folderCache:f,subFolderCache:g,needsRefresh:function(a){return g.get(a).pipe(function(a){return a!==null})},getTextNode:function(a){var b=document.createTextNode("");return j(a).done(function(a){b.nodeValue=a.title||a.id}).always(function(){_.defer(function(){b=null})}),b}},l=function(a,b){a=_.isArray(a)?a:[a];var c=$.when.apply($,_(a)
.map(function(a){var c=_.isString(a)?a:a.folder_id;return f.get(c).pipe(function(a){if(a)return a.unread=Math.max(0,a.unread+b),f.add(c,a);else return $.when()})}));return _.chain(a).pluck("folder_id").uniq().each(function(a){k.trigger("change:"+a)}),c};return"use strict",k.setUnread=function(a,b){return f.get(a).pipe(function(c){if(c)return c.unread=Math.max(0,b),f.add(a,c).done(function(){k.trigger("change:"+a)});else return $.when()})},k.decUnread=function(a){return l(a,-1)},k.incUnread=function(
a){return l(a,+1)},e.extend(k),k}),define("io.ox/core/desktop",["io.ox/core/event","io.ox/core/extensions","io.ox/core/extPatterns/links","io.ox/core/cache"],function(a,b,c,d){var e,f,g,h;return"use strict",$.quickSettings=function(){return function(a,b,c){var d=$(a),e=$(b);c=$(c),e.hasClass("quick-settings")||(d.css({position:"absolute",zIndex:2}),d.data("top",parseInt(d.css("top")||0,10)),e.addClass("quick-settings").css({position:"absolute",zIndex:1,top:(e.css("top")||0)+"px",right:"0px",height
:"auto",left:"0px",minHeight:"100px"})),c.off("click").on("dblclick",!1).on("click",function(){var a,b;return window.container=d,window.config=e,a=d.data("top"),c.data("open")!==!0?(c.data("open",!0),e.show(),b=Math.max(e.outerHeight(),25),d.stop().animate({top:a+b+"px"},250)):(c.data("open",!1),d.stop().animate({top:a+"px"},250,function(){e.hide()})),!1})}}(),e=null,f=$("#io-ox-core"),g=$("#io-ox-topbar"),h=function(a,b,c,d){var f=$("<div>").addClass("launcher").append(_.isString(b)?$.txt(b):b).
hover(function(){$(this).addClass("hover")},function(){$(this).removeClass("hover")}).on("click",function(){var a=$(this),b;_.isFunction(c)?(b=a.contents(),a.css("width",a.width()+"px").text(" ").busy(),(c.call(this)||$.when()).done(function(){a.idle().empty().append(b).css("width","")})):(a.css("backgroundColor","#800000"),setTimeout(function(){a.css("backgroundColor","")},500))});function h(a){var b=$("#io-ox-topbar"),c,d=a.getName()||a.id;if((c=b.find(".launcher[data-app-id="+$.escape(d)+"]"))
.length)return c;else return null}d&&f.tooltip({title:d,placement:"bottom",animation:!1});var i=e,j;return a==="left"&&i&&i.app&&(j=h(i.app))?f.hide().insertAfter(j).fadeIn(1e3):a==="left"?f.appendTo(g):f.addClass("right").appendTo(g),f},f.show(),ox.ui.running=[],ox.ui.createApp=function(){function e(d){var e=$.extend({title:"",icon:null,id:"app-"+c++},d||{}),f=function(){return $.Deferred().resolve()},g=f,h=f,i=null,j=!1,k=null,l=_.now()+"."+String(Math.random()).substr(3,4),m="",n=null,o=this;this
.getUniqueId=function(){return l};function p(){o.failSave&&b.get("savepoints").done(function(a){var c,d,e;a=a||[],c=o.failSave(),d=_(a).pluck("id"),e=_(d).indexOf(l),c.id=l,e>-1?a.splice(e,1,c):a.push(c),b.add("savepoints",a)})}function q(){b.get("savepoints").done(function(a){var c,d;a=a||[],c=_(a).pluck("id"),d=_(c).indexOf(l),d>-1&&a.splice(d,1),b.add("savepoints",a)})}$(window).on("unload",p),n=setInterval(p,10*1e3),a.extend(this),this.folder=function(){var a,b=null,c=null,d=null,e=function(a
){f.set(a.data.folder),o.trigger("folder:refresh",a.data.folder)},f={unset:function(){b=null,c&&c.setTitle(""),d&&d.clear()},set:function(a){var f=$.Deferred();return a!==undefined&&a!==null?require(["io.ox/core/api/folder"],function(g){g.get({folder:a}).done(function(h){g.off("change:"+b),b=String(a),g.on("change:"+b,{folder:b},e),c&&(c.setTitle(h.title),c.updateToolbar()),d&&d.prop("folder")!==b&&(d.clear(),d.prop("folder",b),c&&c.getSearchQuery()!==""?(c.setSearchQuery(""),d.setMode("all")):d.
refresh(),_.url.hash("folder",b)),o.trigger("folder:change",b,h),f.resolve(h)}).fail(f.reject)}):f.reject(),f},setType:function(b){return a=b,this},setDefault:function(){var b=new $.Deferred;return require(["io.ox/core/config"],function(c){var d=a==="mail"?c.get("mail.folder.inbox"):c.get("folder."+a);d?f.set(d).done(b.resolve).fail(b.reject):b.reject()}),b},get:function(){return b},getData:function(){return require(["io.ox/core/api/folder"]).pipe(function(a){return a.get({folder:b})})},updateTitle
:function(a){return c=a,this},updateGrid:function(a){return d=a,this},destroy:function(){f=c=d=null}};return f}(),this.getInstance=function(){return o},this.getId=function(){return e.id},this.setLauncher=function(a){return g=a,this},this.setQuit=function(a){return h=a,this},this.setWindow=function(a){return i=a,i.app=this,"name"in e&&i.nodes.outer.attr("data-app-name",e.name),this},this.getName=function(){return e.name},this.setTitle=function(a){return e.title=a,ox.trigger("application:change:title"
,this,a),this},this.getTitle=function(){return e.title},this.getWindow=function(){return i},this.getWindowNode=function(){return $(i.nodes.main)},this.getWindowTitle=function(){return i?i.getTitle():""},this.setState=function(a){var b;for(b in a)_.url.hash(b,String(a[b]))},this.getName=function(){return e.name},this.getState=function(){return _.url.hash()},this.launch=function(){var a;return e.name!==_.url.hash("app")&&(_.url.hash("folder",null),_.url.hash("id",null)),e.name&&_.url.hash("app",e.name
),j?i&&(i.show(),a=$.when(),ox.trigger("application:resume",o)):(j=!0,(a=g.apply(this,arguments)||$.when()).done(function(){ox.ui.running.push(o),ox.trigger("application:launch",o)})),a.pipe(function(){return $.Deferred().resolveWith(o,arguments)})},this.quit=function(a){var b=a?$.when():h()||$.when();return b.done(function(){var b;a&&o.destroy&&o.destroy(),_.url.hash("app",null),_.url.hash("folder",null),_.url.hash("id",null),ox.ui.running=_(ox.ui.running).without(o),j=!1,clearInterval(n),q(),$(
window).off("unload",p),ox.trigger("application:quit",o),o.events.destroy(),o.folder.destroy(),i&&(i.trigger("quit"),ox.ui.windowManager.trigger("window.quit",i),i.destroy());for(b in o)delete o[b];o=i=g=h=null})}}var b=new d.SimpleCache("app-cache",!0),c=0;return ox.ui.App=e,e.canRestore=function(){return b.get("savepoints").pipe(function(a){return a&&a.length})},e.getSavePoints=function(){return b.get("savepoints").pipe(function(a){return a||[]})},e.restore=function(){e.getSavePoints().done(function(
a){$.when.apply($,_(a).map(function(a){return require([a.module+"/main"]).pipe(function(b){return b.getApp().launch().done(function(){a.id=this.getUniqueId(),this.failRestore&&this.failRestore(a.point)})})})).done(function(){b.add("savepoints",a||[])})})},e.get=function(a){return _(ox.ui.running).filter(function(b){return b.getName()===a})},function(a){return new e(a)}}(),ox.ui.screens=function(){var b=null,c={add:function(a){return $("<div>",{id:"io-ox-"+a}).addClass("abs").hide().appendTo("#io-ox-screens"
)},get:function(a){return $("#io-ox-screens").find("#io-ox-"+a)},current:function(){return b},hide:function(a){this.get(a).hide(),this.trigger("hide-"+a)},show:function(a){$("#io-ox-screens").children().each(function(b,d){var e=$(this).attr("id"),f=String(e||"").substr(6);f!==a&&c.hide(f)}),this.get(a).show(),b=a,this.trigger("show-"+a)}};return a.extend(c),c}(),ox.ui.Perspective=function(){var a=function(a){var b=!1,c=!1;this.main=$(),this.show=function(d){c||(this.main=d.getWindow().addPerspective
(a),c=!0),d.getWindow().setPerspective(a),b||(this.render(d),b=!0)},this.render=$.noop};return a}(),ox.ui.windowManager=function(){var b=a.extend({}),c=[],d=function(){return _(c).inject(function(a,b){return a+(b.state.open?1:0)},0)};return b.getWindows=function(){return c.slice()},ox.ui.screens.on("hide-windowmanager",function(){e&&e.hide()}),b.hide=function(){ox.ui.screens.hide("windowmanager")},b.show=function(){ox.ui.screens.show("windowmanager")},b.on("window.open window.show",function(a,b){
this.show(),c=_(c).without(b),c.unshift(b)}),b.on("window.beforeshow",function(){b.trigger("empty",!1)}),b.on("window.close window.quit window.pre-quit",function(a,e,f){var g,h,i,j=_(c).indexOf(e);if(j!==-1){if(f==="window.quit")c.splice(j,1);else if(f==="window.close"||f==="window.pre-quit")c=_(c).without(e),c.push(e);for(g=0,h=c.length;g<h;g++){i=c[g];if(i!==e&&i.state.open){i.show();break}}}b.trigger("empty",d()===0)}),b}(),ox.ui.createWindow=function(){var d=0,f=$("#io-ox-windowmanager-pane")
,g=function(a){return a.data("x")||0},h=function(a,b){var c=f.find(".window-container-center"),d=a.find(".window-container-center").show(),e=a.data("index")||0,h=-e*101,i=function(){setTimeout(function(){_.call(b)},10)};h!==g(f)?(f.data("x",h),f.animate({left:h+"%"},0,i)):i()},i=function(a,c){this.id=a,this.name=c,this.nodes={},this.search={query:""},this.state={visible:!1,running:!1,open:!1},this.app=null,this.detachable=!0;var g=!1,i={main:!0},j="main",k=this,l=!0;this.updateToolbar=function(){
b.point(this.name+"/toolbar").invoke("draw",this.nodes.toolbar.empty(),this.app||this)},this.show=function(a){var b=this.nodes.outer,c=b.parent();return e!==this||c.length===0?(l&&b.data("index",d-1).css("left",(d-1)*101+"%"),b.parent().length===0&&b.appendTo(f),ox.ui.windowManager.trigger("window.beforeshow",k),this.trigger("beforeshow"),this.updateToolbar(),b.show(),h(b,function(){e&&e!==k&&e.hide(),e=k,_.call(a),k.state.visible=!0,k.state.open=!0,k.trigger("show"),document.title=ox.serverConfig
.pageTitle+k.getTitle(),l&&(k.trigger("open"),k.state.running=!0,ox.ui.windowManager.trigger("window.open",k),l=!1),ox.ui.windowManager.trigger("window.show",k)})):_.call(a),this},this.hide=function(){return this.trigger("beforehide"),this.detachable&&this.nodes.outer.find("iframe").length===0?this.nodes.outer.detach():this.nodes.outer.hide(),this.state.visible=!1,this.trigger("hide"),ox.ui.windowManager.trigger("window.hide",this),e===this&&(e=null,document.title=ox.serverConfig.pageTitle),this}
,this.toggle=function(){return e===this?this.hide():this.show(),this},this.preQuit=function(){return this.hide(),this.state.open=!1,this.trigger("pre-quit"),ox.ui.windowManager.trigger("window.pre-quit",this),this},this.close=function(){var a=this;return g&&this.app!==null?($("#myGrowl").jGrowl("shutdown"),this.trigger("beforequit"),this.app.quit().done(function(){a.state.open=!1,a.state.running=!1,a=null})):(this.hide(),this.state.open=!1,this.trigger("close"),ox.ui.windowManager.trigger("window.close"
,this)),this};var m="input, select, textarea, button",n="toggle-disabled";this.busy=function(){return k&&($("body").focus(),k.nodes.main.find(m).not(":disabled").attr("disabled","disabled").addClass(n),k.nodes.blocker.busy().show(),k.trigger("busy")),this},this.idle=function(a){return k&&(k.nodes.blocker.idle().hide(),k.nodes.main.find(m).filter("."+n).removeAttr("disabled").removeClass(n),k.trigger("idle")),this},this.destroy=function(){return this.hide(),this.trigger("destroy"),this.app!==null&&
(this.app.win=null,this.app=null),this.events.destroy(),this.show=this.busy=this.idle=$.noop,this.nodes.outer.remove(),this.nodes=k=null,this},this.setQuitOnClose=function(a){return g=!!a,this};var o="";function p(){var a=k.nodes.title.find("span");a.eq(0).empty().append(typeof o=="string"?document.createTextNode(o):o)}this.getTitle=function(){return k.nodes.title.find("span").eq(0).contents().text()},this.setTitle=function(a){return o=a,p(),this===e&&(document.title=ox.serverConfig.pageTitle+a),
this.trigger("change:title"),this},this.getSearchQuery=function(){return $.trim(this.nodes.search.val())},this.setSearchQuery=function(a){return this.nodes.search.val(a),this},this.addClass=function(){var a=this.nodes.outer;return a.addClass.apply(a,arguments)},this.addButton=function(a){var b=$.extend({label:"Action",action:$.noop},a||{});return $("<div>").addClass("io-ox-toolbar-link").text(String(b.label)).on("click",b.action).appendTo(this.nodes.toolbar)},this.addPerspective=function(a){if(this
.nodes[a]===undefined){var b=$("<div>").addClass("window-content").hide().appendTo(this.nodes.body);return this.nodes[a]=i[a]=b}},this.setPerspective=function(a){return a!==j&&i[a]!==undefined&&(this.nodes[j].hide(),this.nodes[j=a].show()),this}};return function(f){var g,h,j,k=$.extend({id:"window-"+d,name:"",width:0,title:"",titleWidth:"300px",search:!1,toolbar:!1,settings:!1,chromesless:!1},f),l=(String(k.width).match(/^(\d+)(px|%)$/)||["","100","%"]).splice(1),m=l[0],n=l[1],o=new i(k.id,k.name
),p=function(){o.close()};return o.nodes.outer=$("<div>").attr({id:k.id,"data-window-nr":d}).addClass("window-container").append($("<div>").addClass("window-container-center").data({width:m+n}).css({width:m+n}).append(o.nodes.blocker=$("<div>").addClass("abs window-blocker").hide()).append(o.nodes.head=$("<div>").addClass("window-head").append(o.nodes.title=$("<h1>").css("width",k.titleWidth).addClass("window-title").append($("<span>"))).append(o.nodes.toolbar=$("<div>").css("left",k.titleWidth).
addClass("window-toolbar")).append(o.nodes.controls=$("<div>").addClass("window-controls").append(o.nodes.settingsButton=$("<div>").hide().addClass("window-control").text("✎")).append(o.nodes.closeButton=$("<div>").hide().addClass("window-control").append($('<a class="close">&times;</a>'))))).append(o.nodes.body=$("<div>").addClass("window-body").append(o.nodes.settings=$("<div>").hide().addClass("window-settings").html("<h2>Each window can have a quick settings area</h2>")).append(o.nodes.main=$
("<div>").addClass("window-content")))),a.extend(o),k.search&&(g="",h=function(a){if(/^porn$/i.test(a))$("body").append($("<div>").addClass("abs").css({backgroundColor:"black",zIndex:65e3}).append($("<div>").addClass("abs").css({top:"25%",textAlign:"center",color:"#aaa",fontWeight:"bold",fontSize:"50px",fontFamily:"'Comic Sans MS', Arial"}).html('<span style="color: rgb(230,110,110)">YOU</span> SEARCHED FOR WHAT?')).append($("<div>").addClass("abs").css({top:"50%",width:"670px",textAlign:"center"
,margin:"0 auto 0 auto",color:"#666"}).html('<div style="font-size: 26px">WARNING: This website contains explicit adult material.</div>'+'<div style="font-size: 18px">You may only enter this Website if you are at least 18 years of age, or at least the age of majority in the jurisdiction where you reside or from which you access this Website. If you do not meet these requirements, then you do not have permission to use the Website.</div>')).click(function(){$(this).remove()}));else if(/^use the force$/i
.test(a)&&e){e.nodes.outer.css({webkitTransitionDuration:"2s",webkitTransform:"perspective(500px) rotate3d(1, 0, 0, 45deg)",top:"-150px"});return}else if(/^no star wars$/i.test(a)&&e){e.nodes.outer.css({webkitTransitionDuration:"1s",webkitTransform:"perspective(0px) rotate3d(1, 0, 0, 0deg)",top:""});return}o.trigger("search",a)},j="search_"+_.now(),$("<form>").on("submit",!1).addClass("form-search").css({"float":"right"}).append($("<label>",{"for":j}).append(o.nodes.search=$("<input>",{type:"text"
,placeholder:"Search ...",tabindex:"1",size:"40",id:j}).tooltip({animation:!1,title:"Press &lt;enter> to search,<br>press &lt;esc> to clear",placement:"bottom",trigger:"focus"}).addClass("input-large search-query").on({keydown:function(a){a.stopPropagation(),a.which===27&&($(this).val(""),o.trigger("cancel-search",g=""))},search:function(a){a.stopPropagation(),$(this).val()===""&&$(this).blur()},change:function(a){a.stopPropagation(),o.search.query=$(this).val(),o.search.query!==""?o.search.query!==
g&&h(g=o.search.query):g!==""&&o.trigger("cancel-search",g="")}}))).prependTo(o.nodes.controls)),k.toolbar===!0&&k.name&&b.point(k.name+"/toolbar").extend(new c.ToolbarLinks({id:"links",ref:k.name+"/links/toolbar"})),k.chromeless?(o.nodes.head.remove(),o.nodes.toolbar.remove(),o.nodes.body.css("top","0px")):(k.close===!0&&(o.nodes.closeButton.show().on("click",p),o.setQuitOnClose(!0)),o.setTitle(k.title),k.settings&&($.quickSettings(o.nodes.main,o.nodes.settings,o.nodes.settingsButton),o.nodes.settingsButton
.show())),d++,o}}(),ox.launch=function(a,b){var c=$.Deferred();return _.isString(a)?require([a],function(a){a.getApp(b).launch().done(function(){c.resolveWith(this,arguments)})}):c.resolve({}),c},{addLauncher:h}}),define("io.ox/core/commons",["io.ox/core/extPatterns/links"],function(a){var b={showWindow:function(a){return function(){var b=$.Deferred();return a.show(b.resolve),b}},multiSelection:function(){var b={};return function(c,d,e){if(e.length>1){d.idle().empty();var f=$("<div>");(b[c]||(b[c
]=new a.InlineLinks({id:"inline-links",ref:c+"/links/inline"}))).draw.call(f,e),d.append($("<div>").addClass("io-ox-multi-selection").append($("<div>").addClass("summary").html("<b>"+e.length+"</b> elements selected"),f.children().first()).center())}}}(),wireGridAndSelectionChange:function(a,c,d,e,f){var g="",h=function(a,b){_.cid(a.data.item)===_.cid(b)&&d(a.data.item)};f=f||$({}),a.selection.on("change",function(a,i){var j=i.length,k=JSON.stringify(_([].concat(i)).map(function(a){return{folder_id
:String(a.folder_id||a.folder),id:String(a.id),recurrence_position:String(a.recurrence_position||0)}}));k!==g&&(f.off("update",h),j===1?(e.css("height",""),d(i[0]),f.on("update",{item:i[0]},h)):j>1?(e.css("height","100%"),b.multiSelection(c,e,this.unfold())):e.css("height","").idle().empty(),g=k)})},wireGridAndAPI:function(a,b,c,d){a.setAllRequest(function(){return b[c||"getAll"]({folder:this.prop("folder")})}),a.setListRequest(function(a){return b[d||"getList"](a)})},wireGridAndWindow:function(a
,b){var c=0;b.on("show idle",function(){a.selection.keyboard(!0),a.selection.get().length&&a.selection.retriggerUnlessEmpty()}).on("hide busy",function(){a.selection.keyboard(!1)}).on("beforeshow",function(){c!==null&&a.scrollTop(c)}).on("beforehide",function(){c=a.scrollTop()}),b.app&&(b.app.getGrid=function(){return a})},wireFirstRefresh:function(a,b){a.getWindow().on("open",function(){b.needsRefresh(a.folder.get())&&b.trigger("refresh^",a.folder.get())})},wireGridAndRefresh:function(a,b,c){var d=
function(){a.refresh(!0)},e=function(){console.log("refreshlist"),a.repaint().done(function(){a.selection.retrigger()})};c.on("show",function(){b.on("refresh.all",d).on("refresh.list",e).trigger("refresh.all")}).on("hide",function(){b.off("refresh.all",d).off("refresh.list",e)})},wireGridAndSearch:function(a,b,c){a.setAllRequest("search",function(){return c.search(b.search.query)}),a.setListRequest("search",function(a){return c.getList(a)}),b.on("search",function(){a.setMode("search")}),b.on("cancel-search"
,function(){a.setMode("all")})},addFolderSupport:function(a,b,c,d){a.folder.updateTitle(a.getWindow()).updateGrid(b).setType(c),b&&a.folder.updateGrid(b),a.getWindow().nodes.title.append($("<b>").addClass("caret")),a.getWindow().on("show",function(){b&&b.selection.retriggerUnlessEmpty(),_.url.hash("folder",a.folder.get())}),d=_.url.hash("folder")||d;if(d!==undefined)return a.folder.set(d);else return a.folder.setDefault();a.on("folder:change",function(){console.log("mmmh")})},addGridFolderSupport
:function(a,b){a.folder.updateGrid(b),a.getWindow().on("show",function(){b.selection.retriggerUnlessEmpty()})},addFolderView:function(a,b){b=$.extend({width:330,rootFolderId:"1",type:undefined,view:"ApplicationFolderTree"},b);var c,d=!1,e=!1,f=0,g,h,i,j,k,l,m;c=$("<div>").addClass("abs border-right").css({backgroundColor:"white",right:"auto",width:b.width+"px",zIndex:3}).hide().appendTo(a.getWindow().nodes.body),g=function(g,h){var i=h[0];i.module===b.type&&(a.folder.unset(),e?a.folder.set(i.id):
(f=c.scrollTop(),c.fadeOut("fast",function(){a.folder.set(i.id)}),d=!1))},h=function(){return d||(c.show().scrollTop(f),d=!0),$.when()},i=function(){var b;e?(a.getWindow().nodes.body.css("left","0px"),c.css("left","0px")):(b=c.outerWidth(),a.getWindow().nodes.body.css("left",b+"px"),c.css("left",-b+"px")),e=!e},k=function(a){d?(f=c.scrollTop(),c.hide(),d=!1,e&&i()):(h(),a.altKey&&i())},j=function(a){a.isDefaultPrevented()||k(a)},m=function(d){var e=a.folderView=new d[b.view](c,{type:b.type,rootFolderId
:b.rootFolderId});return e.selection.on("change",g),e.paint().done(function(){e.selection.set(a.folder.get(),!0),a.getWindow().nodes.title.on("click",j),c.idle(),m=l=null})},l=function(b){if(!b.isDefaultPrevented())return c.busy(),k(b),a.showFolderView=h,a.getWindow().nodes.title.off("click",l),require(["io.ox/core/tk/folderviews"]).pipe(m)},a.showFolderView=l,a.folderView=null,a.getWindow().nodes.title.css("cursor","pointer").on("click",l)}};return"use strict",b}),define("io.ox/core/collection",
["io.ox/core/config","io.ox/core/api/folder"],function(a,b){var c=0,d=function(d,e,f){var g=b.derive.bits(d,f);if(g===0)return!1;else if(g===1)return c=c||a.get("identifier"),e===c;else return!0},e=function(a){if(_.isObject(a.folder)&&_.isFunction(a.folder.get))return a.folder.get();else if("folder_id"in a||"folder"in a)return a.folder_id||a.folder;else return undefined},f=function(a){var c=a.length||0,f={read:!0,modify:!0,"delete":!0,create:!0,none:c===0,some:c>0,one:c===1,multiple:c>1},g=_.chain
(a).map(e).filter(function(a){return a!==null&&a!==undefined}).value();return f.toplevel=_(a).reduce(function(a,b){return a&&"folder_id"in b&&!("filename"in b)},!0),b.get({folder:g}).pipe(function(b){var g=0,h=null,i=null;for(;g<c;g++){h=a[g];if(i=b[e(h)])f.read=f.read&&d(i,h.created_by,7),f.modify=f.modify&&d(i,h.created_by,14),f["delete"]=f["delete"]&&d(i,h.created_by,21),f.create=f.create&&(i.own_rights&127)>=2;else{f.unknown=!0,f.read=f.modify=f["delete"]=f.create=!1;break}}return f})};"use strict"
;function g(a){var b=_.compact([].concat(a)),c={},d=c;this.getProperties=function(){return f(b).done(function(a){d=a})},this.has=function(){return d===c&&console.error("Using Collection.has before properties are resolved!",a,arguments),_(arguments).inject(function(a,b){return a&&d[b]===!0},!0)}}return g}),define("io.ox/core/extPatterns/actions",["io.ox/core/extensions","io.ox/core/collection"],function(a){var b=function(a){return function(b){return b.collection.has.apply(b.collection,a.split(/ /)
)}},c=function(a){return a.collection.has("one")},d=function(d,e){var f=_.extend({requires:c},e);f.id=f.id||_(d.split(/\//)).last(),_.isString(f.requires)&&(f.requires=b(f.requires)),a.point(d).extend(f)},e=function(b,c,d,e){var f=new $.Deferred;return c.getProperties().done(function(){var g=a.point(b.ref).map(function(b){var f=$.Deferred();return b.isEnabled&&!b.isEnabled.apply(b,e)?f.resolve({link:b,state:!1}):$.when.apply($,a.point(b.ref).map(function(a){var b=_.isFunction(a.requires)?a.requires
({collection:c,context:d}):!0;return b.promise||(b=$.Deferred().resolve(b)),b}).value()).done(function(){var a=_(arguments).reduce(function(a,b){return a&&b===!0},!0);f.resolve({link:b,state:a})}),f});$.when.apply($,g.value()).done(function(){f.resolve(_.chain(arguments).filter(function(a){return a.state}).pluck("link").value()),g=null})}),f},f=function(b,c,d){var e=a.point(b),f=d?d.data||d:{};e.invoke("action",c,f,d),e.invoke("multiple",c,_.isArray(f)?f:[f],d)};return"use strict",{Action:d,invoke
:f,extPatterns:{applyCollection:e}}}),define("io.ox/core/extPatterns/links",["io.ox/core/extensions","io.ox/core/collection","io.ox/core/extPatterns/actions"],function(a,b,c){var d=c.Action,e=function(a){_.extend(this,a);var b=this,d=function(a){a.preventDefault();var b=$(this),d=b.data("context"),e=b.data("ref");c.invoke(e,this,d,a)};this.draw=this.draw||function(c){this.append($("<a>",{href:"#",tabindex:"1","data-action":b.id}).addClass("io-ox-action-link").attr({"data-prio":a.prio||"lo","data-ref"
:b.ref}).data({ref:b.ref,context:c}).click(d).text(String(b.label)))}},f=function(b,c){a.point(b).extend(new e(c))},g=function(a){_.extend(this,a);var b=this,d=function(a){a.preventDefault();var d=$(this),e=d.data("context"),f=d.data("ref");c.invoke(f,b,e)};this.draw=function(a){this.append($("<button>",{"data-action":b.id,tabIndex:b.tabIndex||""}).addClass(b.cssClasses||"btn").data({ref:b.ref,context:a}).click(d).text(String(b.label))).append("&nbsp;")}},h=function(a,b,d,e,f,g){return c.extPatterns
.applyCollection(a,b,e,f).always(function(a){var b=0;_(a).each(function(a){_.isFunction(a.draw)&&(a.draw.call(g?$("<li>").appendTo(d):d,e),_.isFunction(a.customize)&&a.customize.call(d.find("a"),e),b++)}),b===0&&d.addClass("empty")})},i=function(a){var c=_.extend(this,a);this.draw=function(a){var d=$.makeArray(arguments);h(c,new b(a),this,a,d)}},j=function(a){var b=$(this),c="data-toggle",d=b.parent().children('[data-prio="lo"]'),e=b.attr(c)==="more";d[e?"show":"hide"](),b.text(e?"Less":"More").attr
(c,e?"less":"more")},k=function(a){var c=_.extend(this,a);this.draw=function(a){var d=$.makeArray(arguments),e=$("<div>").addClass("io-ox-inline-links").appendTo(this),f=_.isArray(a)&&a.length>1;h(c,new b(a),e,a,d).done(function(){!f&&e.children().length>3&&(e.append($("<span>",{"data-toggle":"more"}).addClass("label io-ox-action-link").css({cursor:"pointer",marginLeft:"1.5em"}).click(j).text("More")),e.children('[data-prio="lo"]').hide())})}},l=0,m=function(a,c){var d=$.makeArray(arguments),e=$("<div>"
).addClass("dropdown").css({display:"inline-block",zIndex:l=l>0?l-1:1e4}).appendTo(this),f=$("<a>",{href:"#"}).attr("data-toggle","dropdown").data("context",c).text(a.label+" ").append($("<b>").addClass("caret")).appendTo(e);f.addClass(a.classes),e.append($.txt("   "));var g=$("<ul>").addClass("dropdown-menu").appendTo(e);return h(a,new b(c),g,c,d,!0),f.dropdown(),e},n=function(a){var b=_.extend(this,a);this.draw=function(){return m.apply(this,[b].concat($.makeArray(arguments)))}},o=function(b,c)
{var d=c||{};d.ref=b+"/"+d.id,a.point(b).extend(_.extend({ref:d.ref,draw:function(a){m.call(this,d,a)}},d))};return"use strict",{Action:d,Link:e,XLink:f,Button:g,ToolbarLinks:i,InlineLinks:k,DropdownLinks:n,Dropdown:o}}),define("settings",["io.ox/core/http","io.ox/core/cache","io.ox/core/tk/model"],function(a,b){var c=function(){var c="gui/wurst/",d={},e,f=function(a){var b=a.split(/\//),c=d||{};return _.each(b,function(a,b){var d=c!==null&&c.hasOwnProperty(a)&&typeof c[a]!="undefined"&&c[a]!==null
;if(d)c=c[a];else return c=null,null}),c},g=function(a,b){var c=a.split(/\//),e=d||{},f=c.pop();_.each(c,function(a,b){var c=e!==null&&e.hasOwnProperty(a)&&typeof e[a]!="undefined"&&e[a]!==null;if(c){e=e[a];if(typeof e!="object")return console.error("settings.set: "+e+" is a value"),!1}else e[a]={},e=e[a]}),e[f]=b},h=function(a){var b=a.split(/\//),c=d||{};return _.each(b,function(a,b){var d=c!==null&&c.hasOwnProperty(a)&&typeof c[a]!="undefined"&&c[a]!==null;if(d)c=c[a];else return!1}),!0},i=function(
a){var b=a.split(/\//),c=d||{},e=b.pop();return _.each(b,function(a,b){var d=c!==null&&c.hasOwnProperty(a)&&typeof c[a]!="undefined"&&c[a]!==null;if(d){c=c[a];if(typeof c!="object")return console.error("settings.remove: "+c+" is a value"),!1}else return!1}),delete [c[e]],!0},j=function(a,b,c){return b=b||{},c=c||"",_(a).each(function(a,d){_.isObject(a)&&!_.isArray(a)?j(a,b,c+d+"/"):b[c+d]=a}),b},k=function(a,b,c){this.set(b,c)},l={settingsPath:null,createModel:function(a){return(new a({data:j(this
.get())})).on("change",$.proxy(k,this))},get:function(a,b){if(!a)return f(c+l.settingsPath);else{a=c+l.settingsPath+"/"+a,console.log("getting: "+a);if(b===undefined)return f(a);else return h(a)?f(a):b}},set:function(b,f,h){if(b){var i=b;b=c+l.settingsPath+"/"+b,g(b,f);if(h)return e.add("settingsDefault",d),a.PUT({module:"config/gui",appendColumns:!1,processResponse:!1,data:d})}},remove:function(a){a&&(a=c+l.settingsPath+"/"+a,i(a))},contains:function(a){return a=c+l.settingsPath+"/"+a,h(a)},load
:function(){var c=function(){return a.GET({module:"config/gui",appendColumns:!1,processResponse:!1}).done(function(a){d=a!==undefined?a.data:{},e.add("settingsDefault",d)})};return e||(e=new b.SimpleCache("settings",!0)),e.get("settingsDefault").pipe(function(a){if(a!==null)return d=a,c(),d;else return c()})},save:function(){return e.add("settingsDefault",d),a.PUT({module:"config/gui",appendColumns:!1,processResponse:!1,data:d})}};return l};return"use strict",{load:function(a,b,d){var e=c();e.settingsPath=
a,e.load().done(function(){d(e)}).fail(function(){console.error("failed to load settings for:"+e.settingsPath)})}}})
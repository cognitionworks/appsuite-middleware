<?xml version="1.0" encoding="UTF-8" ?>
<schema name="OX Schema Mail" version="1.5">
    <types>
        <fieldType name="boolean" class="solr.BoolField" omitNorms="true" />
        <fieldType name="string" class="solr.StrField" sortMissingLast="true" omitNorms="true" />
        <fieldType name="long" class="solr.LongField" omitNorms="true" />
        <fieldType name="int" class="solr.IntField" omitNorms="true" />

        <fieldType name="addr" class="solr.TextField">
            <analyzer type="index">
                <tokenizer class="solr.KeywordTokenizerFactory" />
                <filter class="de.kippdata.solrext.analyzer.InternetAddressCleanupFilterFactory" />
                <filter class="solr.WordDelimiterFilterFactory" catenateWords="0" catenateNumbers="0" catenateAll="0" splitOnCaseChange="0"
                    splitOnNumerics="0" types="${confDir:/opt/open-xchange/solr/conf}/mail_address_delimiters.txt" />
                <!-- TODO: Liste erweitern -->
                <filter class="de.kippdata.solrext.analyzer.DomainSkipFilterFactory" domains="de com co.uk net fr it" />
                <filter class="solr.WordDelimiterFilterFactory" catenateWords="0" catenateNumbers="0" catenateAll="0" splitOnCaseChange="0"
                    splitOnNumerics="0" />
<!--                 <filter class="solr.GermanNormalizationFilterFactory" /> -->
                <filter class="solr.LengthFilterFactory" min="2" max="30" />
                <filter class="solr.LowerCaseFilterFactory" />
            </analyzer>
            <analyzer type="query">
                <tokenizer class="solr.KeywordTokenizerFactory" />
                <filter class="de.kippdata.solrext.analyzer.InternetAddressCleanupFilterFactory" />
                <filter class="solr.WordDelimiterFilterFactory" catenateWords="0" catenateNumbers="0" catenateAll="0" splitOnCaseChange="0"
                    splitOnNumerics="0" types="${confDir:/opt/open-xchange/solr/conf}/mail_address_delimiters.txt" />
                <!-- TODO: Liste erweitern -->
                <filter class="de.kippdata.solrext.analyzer.DomainSkipFilterFactory" domains="de com co.uk net fr it" />
                <filter class="solr.WordDelimiterFilterFactory" catenateWords="0" catenateNumbers="0" catenateAll="0" splitOnCaseChange="0"
                    splitOnNumerics="1" />
<!--                 <filter class="solr.GermanNormalizationFilterFactory" /> -->
                <filter class="solr.LengthFilterFactory" min="2" max="30" />
                <filter class="solr.LowerCaseFilterFactory" />
            </analyzer>
        </fieldType>

        <!-- German -->
        <fieldType name="text_de" class="solr.TextField" positionIncrementGap="100">
            <analyzer type="index">
                <tokenizer class="solr.WhitespaceTokenizerFactory"></tokenizer>
                <filter class="solr.WordDelimiterFilterFactory" catenateWords="0" catenateNumbers="0" catenateAll="0" splitOnCaseChange="0"
                    splitOnNumerics="0" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.StopFilterFactory" ignoreCase="true" words="${confDir:/opt/open-xchange/solr/conf}/lang/de/stopwords.txt"
                    enablePositionIncrements="true" />
                <filter class="solr.KeywordMarkerFilterFactory" protected="${confDir:/opt/open-xchange/solr/conf}/lang/de/protwords.txt" />
                <filter class="solr.GermanNormalizationFilterFactory" />
                <filter class="solr.GermanLightStemFilterFactory" />
            </analyzer>
            <analyzer type="query">
                <tokenizer class="solr.StandardTokenizerFactory" />
                <filter class="solr.SynonymFilterFactory" synonyms="${confDir:/opt/open-xchange/solr/conf}/lang/de/synonyms.txt" ignoreCase="true" expand="true" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.StopFilterFactory" ignoreCase="true" words="${confDir:/opt/open-xchange/solr/conf}/lang/de/stopwords.txt"
                    enablePositionIncrements="true" />
                <filter class="solr.KeywordMarkerFilterFactory" protected="${confDir:/opt/open-xchange/solr/conf}/lang/de/protwords.txt" />
                <filter class="solr.GermanNormalizationFilterFactory" />
                <filter class="solr.GermanLightStemFilterFactory" />
            </analyzer>
        </fieldType>

        <!-- English -->
        <fieldType name="text_en" class="solr.TextField" positionIncrementGap="100">
            <analyzer type="index">
                <tokenizer class="solr.StandardTokenizerFactory" />
                <filter class="solr.StopFilterFactory" ignoreCase="true" words="${confDir:/opt/open-xchange/solr/conf}/lang/en/stopwords.txt"
                    enablePositionIncrements="true" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.EnglishPossessiveFilterFactory" />
                <filter class="solr.KeywordMarkerFilterFactory" protected="${confDir:/opt/open-xchange/solr/conf}/lang/en/protwords.txt" />
                <filter class="solr.PorterStemFilterFactory" />
            </analyzer>
            <analyzer type="query">
                <tokenizer class="solr.StandardTokenizerFactory" />
                <filter class="solr.SynonymFilterFactory" synonyms="${confDir:/opt/open-xchange/solr/conf}/lang/en/synonyms.txt" ignoreCase="true" expand="true" />
                <filter class="solr.StopFilterFactory" ignoreCase="true" words="${confDir:/opt/open-xchange/solr/conf}/lang/en/stopwords.txt"
                    enablePositionIncrements="true" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.EnglishPossessiveFilterFactory" />
                <filter class="solr.KeywordMarkerFilterFactory" protected="${confDir:/opt/open-xchange/solr/conf}/lang/en/protwords.txt" />
                <filter class="solr.PorterStemFilterFactory" />
            </analyzer>
        </fieldType>

        <!-- French -->
        <fieldType name="text_fr" class="solr.TextField" positionIncrementGap="100">
            <analyzer type="index">
                <tokenizer class="solr.StandardTokenizerFactory" />
                <!-- removes l', etc -->
                <filter class="solr.ElisionFilterFactory" ignoreCase="true" articles="${confDir:/opt/open-xchange/solr/conf}/lang/fr/contractions.txt" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.StopFilterFactory" ignoreCase="true" words="${confDir:/opt/open-xchange/solr/conf}/lang/fr/stopwords.txt" format="snowball"
                    enablePositionIncrements="true" />
                <filter class="solr.FrenchLightStemFilterFactory" />
            </analyzer>
            <analyzer type="query">
                <tokenizer class="solr.StandardTokenizerFactory" />
                <filter class="solr.SynonymFilterFactory" synonyms="${confDir:/opt/open-xchange/solr/conf}/lang/fr/synonyms.txt" ignoreCase="true" expand="true" />
                <!-- removes l', etc -->
                <filter class="solr.ElisionFilterFactory" ignoreCase="true" articles="${confDir:/opt/open-xchange/solr/conf}/lang/fr/contractions.txt" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.StopFilterFactory" ignoreCase="true" words="${confDir:/opt/open-xchange/solr/conf}/lang/fr/stopwords.txt" format="snowball"
                    enablePositionIncrements="true" />
                <filter class="solr.FrenchLightStemFilterFactory" />
            </analyzer>
        </fieldType>

        <!-- Italian -->
        <fieldType name="text_it" class="solr.TextField" positionIncrementGap="100">
            <analyzer type="index">
                <tokenizer class="solr.StandardTokenizerFactory" />
                <!-- removes l', etc -->
                <filter class="solr.ElisionFilterFactory" ignoreCase="true" articles="${confDir:/opt/open-xchange/solr/conf}/lang/it/contractions.txt" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.StopFilterFactory" ignoreCase="true" words="${confDir:/opt/open-xchange/solr/conf}/lang/it/stopwords.txt" format="snowball"
                    enablePositionIncrements="true" />
                <filter class="solr.ItalianLightStemFilterFactory" />
            </analyzer>
            <analyzer type="query">
                <tokenizer class="solr.StandardTokenizerFactory" />
                <filter class="solr.SynonymFilterFactory" synonyms="${confDir:/opt/open-xchange/solr/conf}/lang/it/synonyms.txt" ignoreCase="true" expand="true" />
                <!-- removes l', etc -->
                <filter class="solr.ElisionFilterFactory" ignoreCase="true" articles="${confDir:/opt/open-xchange/solr/conf}/lang/it/contractions.txt" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.StopFilterFactory" ignoreCase="true" words="${confDir:/opt/open-xchange/solr/conf}/lang/it/stopwords.txt" format="snowball"
                    enablePositionIncrements="true" />
                <filter class="solr.ItalianLightStemFilterFactory" />
            </analyzer>
        </fieldType>

        <fieldType name="text" class="solr.TextField" positionIncrementGap="100" omitNorms="false">
            <analyzer type="index">
                <tokenizer class="solr.WhitespaceTokenizerFactory" />
                <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="0" catenateNumbers="1"
                    catenateAll="0" splitOnCaseChange="1" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.RemoveDuplicatesTokenFilterFactory" />
            </analyzer>
            <analyzer type="query">
                <tokenizer class="solr.WhitespaceTokenizerFactory" />
                <filter class="solr.WordDelimiterFilterFactory" generateWordParts="1" generateNumberParts="1" catenateWords="0" catenateNumbers="1"
                    catenateAll="0" splitOnCaseChange="1" />
                <filter class="solr.LowerCaseFilterFactory" />
                <filter class="solr.RemoveDuplicatesTokenFilterFactory" />
            </analyzer>
        </fieldType>
    </types>

    <fields>
        <!-- Common Fields -->
        <field name="uuid" type="string" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.UUID" />
        <field name="timestamp" type="long" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.TIMESTAMP" />
        <field name="account" type="string" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.ACCOUNT" />
        <field name="full_name" type="string" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FULL_NAME" />
        <field name="id" type="string" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.ID" />
        <field name="color_label" type="int" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.COLOR_LABEL" />
        <field name="attachment" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.ATTACHMENT" />

        <!-- Long fields -->
        <field name="received_date" type="long" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.RECEIVED_DATE" />
        <field name="sent_date" type="long" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.SENT_DATE" />
        <field name="size" type="long" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.SIZE" />

        <!-- Flag fields -->
        <field name="flag_answered" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_ANSWERED" />
        <field name="flag_deleted" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_DELETED" />
        <field name="flag_draft" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_DRAFT" />
        <field name="flag_flagged" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_FLAGGED" />
        <field name="flag_recent" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_RECENT" />
        <field name="flag_seen" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_SEEN" />
        <field name="flag_user" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_USER" />
        <field name="flag_spam" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_SPAM" />
        <field name="flag_forwarded" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_FORWARDED" />
        <field name="flag_read_ack" type="boolean" stored="true" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FLAG_READ_ACK" />
        <field name="user_flags" type="string" stored="true" indexed="true" multiValued="true" oxIndexField="com.openexchange.mail.index.MailIndexField.USER_FLAGS" />

        <field name="content_flag" type="boolean" stored="false" indexed="true" oxIndexField="com.openexchange.mail.index.MailIndexField.CONTENT_FLAG" />

        <field name="from" type="addr" stored="true" indexed="true" multiValued="true" oxIndexField="com.openexchange.mail.index.MailIndexField.FROM" />
        <field name="to" type="addr" stored="true" indexed="true" multiValued="true" oxIndexField="com.openexchange.mail.index.MailIndexField.TO" />
        <field name="cc" type="addr" stored="true" indexed="true" multiValued="true" oxIndexField="com.openexchange.mail.index.MailIndexField.CC" />
        <field name="bcc" type="addr" stored="true" indexed="true" multiValued="true" oxIndexField="com.openexchange.mail.index.MailIndexField.BCC" />

        <field name="subject" type="text" stored="false" indexed="false" oxIndexField="com.openexchange.mail.index.MailIndexField.SUBJECT" />
        <field name="subject_gen" type="text" stored="true" indexed="true" />
        <field name="subject_de" type="text_de" stored="true" indexed="true" />
        <field name="subject_en" type="text_en" stored="true" indexed="true" />
        <field name="subject_fr" type="text_fr" stored="true" indexed="true" />
        <field name="subject_it" type="text_it" stored="true" indexed="true" />

        <field name="content" type="text" stored="false" indexed="false" oxIndexField="com.openexchange.mail.index.MailIndexField.CONTENT" />
        <field name="content_gen" type="text" stored="false" indexed="true" />
        <field name="content_de" type="text_de" stored="false" indexed="true" />
        <field name="content_en" type="text_en" stored="false" indexed="true" />
        <field name="content_fr" type="text_fr" stored="false" indexed="true" />
        <field name="content_it" type="text_it" stored="false" indexed="true" />

        <field name="locale" type="string" stored="true" indexed="false" />
    </fields>

    <uniqueKey>uuid</uniqueKey>
    <solrQueryParser defaultOperator="OR" />
    <defaultSearchField>uuid</defaultSearchField>
</schema>

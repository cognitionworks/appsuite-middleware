<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Atmosphere Chat</title>
    <LINK REL=StyleSheet HREF="styles/base.css" TYPE="text/css" MEDIA=screen>
    <script type="text/javascript" src="lib/require.js"></script>
    <script type="text/javascript" src="lib/json2.js" ></script>
    <script type="text/javascript" src="lib/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="lib/jquery.atmosphere.js"></script>

    <style>

    </style>
</head>
<body>
  <div class="loginForm"></div>
  <div id="mainContent"></div>	
  <script>
  require(["simpleox/bootstrap"], function (boot) {
    boot.done(function (session) {
//       require(["ui/ui"], function (ui) {
//         ui.init.call($("#content"), session);
//       });
        var socket = $.atmosphere;
    	var splits = document.location.toString().split('/');
    	var proto = splits[0]; var host = splits[2];
    	var url = proto+"//"+host+"/realtime/atmosphere/chat";

    	var request = {
    	        url: url,
    	        contentType : "application/json",
    	        logLevel : 'debug',
    	        transport : 'websocket' ,
    	        fallbackTransport: 'long-polling',
    	        timeout: 60000,
    	        maxRequests : 3
    	};

    	request.onOpen = function(response) {
    	    console.log("OnOpen called");
    	}; 

    	request.onClose = function(response) {
    	    console.log("OnClose called");
    	};

    	request.onReconnect = function(request, response) {
    	    console.log("onReconnect called");
    	};

    	request.onError = function(response) {
    	    console.log("OnError called");
    	};

    	request.onMessage = function(response) {
    	    console.log("onMessage:" + response.responseBody);
    	};
    	
        console.log("connecting to url:"+url);
    	
        window.subSocket = socket.subscribe(request);
    	
    	window.pushit = function() {
    		subSocket.push('{"author" : "marens", "message" :"harro "}');
    	}

    });
  });
  </script>
</body>
</html>
<?xml version="1.0" encoding="UTF-8"?>
<project name="oxscript overrides" basedir=".">

    <description>
        This build file overrides the installConf target to patch a lot of configuration files before installing them.
    </description>

	<!-- Customizable values -->
    <!-- This values must be changed for defining other installation places -->
    <property name="logInstallDir" value="/var/log/open-xchange"/>

	<!-- Constants -->
	<property name="osgiDir" value="osgi"/>

    <import file="build-project.xml"/>

	<target name="postInstall">
		<antcall target="patchAndInstallConfigIniTemplate"/>
		<!-- TODO install startup scripts
        <copy todir="${bin.install.copy.dir}" overwrite="true">
            <fileset dir="${patch.bin.dir}"/>
        </copy>
        <chmod perm="755" file="${bin.install.copy.dir}/open-xchange-groupware"/>
        <chmod perm="755" file="${bin.install.copy.dir}/checkconsistency"/>
        <chmod perm="755" file="${bin.install.copy.dir}/checkconfigconsistency"/>
        <chmod perm="755" file="${bin.install.copy.dir}/listExecutedUpdateTasks"/>
        <chmod perm="755" file="${bin.install.copy.dir}/logincounter"/>
        <chmod perm="755" file="${bin.install.copy.dir}/oxreport"/>
        <chmod perm="755" file="${bin.install.copy.dir}/resetversion"/>
        <chmod perm="755" file="${bin.install.copy.dir}/runupdate"/>
        <chmod perm="755" file="${bin.install.copy.dir}/schemasandversions"/>
        <chmod perm="755" file="${bin.install.copy.dir}/forceupdatetask"/>
        <chmod perm="755" file="${bin.install.copy.dir}/restoregabdefaults"/>

        <copy todir="${destdir}/" overwrite="true">
            <fileset dir="system"/>
            <mapper type="glob" from="*.${distribution}" to="*"/>
        </copy>
        <chmod perm="755" file="${destdir}/etc/init.d/open-xchange-groupware"/> -->
	</target>

	<target name="patchAndInstallConfigIniTemplate" description="Patches and installs config.ini.template file.">
        <mkdir dir="${tmpDir}/${osgiDir}"/>
        <copy todir="${tmpDir}/${osgiDir}" overwrite="true">
            <fileset dir="${osgiDir}"/>
        </copy>
        <move tofile="${tmpDir}/${osgiDir}/config.ini.template" file="${tmpDir}/${osgiDir}/config.ini.template.in" overwrite="true"/>
        <replace file="${tmpDir}/${osgiDir}/config.ini.template">
            <replacefilter token="@bundlesdir@" value="${bundlesDir}"/>
            <replacefilter token="@logfile@" value="${logInstallDir}/open-xchange-osgi.log"/>
        </replace>
        <copy todir="${destDir}/${prefix}/${osgiDir}">
            <fileset dir="${tmpDir}/${osgiDir}"/>
        </copy>
    </target>

</project>

### proxy_http configuration for OX hosts

<Location /axis2>
    # restrict access to the soap provisioning API
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
    # you might add more ip addresses / networks here
    # Allow from 192.168 10 172.16
</Location>

<IfModule mod_proxy_http.c>
    ProxyRequests Off
    ProxyStatus On
    
    # Define default Proxy container
    <Proxy balancer://oxcluster>
        Order deny,allow
        Allow from all
        BalancerMember http://localhost:8080 timeout=100 smax=0 ttl=60 retry=60 loadfactor=50 keepalive=On route=OX0
        ProxySet stickysession=JSESSIONID
    </Proxy>

    # Define another Proxy Container with drastically different timeout for the
    # eas clients. Microsoft recommends a minimum value of 15 minutes. Setting
    # the value lower than the one defined as
    # com.openexchange.usm.eas.ping.max_heartbeat in eas.properties will lead to
    # connection timeouts for eas clients and lower battery life for mobile
    # clients.
    # See http://support.microsoft.com/?kbid=905013 for additional information.
    <Proxy balancer://oxcluster_eas>
        Order deny,allow
        Allow from all
        BalancerMember http://localhost:8080 timeout=1800 smax=0 ttl=60 retry=60 loadfactor=50 keepalive=On route=OX0
        ProxySet stickysession=JSESSIONID
    </Proxy>
    
    # ProxyPassReverse remaps URLs in the HTTP headers to ensure they work in
    # front of the proxy. It adjusts the URL in the Location, Content-Location
    # and URI headers on HTTP redirect responses.
    # This is needed because the servlet container doesn't know about the proxy
    # in front of it if it doesn't look at "X-Forwarded-*" headers
    # (http://code.google.com/p/xebia-france/wiki/XForwardedFilter).
    # Simply using Location: /some/path/to/file.html for redirects is against
    # the http spec so it uses Location: http://host:8080/foo which we can't use
    # in front of the proxy and therefore have to substitute with a working url.
    #
    # Example:
    # BalancerMember balancer://alias http://example.com/foo
    # ProxyPassReverse /bash balancer://alias/bar
    # translates url http://example.com/foo/bar/that to /bash/that
    #
    # Doesn't work in <Proxy> containers atm., related to
    # https://issues.apache.org/bugzilla/show_bug.cgi?id=38864 ?
    ProxyPassReverse /ox7 balancer://oxcluster/ox7

    # ProxyPass for default Proxy container
    <Proxy /ajax>
      ProxyPass balancer://oxcluster/ajax
    </Proxy>
    <Proxy /ox7/api>
	    ProxyPass balancer://oxcluster/ajax 
    </Proxy>
    <Proxy /axis2>
      ProxyPass balancer://oxcluster/axis2
    </Proxy>
    <Proxy /servlet>
      ProxyPass balancer://oxcluster/servlet
    </Proxy>
    <Proxy /infostore>
      ProxyPass balancer://oxcluster/infostore
    </Proxy>
    <Proxy /publications>
      ProxyPass balancer://oxcluster/publications
    </Proxy>
    <Proxy /usm-json>
      ProxyPass balancer://oxcluster/usm-json
    </Proxy>
    <Proxy /realtime>
      ProxyPass balancer://oxcluster/realtime
    </Proxy>
    

    # ProxyPass for eas specific Proxy container with longer timeout
    <Proxy /Microsoft-Server-ActiveSync>
      ProxyPass balancer://oxcluster_eas/Microsoft-Server-ActiveSync
    </Proxy>

    <IfModule mod_status.c>
      <Location /balancer-manager>
      SetHandler balancer-manager
      Order Allow,Deny
      Allow from all 
      </Location>
    </IfModule>

</IfModule>
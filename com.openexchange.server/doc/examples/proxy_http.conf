### proxy_http configuration for OX hosts

# Please note that the servlet path to the soap API has changed:
<Location /webservices>
    # restrict access to the soap provisioning API
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
    # you might add more ip addresses / networks here
    # Allow from 192.168 10 172.16
</Location>

# the old path is kept for compatibility reasons
<Location /servlet/axis2/services>
    # restrict access to the soap provisioning API
    Order Deny,Allow
    Deny from all
    Allow from 127.0.0.1
    # you might add more ip addresses / networks here
    # Allow from 192.168 10 172.16
</Location>

<IfModule mod_proxy_http.c>
    ProxyRequests Off
    # When enabled, this option will pass the Host: line from the incoming request to the proxied host.
    ProxyPreserveHost On
    <Proxy balancer://oxcluster>
        Order deny,allow
        Allow from all
        # multiple server setups need to have the hostname inserted instead localhost
        BalancerMember http://localhost:8009 timeout=100 smax=0 ttl=60 retry=60 loadfactor=50 route=OX1
        # Enable and maybe add additional hosts running OX here
        # BalancerMember http://oxhost2:8009 timeout=100  smax=0 ttl=60 retry=60 loadfactor=50 route=OX2
        ProxySet stickysession=JSESSIONID|jsessionid scolonpathdelim=On
        SetEnv proxy-initial-not-pooled
        SetEnv proxy-sendchunked
    </Proxy>
    # Microsoft recommends a minimum timeout value of 15 minutes for eas connections
    <Proxy balancer://eas_oxcluster>
        Order deny,allow
        Allow from all
        # multiple server setups need to have the hostname inserted instead localhost
        BalancerMember http://localhost:8009 timeout=1800 smax=0 ttl=60 retry=60 loadfactor=50 route=OX1
        # Enable and maybe add additional hosts running OX here
        # BalancerMember http://oxhost2:8009 timeout=1800  smax=0 ttl=60 retry=60 loadfactor=50 route=OX2
        ProxySet stickysession=JSESSIONID|jsessionid scolonpathdelim=On
        SetEnv proxy-initial-not-pooled
        SetEnv proxy-sendchunked
    </Proxy>
    # OX AppSuite frontend
    <Proxy /appsuite/api>
        ProxyPass balancer://oxcluster/ajax
    </Proxy>
    # OX frontend
    <Proxy /ajax>
        ProxyPass balancer://oxcluster/ajax
    </Proxy>
    <Proxy /servlet>
        ProxyPass balancer://oxcluster/servlet
    </Proxy>
    <Proxy /infostore>
        ProxyPass balancer://oxcluster/infostore
    </Proxy>
    <Proxy /publications>
        ProxyPass balancer://oxcluster/publications
    </Proxy>
    # USM
    <Proxy /usm-json>
        ProxyPass balancer://oxcluster/usm-json
    </Proxy>
    # SOAP
    <Proxy /webservices>
        ProxyPass balancer://oxcluster/webservices
    </Proxy>
    <Proxy /realtime>
      ProxyPass balancer://oxcluster/realtime
    </Proxy>
    # OXtender/EAS specific proxy container with higher timeout
    <Proxy /Microsoft-Server-ActiveSync>
        ProxyPass balancer://eas_oxcluster/Microsoft-Server-ActiveSync
    </Proxy>
</IfModule>

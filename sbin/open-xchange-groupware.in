#!/bin/bash

OXFUNCTIONS=@oxfunctions@
OXCONFIG=@oxscriptconf@
OXPREFIX=@prefix@
CONSOLELOG=@consolelogfile@

test -f $OXFUNCTIONS || {
	echo "missing common shell functions file"
	exit 1
}

. $OXFUNCTIONS

test -f $OXCONFIG && . $OXCONFIG

ox_set_JAVA_BIN


test -z "$JAVA_XTRAOPTS" && JAVA_XTRAOPTS="-ms50m -mx50m"

JAVA_OPTS="${JAVA_XTRAOPTS} \
-Djava.awt.headless=true \
-Dopenexchange.propfile=$SYSTEMPROPERTIES \
-Djava.util.logging.config.file=$LOGGINGPROPERTIES \
-DappName=groupwareApp \
-Djava.library.path=@oxlibdir@ \
-Dcom.sun.management.jmxremote"

CLASSPATH="-classpath \
@jdbcjar@:\
@mailjar@:\
@activationjar@:\
@jdomjar@:\
@jsdkjar@:\
@jcsjar@:\
@concurrentjar@:\
@loggingjar@:\
@jsonjar@:\
@fileuploadjar@:\
@iojar@:\
@webdavjar@:\
@httpclientjar@:\
@jbossclientjar@:\
@oxadapterjar@:\
@tnefjar@:\
@springbeanjar@:\
@springcorejar@:\
@oxgroupwarelibdir@/ox_server.jar:\
@oxgroupwarelibdir@/ox_languages.jar:"

pushd $OXPREFIX

rm -f $CONSOLELOG
umask 066
exec $JAVA_BIN $JAVA_OPTS $CLASSPATH ComfireServer > $CONSOLELOG 2>&1


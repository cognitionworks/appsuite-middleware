<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <style type="text/css">
  body {
      margin: auto;
      padding-right: 1em;
      padding-left: 1em;
      max-width: 44em; 
      border-left: 1px solid black;
      border-right: 1px solid black;
      color: black;
      font-family: Verdana, sans-serif;
      font-size: 100%;
      line-height: 140%;
      color: #333; 
  }
  pre {
      border: 1px dotted gray;
      background-color: #ececec;
      color: #1111111;
      padding: 0.5em;
  }
  code {
      font-family: monospace;
  }
  h1 a, h2 a, h3 a, h4 a, h5 a { 
      text-decoration: none;
      color: #7a5ada; 
  }
  h1, h2, h3, h4, h5 { font-family: verdana;
                       font-weight: bold;
                       border-bottom: 1px dotted black;
                       color: #7a5ada; }
  h1 {
          font-size: 130%;
  }
  
  h2 {
          font-size: 110%;
  }
  
  h3 {
          font-size: 95%;
  }
  
  h4 {
          font-size: 90%;
          font-style: italic;
  }
  
  h5 {
          font-size: 90%;
          font-style: italic;
  }
  
  h1.title {
          font-size: 200%;
          font-weight: bold;
          padding-top: 0.2em;
          padding-bottom: 0.2em;
          text-align: left;
          border: none;
  }
  
  dt code {
          font-weight: bold;
  }
  dd p {
          margin-top: 0;
  }
  
  #footer {
          padding-top: 1em;
          font-size: 70%;
          color: gray;
          text-align: center;
  }
  </style>
</head>
<body>
<h1 id="atmosphere">Atmosphere</h1>
<h2 id="the-namespaces-and-addressing-elements">The namespaces and addressing elements</h2>
<p>The namespace ox is used for internal Stanzas.</p>
<h1 id="atmosphere-presence-protocol-spec">Atmosphere Presence Protocol Spec</h1>
<p>A payload element is an object in the form of</p>
<pre><code>{
  &quot;namespace&quot; : &quot;this is the namespace of the payload element&quot;
  &quot;element&quot; : &quot;this is the name of the payload element&quot;
  &quot;data&quot; : &quot;&quot;
}</code></pre>
<p>The namespace is only needed when the payload element isn’t from the default namespace or the enclosing namespace data can be:</p>
<ul>
<li>a primitive json type</li>
<li>an array of payload elements</li>
<li>a json object containing other payload elements or Arrays of payload elements</li>
</ul>
<h2 id="initial-presence">Initial Presence</h2>
<p>The initial presence message only has to consist of the obligatory session key and the element key specifying that this message is a presence message. This is enough to send a broadcast to all subscribed users and signal that the user is now available.</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">{
     <span class="st">&quot;session&quot;</span> : <span class="st">&quot;$session&quot;</span>,
     <span class="st">&quot;element&quot;</span> : <span class="st">&quot;presence&quot;</span>
};</code></pre>
<h2 id="directed-presence">Directed Presence</h2>
<p>To send a directed Presence to a user that isn’t in your roster but to whom you want to advertise your presence for e.g. a short chat you just have to ad the additional to key.</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">{
     <span class="st">&quot;session&quot;</span> : <span class="st">&quot;$session&quot;</span>,
     <span class="st">&quot;element&quot;</span> : <span class="st">&quot;presence&quot;</span>,
     <span class="st">&quot;to&quot;</span>: <span class="st">&quot;ox://marens@1337/ox7ui</span>
};</code></pre>
<h2 id="update-after-initial-presence">Update after initial Presence</h2>
<p>After the user’s availability was broadcasted via the initial presence message the user may choose to change his Presence status. The priority instructs the Server to which resource messages should be routed. Resources with negative priority never receive messages. Optionals keys/elementss/elements: priority</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">{
  <span class="st">&quot;session&quot;</span> : <span class="st">&quot;$session&quot;</span>,
  <span class="st">&quot;element&quot;</span> : <span class="st">&quot;presence&quot;</span>,
  <span class="st">&quot;payloads&quot;</span> : [
    {<span class="st">&quot;element&quot;</span> : <span class="st">&quot;status&quot;</span>, <span class="st">&quot;data&quot;</span> : <span class="st">&quot;away&quot;</span>},
    {<span class="st">&quot;element&quot;</span> : <span class="st">&quot;message&quot;</span>, <span class="st">&quot;data&quot;</span> : <span class="st">&quot;I&#39;ll be back!&quot;</span>},
    {<span class="st">&quot;element&quot;</span> : <span class="st">&quot;priority&quot;</span>, <span class="st">&quot;data&quot;</span> : <span class="st">&quot;1&quot;</span>}
  ]
};</code></pre>
<h2 id="final-unavailable-presence">Final unavailable Presence</h2>
<p>The final unavailable presence broadcast to inform your subscribed contacts that you are gone. Type has to be set to unavailable. Optionals keys/elements: message</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">{
    <span class="st">&quot;session&quot;</span> : <span class="st">&quot;$session&quot;</span>,
    <span class="st">&quot;element&quot;</span> : <span class="st">&quot;presence&quot;</span>,
    <span class="st">&quot;type&quot;</span>: <span class="st">&quot;unavailable&quot;</span>,
    <span class="dt">payloads </span>: [
      {<span class="st">&quot;element&quot;</span> : <span class="st">&quot;message&quot;</span>, <span class="st">&quot;data&quot;</span> : <span class="st">&quot;Bye!&quot;</span>}
    ]
};</code></pre>
<h2 id="subscribe-request">Subscribe Request</h2>
<p>Mr. X wants to subscribe to the presence of marens@1337. Optionals keys/elements: message</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">{
  <span class="st">&quot;session&quot;</span> : <span class="st">&quot;$session&quot;</span>,
  <span class="st">&quot;element&quot;</span> : <span class="st">&quot;presence&quot;</span>,
  <span class="st">&quot;to&quot;</span> : <span class="st">&quot;ox://marens@1337&quot;</span>,
  <span class="st">&quot;type&quot;</span> : <span class="st">&quot;subscribe&quot;</span>,
  <span class="st">&quot;payloads&quot;</span> : [
    {<span class="st">&quot;element&quot;</span> : <span class="st">&quot;message&quot;</span>, <span class="st">&quot;data&quot;</span> : <span class="st">&quot;Hello marens, please let me subscribe to your presence, WBR., Mr. X&quot;</span>}
  ]
}</code></pre>
<h2 id="subscribed-response">Subscribed Response</h2>
<p>To accept a former subscription request from marens@1337. Optionals keys/elements: message</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">{
  <span class="st">&quot;session&quot;</span> : <span class="st">&quot;$session&quot;</span>,
  <span class="st">&quot;element&quot;</span> : <span class="st">&quot;presence&quot;</span>,
  <span class="st">&quot;to&quot;</span> : <span class="st">&quot;ox://mrx@1337&quot;</span>,
  <span class="st">&quot;type&quot;</span> : <span class="st">&quot;subscribed&quot;</span>,
  <span class="st">&quot;payloads&quot;</span> : [
    {<span class="st">&quot;element&quot;</span> : <span class="st">&quot;message&quot;</span>, <span class="st">&quot;data&quot;</span> :  <span class="st">&quot;Hello Mr. X!&quot;</span>}
  ]
}</code></pre>
<h2 id="unsubscribed-presence-message">UnSubscribed Presence Message</h2>
<p>To refuse a former presence subscription request or to cancel an already granted presence subscription. Optionals keys/elements: message</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">{
  <span class="st">&quot;session&quot;</span> : <span class="st">&quot;$session&quot;</span>,
  <span class="st">&quot;element&quot;</span> : <span class="st">&quot;presence&quot;</span>,
  <span class="st">&quot;to&quot;</span> : <span class="st">&quot;ox://mrx@1337&quot;</span>,
  <span class="st">&quot;type&quot;</span> : <span class="st">&quot;unsubscribed&quot;</span>,
  <span class="st">&quot;payloads&quot;</span> : [
    {<span class="st">&quot;element&quot;</span> : <span class="st">&quot;message&quot;</span>, <span class="st">&quot;data&quot;</span> : <span class="st">&quot;Bye Mr. X!&quot;</span>}
  ]
}</code></pre>
<h2 id="unsubscribe-request">UnSubscribe Request</h2>
<p>If you no longer want to be informed about the presence status of another entity.</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">{
  <span class="st">&quot;session&quot;</span> : <span class="st">&quot;$session&quot;</span>,
  <span class="st">&quot;element&quot;</span> : <span class="st">&quot;presence&quot;</span>,
  <span class="st">&quot;to&quot;</span> : <span class="st">&quot;ox://marens@1337&quot;</span>,
  <span class="st">&quot;type&quot;</span> : <span class="st">&quot;unsubscribe&quot;</span>
}</code></pre>
</body>
</html>

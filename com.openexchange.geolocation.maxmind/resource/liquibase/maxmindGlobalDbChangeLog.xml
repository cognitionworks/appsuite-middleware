<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="urn:liquibase"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="urn:liquibase /liquibase/dbchangelog-3.0.xsd"
    logicalFilePath="maxmindGlobalDbChangeLog">

    <!-- ******************************************************** -->
    <!-- ************** Release 7.10.2 starts here ************** -->
    <!-- ******************************************************** -->

	<changeSet id="7.10.2:ip_blocks:create" author="ioannis.chouklis@open-xchange.com">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ip_blocks" />
            </not>
        </preConditions>
        <comment>
            Add table 'ip_blocks' to persist the MaxMind geolocation ip database
        </comment>
        <sql>
            CREATE TABLE `ip_blocks` (
  				`ip_from` INT UNSIGNED NOT NULL,
  				`ip_to` INT UNSIGNED NOT NULL,
  				`network` VARCHAR(32) NOT NULL,
  				`geoname_id` INT UNSIGNED NOT NULL,
  				`registered_country_geoname_id` INT UNSIGNED NOT NULL,
  				`represented_country_geoname_id` INT UNSIGNED NOT NULL,
  				`is_anonymous_proxy` TINYINT(1) NOT NULL,
  				`is_satellite_provider` TINYINT(1) NOT NULL,
  				`postal_code` VARCHAR(32) NOT NULL,
  				`latitude` FLOAT(8,4) NOT NULL,
  				`longitude` FLOAT(8,4) NOT NULL,
  				`accuracy_radius` SMALLINT UNSIGNED NOT NULL,
  				PRIMARY KEY `ip_to` (`ip_to`)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
        </sql>
        <rollback>
            <dropTable tableName="ip_blocks"/>
        </rollback>
    </changeSet>
    
    <changeSet id="7.10.2:ip_locations:create" author="ioannis.chouklis@open-xchange.com">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="ip_locations" />
            </not>
        </preConditions>
        <comment>
            Add table 'ip_locations' to persist the MaxMind geolocation ip database
        </comment>
        <sql>
            CREATE TABLE `ip_locations` (
  				`geoname_id` int unsigned NOT NULL,
  				`locale_code` varchar(32) NOT NULL,
  				`continent_code` char(2) NOT NULL,
  				`continent_name` varchar(32) NOT NULL,
  				`country_iso_code` char(2) NOT NULL,
  				`country_name` varchar(64) NOT NULL,
  				`subdivision_1_iso_code` varchar(3) NOT NULL,
  				`subdivision_1_name` varchar(128) COLLATE 'utf8_unicode_ci' NOT NULL,
  				`subdivision_2_iso_code` varchar(3) NOT NULL,
  				`subdivision_2_name` varchar(128) COLLATE 'utf8_unicode_ci' NOT NULL,
  				`city_name` varchar(128) COLLATE 'utf8_unicode_ci' NOT NULL,
  				`metro_code` smallint unsigned NOT NULL,
  				`time_zone` varchar(64) NOT NULL,
  				PRIMARY KEY `geoname_id` (`geoname_id`)
			) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;
        </sql>
        <rollback>
            <dropTable tableName="ip_locations"/>
        </rollback>
    </changeSet>
</databaseChangeLog>
